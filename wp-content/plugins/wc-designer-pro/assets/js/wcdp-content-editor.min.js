!function(e){"use strict";e(document).ready(function(){fabric.util.object.extend(fabric.Object.prototype,{snapAngle:45,snapThreshold:5,centeredScaling:!!wcdp_style.centered_scaling,cornerStyle:wcdp_style.corner_style,cornerSize:parseInt(wcdp_style.corner_size),cornerColor:wcdp_style.corner_color.RGB,borderColor:He(wcdp_style.corner_color.RGB,.75),borderDashArray:[1,1],hasRotatingPoint:!1,transparentCorners:!0});var t,a=new fabric.Canvas("wcdp-canvas-editor",{controlsAboveOverlay:!0}),r=WCDP_URL+"/assets/images/ajax-loader.gif",s='<img src="'+WCDP_URL+'/assets/images/save-loader.gif"/>',n=e(".dp-my-design-contain").length,o={token:0,page:1,totals:0},i=C(),c=se(),l=Ee("#wcdp-btn-lock",!0),d=(Ee("#wcdp-btn-group",!0),"on"==wcdp_settings.rtl_mode),p=[8,9,10,11,12,13,14,15,16,17,18,20,22,24,26,28,30,32,36,42,48,72,96],u=e("#wcdp-product-type").val(),f=0,v=0,h=0,g=!0,m="stroke",w=[],_=0,b=0,y=0,k=1;function C(){var e=wcdp_parameters,t=e.border_bleed_w,a=parseInt("on"==e.border_bleed_e&&t>=1?t:0);if(0!=a){var r=e.type,s=e.canvas_w,n=e.canvas_h,o=parseInt(e.margin_bleed_lr),i=parseInt(e.margin_bleed_tb),c=void 0!==e.bleed_top?parseInt(e.bleed_top):0,l=void 0!==e.bleed_left?parseInt(e.bleed_left):0,d=e.bleed_radius,p=d?d-o/2:0,u=p<=0?0:p,f=new fabric.Group([],{clas:"bleed",evented:!1,selectable:!1}),v={rx:u,ry:u,top:i+c,left:o+l,width:s-(2*o+a),height:n-(2*i+a),fill:"rgba(0, 0, 0, 0)"},h={stroke:wcdp_style.border_bleed_color.RGB,strokeDashArray:[5*a,2+a/2],strokeWidth:a},g=[];"typeDIP"==r?g.push(s/2-parseInt(a/2)):"typeTRIP"==r&&g.push(s/3,s-s/3-a);for(var m=0;m<g.length;m++)f.add(new fabric.Line([g[m],0,g[m],n],h));for(var w in h)v[w]=h[w];return f.add(new fabric.Rect(v)),f}return!1}function x(){var e=0;if(i){var t=i._objects.slice(-1)[0],a=t.strokeWidth;e={x:t.left+a,y:t.top+a,w:t.width-a,h:t.height-a,r:t.rx-a}}return e}fabric.Object.prototype._drawControl=function(e,t,a,r,s){if(this.isControlVisible(e)){var n=this.cornerSize,o=wcdp_style.corner_icons_color?wcdp_style.corner_icons_color.RGB:"#ffffff",i=wcdp_style.corner_border_color?wcdp_style.corner_border_color.RGB:"#679cd1",c="on"==wcdp_style.border_corners,l="on"==wcdp_style.corners_outside,d=l?s-n/2:s,p=l?s+n/2:s,u=l?r-n/2:r,f=l?r+n/2:r,v={tl:{ico:"",top:d,left:u},tr:{ico:"",top:d,left:f},bl:{ico:"",top:p,left:u},br:{ico:"",top:p,left:f}};if(t.fillStyle=this.cornerColor,"tl"==e||"tr"==e||"bl"==e||"br"==e){var h=v[e];"circle"==this.cornerStyle?(t.beginPath(),t.arc(h.left+n/2,h.top+n/2,n/2,0,2*Math.PI),t.fill()):(this.transparentCorners||t.clearRect(h.left,h.top,n,n),t.fillRect(h.left,h.top,n,n)),t.font=n+"px wcdp-sprites",t.fillStyle=o,t.textAlign="left",t.textBaseline="top",t.fillText(h.ico,h.left,h.top),c&&(t.strokeStyle=i,t.lineWidth=1.1,"circle"==this.cornerStyle?t.stroke():t.strokeRect(h.left,h.top,n,n))}else t.beginPath(),t.arc(r+n/2,s+n/2,3,0,2*Math.PI),t.fill(),c&&(t.strokeStyle=i,t.lineWidth=1.1,t.stroke())}},fabric.Canvas.prototype._setCornerCursor=function(e,t,a){if("mt"===e||"mr"===e||"br"===e||"mb"===e||"ml"===e)this.setCursor(this._getRotatedCornerCursor(e,t,a));else if("tr"===e)this.setCursor(this.rotationCursor);else if("tl"===e)this.setCursor("copy");else{if("bl"!=e)return this.setCursor(this.defaultCursor),!1;this.setCursor("pointer")}},fabric.Canvas.prototype._setupCurrentTransform=function(e,t){if(t){var a=this.getPointer(e),r=t._findTargetCorner(this.getPointer(e,!0)),s=this._getActionFromCorner(t,r,e),n=this._getOriginFromCorner(t,r);"tl"!==r?"bl"!==r?("tr"===r&&(s="rotate"),this._currentTransform={target:t,action:s,corner:r,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,offsetX:a.x-t.left,offsetY:a.y-t.top,originX:n.x,originY:n.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,left:t.left,top:t.top,theta:fabric.util.degreesToRadians(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e[this.centeredKey]},this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,originX:n.x,originY:n.y},this._resetCurrentTransform()):y="remove":y="duplicate"}},fabric.Object.prototype._setCornerCoords=function(){var e,t,a=this.oCoords,r=fabric.util.degreesToRadians(this.angle),s=this.cornerSize*Math.sin(r),n=this.cornerSize*Math.cos(r),o=-.5,i=.5,c=-.5,l=.5;for(var d in a)e=a[d].x,t=a[d].y,"on"==wcdp_style.corners_outside&&("tl"===d||"tr"===d?(o=-1,i=0):"bl"===d||"br"===d?(o=0,i=1):(o=-.5,i=.5),"tl"===d||"bl"===d?(c=-1,l=0):"tr"===d||"br"===d?(c=0,l=1):(c=-.5,l=.5)),a[d].corner={tl:{x:e+c*n-o*s,y:t+c*s+o*n},tr:{x:e+l*n-o*s,y:t+l*s+o*n},bl:{x:e+c*n-i*s,y:t+c*s+i*n},br:{x:e+l*n-i*s,y:t+l*s+i*n}}},fabric.Object.prototype._drawClipArea=function(e){var t=x();e.save();var a=this.calcTransformMatrix(),r=fabric.util.invertTransform(a);e.transform.apply(e,r),e.beginPath(),e.roundRect(t.x,t.y,t.w,t.h,t.r<=0?0:t.r),e.fillStyle="transparent",e.fill(),e.closePath(),e.restore()},CanvasRenderingContext2D.prototype.roundRect=function(e,t,a,r,s){return a<2*s&&(s=a/2),r<2*s&&(s=r/2),this.beginPath(),this.moveTo(e+s,t),this.arcTo(e+a,t,e+a,t+r,s),this.arcTo(e+a,t+r,e,t+r,s),this.arcTo(e,t+r,e,t,s),this.arcTo(e,t,e+a,t,s),this.closePath(),this},fabric.Canvas.prototype._scaleObject=function(e,t,a){var r=this._currentTransform,s=r.target,n=s.get("lockScalingX"),o=s.get("lockScalingY"),i=s.get("lockScalingFlip");if(n&&o)return!1;var c,l=s.translateToOriginPoint(s.getCenterPoint(),r.originX,r.originY),d=s.toLocalPoint(new fabric.Point(e,t),r.originX,r.originY),p=s._getTransformedDimensions();if(this._setLocalMouse(d,r),"on"==wcdp_style.corners_outside&&"br"==r.corner){var u=this.getZoom(),f=s.cornerSize/u;p.x+=f,p.y+=f}return c=this._setObjectScale(d,r,n,o,a,i,p),s.setPositionByOrigin(l,r.originX,r.originY),c},fabric.Text.prototype._renderText=function(e){"stroke"==m?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},t='<div class="dp-loader-editor"></div>',t+='<div class="wcdp-snap-line-h"></div>',t+='<div class="wcdp-snap-line-v"></div>',t+='<div id="wcdp-zoom-move" style="height:'+100*wcdp_parameters.canvas_h/wcdp_parameters.canvas_w+'px"><span></span></div>',e(".canvas-container").append(t),e("body").append('<div class="wcdp_overlay_loader"></div>'),e("#wcdp-text-fontFamily > option").each(function(){w.push(this.value)});var A,j=e(".dp-loader-editor"),S=e(".wcdp-snap-line-h"),D=e(".wcdp-snap-line-v"),O=e(".wcdp_overlay_loader");function M(t,r){var s=e("#wcdp-canvas-thumbs-container");if("typeF"!=wcdp_parameters.type&&0==s.find('[data-id="back"]').length&&-1!=t.indexOf("back")&&(t=t.filter(function(e){return"back"!=e})),r<t.length){var n=t[r];wcdp_parameters.jsonSides[n][0]||(wcdp_parameters.jsonSides[n]=['{"objects":[],"background":"transparent","backgroundCMYK":"0,0,0,0"}']),a.loadFromJSON(JSON.parse(wcdp_parameters.jsonSides[n]),function(){a.renderAll.bind(a),X(),++r,j.show(),Y(n).then(function(){M(t,r)})})}else setTimeout(function(){var e="dp-canvas-active",t=s.find("div");t.hasClass(e)&&t.removeClass(e),t.eq(0).addClass(e),j.hide(),O.hide(),le(t.eq(0).attr("data-id"))},100),Be(0)}O.show(),J(),B(),A="y",e(".wcdp-tab-section .mc__sb").mCustomScrollbar({scrollbarPosition:"outside",autoExpandScrollbar:!0,autoHideScrollbar:!0,scrollInertia:200,axis:A,mouseWheel:{preventDefault:!0},callbacks:{onScrollStart:function(){g=!1},onScroll:function(){g=!0},onTotalScroll:function(){var t=e(this);if(t.hasClass("dp-res-content")){var a=t.attr("id").substring(9);o.page++,t.find(".dp-img-res").length<o.totals&&ke(a)}}}}),e.spectrum.installPicker("spectrum-js"),Je(".wcdp-tab-section .dp-img-contain img.lazyload"),document.onkeydown=ae,Xe(wcdp_parameters.fontsDesign).then(function(){M(Object.keys(wcdp_parameters.jsonSides).reverse(),0)});var T=function(){var t=I(),a=e("#wcdp-canvas-thumbs-container .dp-canvas-active").attr("data-id");if(wcdp_parameters.jsonSides[a][wcdp_parameters.jsonStates[a]]!==t){var r=wcdp_parameters.jsonSides[a].length-wcdp_parameters.jsonStates[a]-1;if(0!=r)for(var s=0;s<r;s++)wcdp_parameters.jsonSides[a].pop();wcdp_parameters.jsonSides[a].push(t),wcdp_parameters.jsonStates[a]++,le(a),Y()}};function I(e){var t=a.toJSON();t.objects.reduce(function(e,t,a){return"bleed"!=t.clas&&"grid"!=t.clas||e.push(a),e},[]).reverse().forEach(function(e){t.objects.splice(e,1)});var r=JSON.stringify(t);return e&&(r=new Blob([r],{type:"application/octet-stream"})),r}function Y(t){var r=e.Deferred(),s="dp-canvas-active",n="#wcdp-canvas-thumbs-container div",o="front"==t||"back"==t,i=o?n+'[data-id="'+t+'"]':n+"."+s,c=100/a.getWidth(),l=a.backgroundColor;return a.setBackgroundColor("transparent").renderAll(),e(i).find("img").attr("src",U(c,"png")).css("background-color",l),a.setBackgroundColor(l).renderAll(),void 0===t||o||(e(n).removeClass(s),e(t).addClass(s)),r.resolve(),r.promise()}a.on("object:modified",T),wcdp_spectrum_functions.saveState=T,e("#wcdp-canvas-thumbs-container").on("click","div",function(t,r){t.preventDefault();var s=e(this).attr("data-id"),n=!e(this).hasClass("dp-canvas-active"),o=a.getActiveObject();o&&"i-text"==o.clas&&o.isEditing&&a.discardActiveObject(o),j.show(),Y(this).then(function(){n?(O.show(),function(t){var r=e.Deferred();return a.clear(),a.loadFromJSON(JSON.parse(wcdp_parameters.jsonSides[t][wcdp_parameters.jsonStates[t]]),function(){a.renderAll.bind(a),X(),Be(0),R("add"),r.resolve()}),r.promise()}(s).then(function(){j.hide(),O.hide(),ce("lock"),Ke(),le(s),"function"==typeof r&&r(),e("#wcdp-btn-preview").hasClass("btn-enabled")&&de().then(function(){ue(),e("#wcdp-btn-preview").removeClass("btn-enabled")})})):j.hide()})});var z=e(window).width();function B(){e(".canvas-container").width("auto");var t=e("#wcdp-canvas-container").outerWidth(),r=e("#wcdp-custom-tool-panel"),s=e("#wcdp-opts-below-canvas"),n=e("#wcdp-toolbar-options"),o=n.outerWidth(),i=wcdp_parameters.canvas_w,c=wcdp_parameters.canvas_h,l=((i>t?t:i)/i).toFixed(2),d=i*l;a.setDimensions({width:d,height:c*l}),d<380?s.addClass("zoom-disabled"):s.removeAttr("class"),s.css({visibility:"visible","max-width":d+"px"}),n.css("visibility","visible").removeAttr("class"),o<460?n.addClass("dp-sensor-460"):o<811&&n.addClass("dp-sensor-811"),Math.round(100*window.devicePixelRatio)<100&&n.addClass("dp-brw-perc"),r.removeAttr("style"),window.innerWidth>768&&r.css("height",e("#wcdp-editor-container").height()+"px"),P(l),k=l,K()}function K(){var t=k,r=Math.round(100*t);a.getZoom()!=t&&(e("#wcdp-zoom-move").fadeOut(),e("#wcdp-zoom-canvas").attr("min",r).val(r),a.viewportTransform=[t,0,0,t,0,0],a.setZoom(t).calcOffset().renderAll(),G(r))}function G(t){e("#wcdp-zoom-canvas-container .dp-zoom-value").html(t+"%")}function P(t){var a=wcdp_parameters.radius>=0?wcdp_parameters.radius:0;e("#wcdp-canvas-container .lower-canvas, #wcdp-canvas-container .upper-canvas").css("border-radius",a*t+"px"),e("#wcdp-canvas-thumbs-container img").css("border-radius",a/(wcdp_parameters.canvas_w/100)+"px")}function R(t){var r=e("#wcdp-btn-grid").hasClass("btn-enabled");"add"==t?(i&&a.add(i),r&&a.add(c)):"remove"==t?(i&&a.remove(i),r&&a.remove(c)):"bring"==t&&(i&&i.bringToFront(),r&&c.bringToFront()),a.renderAll()}function q(e){"on"==wcdp_parameters.auto_hide_bleed&&i&&(i.visible=e,a.renderAll())}function W(t,r){var o="publish"==t,i="addtocart"==t,c="download"==t,l="save"==t,p=wcdp_settings,f=wcdp_parameters,v=f.editor,g=f.designID,w=f.productID,_="frontend"==v,b=(new Date).getTime(),y=Ze(),k=Ze(),C=c||i,x=/([\/\\\"\*\?\|\<\>\:])/g,A=p.zip_name,j=A?A.replace(x,""):"wcdp",S=i?f.productName:l&&_?h:0,D=S?S.replace(x,""):"",O=D.trim().length?D:wcdp_translations.untitled,M=f.output_w/a.getWidth(),T=350/a.getWidth(),Y=f.watermark_img,z=f.watermark_rep,B="on"==p.output_svg,K="on"==p.add_svg_user,G=B&&(i||c&&K),P="on"==p.output_pdf,R="on"==p.add_pdf_user,q=P&&(i||c&&R),W=q&&"on"==p.output_pdf_svg,J={width:f.pdf_w,height:f.pdf_h,margin:f.pdf_margin,scale:f.pdf_scale,strech:f.pdf_strech},X="on"==p.output_png,N="on"==p.add_png_user,V=X&&(i||c&&N),Z=i&&"on"==p.CMYK&&"on"==p.output_cmyk,Q=Z&&"on"==p.output_cmyk_user,$=i&&"on"==p.output_json,ee=e("#wcdp-canvas-thumbs-container div"),te=new jBox("Modal",{content:wcdp_translations[o||l?"save_process":"cart_process"]+s,id:"wcdp-jbox-save",addClass:d?"md__rtl":"",closeOnEsc:!1,closeButton:!1,closeOnClick:!1,onCloseComplete:function(){this.destroy()}}).open(),ae=function(d,p){if("backend"==v&&a.forEachObject(function(e){"i-text"==e.clas&&e.set("placeholder",!0)}),"variable"==u&&1==d&&(i||l&&_)){var h={};e("#wcdp-settings-panel .variations select").each(function(){var t=e(this),a=t.attr("id"),r=t.val();a&&r&&(h[a]=r)})}var A=ee.parent().find(".dp-canvas-active"),S=A.find("label").text().replace(x,""),D=A.attr("data-id"),P=!c&&"front"==D,X={editor:v,designID:g,designName:O,productID:w,zipName:j,uniqZipUser:y,uniqZipAdmin:k,uniq:b.toString(),saveList:!(!l||!_||1!=d)||0,productData:i&&1==d?r:0,attrData:void 0!==h?h:0,cover:!!P||0,watermark:Y||0,watermarkRep:!!z||0,multpCover:T,multpOutput:M,outputSvg:B,userSvg:K,addPdf:q,userPdf:R,pdfSvg:W,pdf:J,userPng:N,addCMYK:Z,userCMYK:Q,outputJson:$,label:S,mode:t,side:D,sides:d};setTimeout(function(){var t=[];if(C&&t.push("jpeg"),V&&t.push("png"),(G||W)&&t.push("svg"),q&&t.push("pdf"),!c&&_&&"typeF"!=f.type&&0==ee.parent().find('[data-id="back"]').length&&void 0!==f.jsonSides.back){var r=f.jsonSides.back[f.jsonStates.back],u=new Blob([r],{type:"application/octet-stream"});p.upload.push({name:"back",ext:"json",data:u})}(function(t,r,n,o){var i=e.Deferred(),c={},l=function(d){if(d==t.length){if("download"==o.mode)i.resolve(r);else{var p=I(!0);if(r.upload.push({name:o.side,ext:"json",data:p}),o.outputJson&&(r.admin[o.label+".json"]=p),o.cover&&r.upload.push({name:"cover",ext:"jpg",data:U(o.multpCover,"jpeg",!0)}),o.addCMYK&&r.upload.push({name:o.label,ext:"CMYK",data:r.admin[o.label+".jpg"]}),o.sides>1)i.resolve(r);else{var u=function(){var t=new FormData;o.files=[];for(var a=0;a<r.upload.length;a++){var s=r.upload[a];t.append(a,s.data),o.files.push({count:a,name:s.name,ext:s.ext})}t.append("action","wcdp_save_canvas_design_ajax"),t.append("params",JSON.stringify(o)),e.ajax({url:AJAX_URL,type:"POST",contentType:!1,processData:!1,data:t,success:function(e){if((e=JSON.parse(e)).success){var t=e.filesCMYK;if(t.length>0){r.upload=[];var a=function(e){var s=new XMLHttpRequest;s.open("GET",t[e].url+"/"+t[e].name),s.responseType="blob",s.onload=function(){o.userCMYK&&(r.user[t[e].name]=s.response),r.admin[t[e].name]=s.response,++e===t.length?f():a(e)},s.send()};a(0)}else i.resolve(e)}else n.destroy(),Fe(wcdp_translations.error_process)}})},f=function(){n.setContent(wcdp_translations.zip_files+s),L(r.user).then(function(e){r.upload.push({name:o.zipName+"_"+o.uniqZipUser,ext:"zip",data:e}),Object.keys(r.user).length!=Object.keys(r.admin).length||o.watermark?L(r.admin).then(function(e){r.upload.push({name:o.zipName+"_"+o.uniqZipAdmin,ext:"zip",data:e}),n.setContent(wcdp_translations.save_files+s),u()}):(o.uniqZipAdmin=o.uniqZipUser,n.setContent(wcdp_translations.save_files+s),u())})};o.addCMYK||"publish"==o.mode||"save"==o.mode?u():f()}}c=null}else{var v=t[d];if(d++,"jpeg"==v){c.sideJPG=U(o.multpOutput,"jpeg",!1,!0);var h=pe(c.sideJPG,"image/jpeg");"addtocart"==o.mode&&(r.admin[o.label+".jpg"]=h),o.watermark?E([c.sideJPG,o.watermark],o.watermarkRep,"jpeg").then(function(e){c.sideWatermark=e,r.user[o.label+".jpg"]=pe(c.sideWatermark,"image/jpeg"),l(d)}):(r.user[o.label+".jpg"]=h,l(d))}else if("png"==v){var g=U(o.multpOutput,"png",!1,!0),w=pe(g,"image/png");"addtocart"==o.mode&&(r.admin[o.label+".png"]=w),o.userPng?o.watermark?E([g,o.watermark],o.watermarkRep,"png").then(function(e){r.user[o.label+".png"]=pe(e,"image/png"),l(d)}):(r.user[o.label+".png"]=w,l(d)):l(d)}else if("svg"==v)(function(t){var r=e.Deferred(),s=function(){for(var e=[],t=[],r=[],s=a.getObjects(),n=0;n<s.length;n++)"bleed"!=s[n].clas&&"grid"!=s[n].clas&&r.push(s[n]);var o=function(a){if(a.length>0){var r=a[0];if("i-text"==r.clas&&-1==t.indexOf(r.fontFamily))t.push(r.fontFamily);else if("group"==r.type&&r._objects)for(var s=0;s<r._objects.length;s++)a.push(r._objects[s]);a.splice(r,1),o(a)}else if(t.length>0){var n=wcdp_data_fonts.map(function(e,t){return e.name});t.sort(),t.forEach(function(t,a){var r=n.indexOf(t);if(-1!=r){var s=wcdp_data_fonts[r];void 0!==s.id&&void 0!==s.url&&void 0!==s.name&&s.name===t&&e.push(s)}})}};return o(r),e}(),n=function(e,t){var a=0,o=s[e];if(e++,"wf"==o.id){if(t){var i=t.items.filter(function(e){return e.family===o.name});a=i.length>0&&void 0!==i[0].files.regular?i[0].files.regular.replace("http:",""):0}}else a=o.url;if(a){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){var a=200==this.status,i=new FileReader;i.onloadend=function(i){a&&(o.base64=i.target.result.split("base64,")[1]),e===s.length?r.resolve(s):n(e,t)},i.readAsDataURL(c.response)},c.send()}else e===s.length?r.resolve(s):n(e,t)};if(s.length>0)if(t){var o=WCDP_URL+"/assets/js/webfonts.json";e.getJSON(o,function(e){n(0,e)}).fail(function(e){Fe(wcdp_translations.error_file+": webfonts.json"),r.resolve(!1)})}else n(0,0);else r.resolve(s);return r.promise()})(o.pdfSvg).then(function(t){if(t){var s=U(o.multpOutput,"svg",!1,!0);o.addPdf&&o.pdfSvg&&(c.fonts=t),function(t,r){var s=e.Deferred(),n=e("<div>"+t+"</div>");n.find("desc").html("Created with WooCommerce Designer Pro - https://www.jmaplugins.com");var o=parseInt(wcdp_parameters.canvas_w),i=parseInt(wcdp_parameters.canvas_h),c="on"==wcdp_parameters.hide_bc?"transparent":a.backgroundColor;if(e('<rect x="0" y="0" width="'+o+'" height="'+i+'" fill="'+c+'"></rect>').insertAfter(n.find("defs")),r.length>0){for(var l=[],d="",p=0;p<r.length;p++){var u=r[p];if("wf"==u.id){var f=u.name.replace(/\s/g,"+");l.push(f)}else if(void 0!==u.base64){var v="application/"+("eot"==u.url.substr(u.url.lastIndexOf(".")+1)?"vnd.ms-fontobject":"octet-stream");d+="\t@font-face{\n\t\tfont-family: "+u.name+';\n\t\tsrc: url("data:'+v+";base64,"+u.base64+'");\n\t}\n'}}var h='<style type="text/css"><![CDATA[\n';l.length>0&&(h+='\t@import url("http://fonts.googleapis.com/css?family='+l.join("|")+'");\n'),d&&(h+=d),h+="]]></style>\n",n.find("defs").append(h)}n.find("text").each(function(){var e=we(this.parentNode.getAttribute("id"));e&&e.fontSize&&e.charSpacing&&e.charSpacing>0&&this.setAttribute("letter-spacing",e.charSpacing*e.fontSize/1e3),"stroke"==m&&this.setAttribute("style",this.getAttribute("style")+" paint-order: stroke;")});var g=n.find("image"),w=function(e){if(e==g.length)s.resolve(n.html());else{var t=g[e],a=t.getAttribute("xlink:href");if(e++,0===a.indexOf("http")){var r=a.substr(a.lastIndexOf(".")+1),o="png"==r||"gif"==r?"png":"jpeg",i=we(t.getAttribute("id"));if(i)t.setAttribute("xlink:href",i.toDataURL({format:o,multiplier:i._element.width/i.getWidth()})),w(e);else if(-1!==a.search("maps.googleapis.com")){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){var a=200==this.status,r=new FileReader;r.onloadend=function(r){a&&t.setAttribute("xlink:href",r.target.result),w(e)},r.readAsDataURL(c.response)},c.send()}else{var l=new Image;l.onload=function(){var a=document.createElement("canvas");a.width=this.naturalWidth,a.height=this.naturalHeight,a.getContext("2d").drawImage(this,0,0),t.setAttribute("xlink:href",a.toDataURL("image/"+o)),w(e)},l.src=a}}else w(e)}};g.length>0?w(0):s.resolve(n.html());return s.promise()}(s,t).then(function(e){if(c.sideSVG=e,o.outputSvg){var t=new Blob([c.sideSVG],{type:"image/svg+xml;charset=utf-8"});o.userSvg&&(r.user[o.label+".svg"]=t),"addtocart"==o.mode&&(r.admin[o.label+".svg"]=t)}l(d)})}else n.destroy()});else if("pdf"==v){var _={author:"WooCommerce Designer Pro",output_w:a.getWidth()*o.multpOutput,output_h:a.getHeight()*o.multpOutput,output_m:o.multpOutput,width:72*o.pdf.width/25.4,height:72*o.pdf.height/25.4,margin:72*o.pdf.margin/25.4,scale:o.pdf.scale?o.pdf.scale:.8,strech:"on"==o.pdf.strech,pdfSvg:o.pdfSvg,label:o.label};if(o.pdfSvg)F(_,c.sideSVG,c.fonts).then(function(e){o.userPdf&&(r.user[o.label+".pdf"]=e),"addtocart"==o.mode&&(r.admin[o.label+".pdf"]=e),l(d)});else{var b=o.userPdf&&o.watermark,y=b?c.sideWatermark:c.sideJPG;F(_,y).then(function(e){o.userPdf&&(r.user[o.label+".pdf"]=e),"addtocart"==o.mode?b?F(_,c.sideJPG).then(function(e){r.admin[o.label+".pdf"]=e,l(d)}):(r.admin[o.label+".pdf"]=e,l(d)):l(d)})}}}};return l(0),i.promise()})(t,p,te,X).then(function(t){if(d>1)ee.not(".dp-canvas-active").trigger("click",function(){ae(d-=1,t)});else if(c)te.setContent(wcdp_translations.zip_files+s),L(t.user).then(function(e){saveAs(e,j+"_"+y+".zip"),te.destroy()});else{if(o)e(".post-type-wcdp-designs #publish").attr("data-save",!0).click();else if(i)Ue("<p><b>"+wcdp_translations.product_added+"</b></p>"+wcdp_translations.view_cart,function(){window.open(t.cart_url,"_self")});else if(l)if(t.userID){if(_){var a=e("#wcdp-my-designs-panel .dp-contain-box"),r=a.find(".mCSB_container");0==e(".dp-my-design-contain").length&&r.html("");var p='<div class="dp-my-design-contain dp-border-style" page-id="'+f.pageID+'" pid="'+w+'" sid="'+b+'">';p+='<span class="dp-my-design-cover" title="'+O+'" data-name="'+O+'"><img src="'+WCDP_URL_UPLOADS+"/save-user/"+b+'/cover.jpg"/></span>',p+='<div class="dp-loader-box"></div><div class="dp-remove-my-design"></div></div>',H("wcdp-btn-my-designs"),r.append(p),setTimeout(function(){a.mCustomScrollbar("scrollTo","bottom")},100),n++}Fe(wcdp_translations.save)}else window.open(t.wc_myaccount,"_self");te.destroy()}})},500)};ae(ee.length,{user:{},admin:{},upload:[]})}function L(t){var a=e.Deferred(),r=new JSZip,s=Object.keys(t),n=0;return s.forEach(function(e){r.file(e,t[e]),++n==s.length&&r.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}).then(function(e){a.resolve(e)})}),a.promise()}function E(t,a,r){var s=e.Deferred(),n=function(e){var o=new Image;o.onload=function(){t[e]=this,++e===t.length?function(){var e=t[0],n=t[1],o=e.width,i=e.height,c=n.width,l=n.height,d=document.createElement("canvas");d.width=o,d.height=i;var p=d.getContext("2d");if(p.drawImage(e,0,0,o,i),a)for(var u=0;u<o;){for(var f=0;f<i;)p.drawImage(n,u,f,c,l),f+=l;u+=c}else u=o/2-c/2,f=i/2-l/2,p.drawImage(n,u,f,c,l);s.resolve(d.toDataURL("image/"+r))}():n(e)},o.src=t[e],o.onerror=function(){Fe(wcdp_translations.error_process)}};return n(0),s.promise()}function F(t,a,r){var s=e.Deferred(),n=function(){var e=new PDFDocument({compress:!1,size:[t.width,t.height]});return e.info.Title=t.label,e.info.Author=t.author,e.info.Creator=t.author,e},o=n(),i=t.width/t.output_w,c=i>t.scale?t.scale:i,l=t.strech?0:(t.width-t.output_w*c)/2,d=t.strech?0:t.margin<=0?0:t.margin,p={width:t.strech?t.width:t.output_w*c,height:t.strech?t.height:t.output_h*c};if(t.pdfSvg){if(r.length>0)for(var u=0;u<r.length;u++){var f=r[u];if(void 0!==f.base64)if("wf"==f.id||"ttf"==f.url.substr(f.url.lastIndexOf(".")+1)){for(var v=window.atob(f.base64),h=new Uint8Array(v.length),g=0;g<v.length;g++)h[g]=v.charCodeAt(g);o.registerFont(f.name,h.buffer)}}try{t.strech&&(p.preserveAspectRatio="none"),SVGtoPDF(o,a,l,d,p)}catch(e){o=n(),a=U(t.output_m,"jpeg",!1,!0),o.image(a,l,d,p)}}else o.image(a,l,d,p);var m=o.pipe(blobStream());return m.on("finish",function(e){var t=m.toBlob("application/pdf");s.resolve(t)}),o.end(),s.promise()}function U(e,t,r,s){var n=a.viewportTransform,o=wcdp_parameters,i=k,c=0;if(s&&te(!1),R("remove"),a.viewportTransform=[i,0,0,i,0,0],s&&"on"==o.output_inside_bleed){var l=o.border_bleed_w,d=parseInt("on"==o.border_bleed_e&&l>=1?l:0);if(0!=d){c=!0;var p=parseInt(o.margin_bleed_lr),u=parseInt(o.margin_bleed_tb),f=void 0!==o.bleed_top?parseInt(o.bleed_top):0,v=void 0!==o.bleed_left?parseInt(o.bleed_left):0,h=o.canvas_w-(2*p+2*d),g=o.canvas_h-(2*u+2*d)}}if("svg"==t){var m=a.getWidth(),w=a.getHeight(),_=a.backgroundColor,b={width:m*e,height:w*e};c&&(b.width=h*e*i,b.height=g*e*i,b.viewBox={x:p+v+d,y:u+f+d,width:h,height:g}),a.backgroundColor=null;var y=a.toSVG(b);a.backgroundColor=_,"undefined"!=typeof rect&&a.remove(rect),r&&(y=new Blob([y],{type:"image/svg+xml;charset=utf-8"}))}else{var C={format:t,multiplier:e};c&&(C.top=(u+f+d)*i,C.left=(p+v+d)*i,C.width=h*i,C.height=g*i);var x="jpeg"==t&&"transparent"==a.backgroundColor;x&&(a.backgroundColor="#ffffff");y=a.toDataURL(C);x&&(a.backgroundColor="transparent"),r&&(y=pe(y,"image/"+t))}return a.viewportTransform=n,s&&te(!0),R("add"),y}function J(){("frontend"==wcdp_parameters.editor&&"variable"==u&&"designer_editor"==wcdp_parameters.mode||wcdp_parameters.attr_data)&&e("#wcdp-settings-panel .variations select").each(function(){e(this).val()&&N(this,!1)})}function X(){f&&a.setBackgroundColor(f).renderAll()}function N(t,r){var s=e(t),n=s.attr("data-attribute_name").replace("attribute_",""),o=s.find("option:selected").val(),l=s.parent().find('.dp-attr-values input[name="'+o+'"]').val(),d=wcdp_parameters.attr_actions;if(d&&d[n]&&void 0!==d[n].actions){var p=d[n].actions[l];if(void 0!==p){var u=0,v=0,h=e("#wcdp-canvas-thumbs-container"),g=function(t){var s=Object.keys(p);if(s.length==t){if(u){if(v){var o=100*wcdp_parameters.canvas_h/wcdp_parameters.canvas_w;h.find("img").height(o),e("#wcdp-zoom-move").height(o)}r?(R("remove"),v&&(c=se()),i=C(),R("add"),q(!1),Be(0),v&&(B(),function(){var t=e("#wcdp-canvas-thumbs-container div"),a=document.createElement("canvas");a.width=wcdp_parameters.canvas_w,a.height=wcdp_parameters.canvas_h,a=new fabric.StaticCanvas(a);var r=function(e){if(e==t.length)a.dispose();else{var s=t.eq(e);e++;var n=s.attr("data-id");n&&wcdp_parameters.jsonSides[n]&&void 0!==wcdp_parameters.jsonSides[n][wcdp_parameters.jsonStates[n]]?a.loadFromJSON(JSON.parse(wcdp_parameters.jsonSides[n][wcdp_parameters.jsonStates[n]]),function(){a.renderAll.bind(a),a.setBackgroundColor("transparent").renderAll(),s.find("img").attr("src",a.toDataURL({format:"png",multiplier:100/wcdp_parameters.canvas_w})),r(e)}):r(e)}};r(0)}())):(v&&(c=se()),i=C())}}else{var l=s[t];if(t++,"on"==p[l].active){var m=p[l].value;if("bg_color"!=l||""!=m&&!/^#[0-9A-F]{6}$/i.test(m))if(!m||"pr_img_front"!=l&&"pr_img_back"!=l)if(m&&"pr_sides"==l&&"typeF"!=wcdp_parameters.type){var w=h.find('[data-id="front"]'),_=h.find('[data-id="back"]');if("sideF"==m&&1==_.length)_.hasClass("dp-canvas-active")?w.trigger("click",function(){_.remove(),g(t)}):(_.remove(),g(t));else if("sideFB"==m&&0==_.length){var b='style="height:'+(100*wcdp_parameters.canvas_h/wcdp_parameters.canvas_w+"px")+"; border-radius:"+(wcdp_parameters.radius>=0?wcdp_parameters.radius/(wcdp_parameters.canvas_w/100):0)+'px"';h.append('<div data-id="back"><img width="100" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="'+b+"/><label>"+wcdp_parameters.label_b+"</label></div>"),h.find('[data-id="back"]').trigger("click",function(){Y(),g(t)})}else g(t)}else!m||"canvas_w"!=l&&"canvas_h"!=l?!m||"output_w"!=l&&"pdf_w"!=l&&"pdf_h"!=l?!m||"margin_bleed_lr"!=l&&"margin_bleed_tb"!=l&&"bleed_top"!=l&&"bleed_left"!=l&&"bleed_radius"!=l?m&&"radius"==l?(wcdp_parameters[l]=m,B(),g(t)):g(t):(wcdp_parameters[l]=m,u=!0,g(t)):(wcdp_parameters[l]=m,g(t)):(wcdp_parameters[l]=m,"canvas_w"==l?a.setWidth(m):a.setHeight(m),u=!0,v=!0,g(t));else{var y=l.substring(7);if(void 0!==wcdp_parameters.jsonSides[y]){wcdp_parameters.jsonSides[y][0]||(wcdp_parameters.jsonSides[y]=['{"objects":[],"background":"transparent","backgroundCMYK":"0,0,0,0"}']);var k=void 0!==d[n].set_img?d[n].set_img:"bg_img",x={crossOrigin:"Anonymous",originY:"top",originX:"left",width:parseInt(wcdp_parameters.canvas_w),height:parseInt(wcdp_parameters.canvas_h)};if(r){j.show(),O.show();var A=new Image;A.crossOrigin="Anonymous",A.onload=function(){var e=h.find('[data-id="'+y+'"]');if(e.hasClass("dp-canvas-active")){var r=new fabric.Image(A,x);"bg_img"==k?a.setBackgroundImage(r).renderAll():a.setOverlayImage(r).renderAll(),Y(y),wcdp_parameters.jsonSides[y]=[I()],wcdp_parameters.jsonStates[y]=0,le(y),g(t)}else{x.src=this.src;var s=JSON.parse(wcdp_parameters.jsonSides[y][wcdp_parameters.jsonStates[y]]);"bg_img"==k?s.backgroundImage=x:s.overlayImage=x,wcdp_parameters.jsonSides[y]=[JSON.stringify(s)],wcdp_parameters.jsonStates[y]=0,le(y);var n=document.createElement("canvas");n.width=x.width,n.height=x.height,(n=new fabric.StaticCanvas(n)).loadFromJSON(s,function(){n.renderAll.bind(n),n.setBackgroundColor("transparent").renderAll(),e.find("img").attr("src",n.toDataURL({format:"png",multiplier:100/x.width})),n.dispose(),g(t)})}j.hide(),O.hide()},A.src=m,A.onerror=function(){Fe(wcdp_translations.error_process)}}else{x.src=m;var S=JSON.parse(wcdp_parameters.jsonSides[y][0]);"bg_img"==k?S.backgroundImage=x:S.overlayImage=x,wcdp_parameters.jsonSides[y][0]=JSON.stringify(S),g(t)}}else g(t)}else f=m=m||"transparent",r&&(X(),h.find("img").css("background-color",m),Be(m)),g(t)}else g(t)}};g(0)}}}function H(t){var a=e("#"+t),r="vtab-selected";0===a.length||a.hasClass(r)||(e("#wcdp-tabs-icons > span").removeClass(r),a.addClass(r),e("#wcdp-tabs-content > .wcdp-tab-section").hide().eq(a.index()).fadeIn(),V(),ze(),Ke())}function V(){"block"==e("#wcdp-text-panel").css("display")?(e(".dp-col-8 span").removeClass("dp-item-selected"),e("#wcdp-text-fontFamily").val("titillium"),e("#wcdp-text-fontSize").val(wcdp_parameters.font_size),e("#wcdp-new-textbox").removeAttr("placeholder").attr("disabled","disabled").val(""),e("#wcdp-text-color-font").spectrum("set",wcdp_style.text_color_editor.RGB).spectrum("setCMYK",wcdp_style.text_color_editor.CMYK),e("#wcdp-text-outline-color").spectrum("set",wcdp_style.text_color_editor_outline.RGB).spectrum("setCMYK",wcdp_style.text_color_editor_outline.CMYK),e("#wcdp-text-stroke, #wcdp-text-spacing").val(0),e("#wcdp-text-radius").val(300),e("#wcdp-text-curved").val("none"),e("#wcdp-text-opacity").val(1)):"block"==e("#wcdp-images-panel").css("display")?(e(".new-spectrum-fill-js, .new-spectrum-stroke-js").spectrum("destroy"),e("#wcdp-svg-color, #wcdp-svg-outline-color").spectrum("set","#000000").spectrum("setCMYK","0,0,0,100"),e(".wcdp-box-svg-multicolor .mCSB_container, .wcdp-box-svg-stroke-multicolor .mCSB_container").html(""),e(".wcdp-box-svg-multicolor, .wcdp-box-svg-stroke-multicolor").parent().hide(),e("#wcdp-images-panel .wcdp-box-filters-btn span").removeClass("dp-item-selected"),e("#wcdp-images-panel .wcdp-box-filters-rng input").val(0),e("#wcdp-svg-stroke").val(0),e("#wcdp-image-opacity").val(1)):"block"==e("#wcdp-shapes-panel").css("display")?(e("#wcdp-shap-color").spectrum("set",wcdp_style.color_shapes_editor.RGB).spectrum("setCMYK",wcdp_style.color_shapes_editor.CMYK),e("#wcdp-shap-outline-color").spectrum("set",wcdp_style.color_shapes_editor_outline.RGB).spectrum("setCMYK",wcdp_style.color_shapes_editor_outline.CMYK),e("#wcdp-shap-stroke").val(0),e("#wcdp-shap-opacity").val(1)):"block"==e("#wcdp-cliparts-panel").css("display")?(e(".new-spectrum-fill-js, .new-spectrum-stroke-js").spectrum("destroy"),e("#wcdp-clip-svg-color, #wcdp-clip-svg-outline-color").spectrum("set","#000000").spectrum("setCMYK","0,0,0,100"),e(".wcdp-box-svg-multicolor .mCSB_container, .wcdp-box-svg-stroke-multicolor .mCSB_container").html(""),e(".wcdp-box-svg-multicolor, .wcdp-box-svg-stroke-multicolor").parent().hide(),e("#wcdp-cliparts-panel .wcdp-box-filters-btn span").removeClass("dp-item-selected"),e("#wcdp-cliparts-panel .wcdp-box-filters-rng input").val(0),e("#wcdp-clip-svg-stroke").val(0),e("#wcdp-clipart-opacity").val(1)):"block"==e("#wcdp-qrcode-panel").css("display")?(e("#wcdp-bg-qr-color").spectrum("set",wcdp_style.bg_color_qr_editor.RGB).spectrum("setCMYK",wcdp_style.bg_color_qr_editor.CMYK),e("#wcdp-fg-qr-color").spectrum("set",wcdp_style.color_qr_editor.RGB).spectrum("setCMYK",wcdp_style.color_qr_editor.CMYK),e("#wcdp-text-box-qr").val(""),e("#wcdp-qr-level").val("LOW"),e("#wcdp-qr-border").val(0),e("#wcdp-qr-range").val(1)):"block"==e("#wcdp-maps-panel").css("display")&&(e("#wcdp-map-icon-color").spectrum("set",wcdp_style.map_color_ico.RGB).spectrum("setCMYK",wcdp_style.map_color_ico.CMYK),e("#wcdp-text-box-map").val(""),e("#wcdp-map-zoom").val(1),e("#wcdp-map-type").val("roadmap"),e("#wcdp-map-icon-size").val("normal"),e("#wcdp-map-icon-label").val("")),ce("group"),_&&!_.active&&(ce("lock"),Re("clear")),Oe(),q(!1),document.onkeydown||(document.onkeydown=ae)}function Z(t,a){if(V(),"img"==t.clas||"clip-img"==t.clas){var r="dp-item-selected",s="#wcdp-"+a+"-panel .wcdp-box-filters";if(e(s+"-btn span").removeClass(r),t.filters.length>0)for(var n in t.filters){var o=t.filters[n].type,i=("ColorMatrix"==o||"Convolute"==o)&&t.filters[n].matrix.toString().length;"brightness"==(o="Grayscale"==o?"grayscale":"Invert"==o?"invert":"Sepia"==o?"purple":"Sepia2"==o?"yellow":"Noise"==o?"noise":"Pixelate"==o?"pixelate":"GaussianBlur"==o?"blur":"Brightness"==o?"brightness":"Saturate"==o?"saturate":"Contrast"==o?"contrast":102==i?"sepia":59==i?"warm":48==i?"cold":251==i?"kodachrome":245==i?"vintage":252==i?"brownie":81==i?"polaroid":249==i?"technicolor":56==i?"acid":39==i?"shiftToBGR":197==i?"fantasy":51==i?"ghost":248==i?"predator":50==i?"night":21==i?"sharpen":23==i&&"emboss")||"saturate"==o||"contrast"==o?e(s+'-rng [data-filter="'+o+'"]').val(t.filters[n][o]/100):e(s+'-btn [data-filter="'+o+'"]').addClass(r)}else e(s+'-btn [data-filter="none"]').addClass(r)}else if("svg"==t.clas||"clip-svg"==t.clas||"groupSVG"==t.clas){var c="groupSVG"==t.clas,l=c?"svg":t.clas,d=c?t._objects[0]:t.paths?t.paths[0]:t,p=c?"images":a,u="transparent",f="0,0,0,0";Q(t,"fill")?e("#wcdp-"+l+"-color").spectrum("set",d.fill?d.fill:u).spectrum("setCMYK",d.fillCMYK?d.fillCMYK:f):$(t,p,c,"fill"),Q(t,"stroke")?e("#wcdp-"+l+"-outline-color").spectrum("set",d.stroke?d.stroke:u).spectrum("setCMYK",d.strokeCMYK?d.strokeCMYK:f):$(t,p,c,"stroke")}}function Q(e,t){if(e._objects||e.paths){var a=e.getObjects()[0].get(t)||"";return"string"==typeof a&&(a=a.toLowerCase(),e.getObjects().every(function(e){var r=e.get(t)||"";return"string"==typeof r&&r.toLowerCase()===a}))}return"string"==typeof e.get(t)}function $(t,a,r,s){for(var n=[],o=0,i=r?t._objects:t.paths?t.paths:[t],c=e("#wcdp-"+a+"-panel .wcdp-box-svg-"+("fill"==s?"":s+"-")+"multicolor"),l=0;l<i.length;l++){var d=[],p=i[l][s],u=i[l][s+"CMYK"],f=p;if(!p||"linear"!=p.type&&"radial"!=p.type)d.push({colorStops:"patch"});else for(var v=0;v<p.colorStops.length;v++){var h={colorStops:v};h[s]=p.colorStops[v].color,h[s+"CMYK"]=p.colorStops[v][s+"CMYK"],d.push(h)}for(var g=0;g<d.length;g++){var m=d[g].colorStops;"patch"!=m&&(p=f.colorStops[m].color,u=f.colorStops[m][s+"CMYK"]),p=p||"transparent",u=u||"0,0,0,0";var w=e.inArray(p,n);-1==w&&"image"!=i[l].type?(c.find(".mCSB_container").append('<input type="text" id="clip_'+s+"_"+o+'" class="dp-picker-'+s+"-"+o+" new-spectrum-"+s+'-js" callback="change_svg_fill_multicolor" data-paths="'+l+":"+m+'"data-value="'+p+'" data-fill="'+s+'" data-id="'+l+'" value="'+p+'" cmyk="'+u+'"/>'),n.push(p),o++):e("#clip_"+s+"_"+w).attr("data-paths",function(){return e(this).attr("data-paths")+","+l+":"+m})}}var _=function(a){setTimeout(function(){e.spectrum.installPicker("dp-picker-"+s+"-"+a),o!==++a?_(a):t.active&&c.parent().show()},1)};_(0)}function ee(e){if("on"==wcdp_style.obj_center||"maps"==e.clas){var t=e.getPointByOrigin("center","center"),r=x();t.x=r?r.w/2+r.x:wcdp_parameters.canvas_w/2,t.y=r?r.h/2+r.y:wcdp_parameters.canvas_h/2,e.setPositionByOrigin(t,"center","center"),e.setCoords(),a.renderAll()}}function te(e){"on"==wcdp_parameters.hide_bg&&a.backgroundImage&&(a.backgroundImage.visible=e),"on"==wcdp_parameters.hide_ov&&a.overlayImage&&(a.overlayImage.visible=e),"on"==wcdp_parameters.hide_bc&&(e&&v?a.backgroundColor=v:(v=a.backgroundColor,a.backgroundColor="transparent")),a.forEachObject(function(t){t.hide&&(t.visible=e)})}function ae(t){var r=t.shiftKey?"shift+":t.altKey?"alt+":t.ctrlKey?"ctrl+":"";for(var s in wcdp_shortcutkeys)if(wcdp_shortcutkeys[s]===r+t.keyCode)var n=s;if("on"==wcdp_shortcutkeys[n+"_ck"]){var o=me(),i=a.getActiveGroup(),c="all",l=!0,d={};if("moveup"==n||"movedown"==n||"moveleft"==n||"moveright"==n){var p=1==o.length?o[0]:i||!1;if(p){var u=n.substring(4);"up"==u?p.set("top",p.getTop()-1):"down"==u?p.set("top",p.getTop()+1):"left"==u?p.set("left",p.getLeft()-1):"right"==u&&p.set("left",p.getLeft()+1),p.setCoords(),a.renderAll(),T()}}else if("select_all"==n)e("#wcdp-btn-select-all").click();else if("erase_all"==n)e("#wcdp-btn-clear").click();else if("grid"==n)e("#wcdp-btn-grid").click();else if("center_vertical"==n)e("#wcdp-btn-center-v").click();else if("center_horizontal"==n)e("#wcdp-btn-center-h").click();else if("flip_vertical"==n)e("#wcdp-btn-flipY").click();else if("flip_horizontal"==n)e("#wcdp-btn-flipX").click();else if("clone_sides"==n){if(o.length>0&&"typeF"!=wcdp_parameters.type)e("#wcdp-canvas-thumbs-container div").not(".dp-canvas-active").trigger("click",function(){var e=!(!i||"clone"==i.clas);ve(o,e,!1)})}else if("bring_front"==n)e("#wcdp-btn-bringForward").click();else if("send_back"==n)e("#wcdp-btn-sendBackwards").click();else if("lock"==n)e("#wcdp-btn-lock").click();else if("duplicate"==n)fe();else if("magic_more"==n||"magic_less"==n){if(o.length>1){if("magic"!=i.clas){i.clas="magic";var f=[];for(s=0;s<o.length;s++)f.push(o[s].getTop());e:for(var v=0;v<o.length;v++)for(var h=Math.min.apply(null,f),g=0;g<o.length;g++)if(o[g].getTop()==h){o[g].bringToFront(),f.splice(f.indexOf(h),1);continue e}}for(var m=1;m<o.length;m++)o[m].set({top:o[m].getTop()+("magic_more"==n?+m:-m)}).setCoords();i.addWithUpdate(),a.renderAll(),T()}}else if("align_left"==n||"align_right"==n)ne(n.substring(6));else if("rotate"==n)e("#wcdp-btn-rotate").click();else if("return_state"==n)d={angle:0,skewX:0,skewY:0},l=!1;else if("align_horizontal"==n||"align_vertical"==n)i&&(i.forEachObject(function(e){var t=e.getPointByOrigin("center","center");"align_horizontal"==n?t.x=0:"align_vertical"==n&&(t.y=0),e.setPositionByOrigin(t,"center","center"),e.setCoords()}),a.renderAll(),T());else if("group"==n)e("#wcdp-btn-group").click();else if("delete"==n)ge();else if("undo"==n)e("#wcdp-btn-undo").click();else if("redo"==n)e("#wcdp-btn-redo").click();else if("line_text_large"==n||"line_text_small"==n){d={lineHeight:"obj.lineHeight"+("line_text_large"==n?"+":"-")+"0.1"},c="i-text"}return Object.keys(d).length&&qe({obj:c,set:d,cmd:l}),!1}}function re(e,t){var r=new fabric.Group(e,{clas:t?"clone":"",canvas:a});r.addWithUpdate(null),a.setActiveGroup(r),r.setCoords(),a.trigger("selection:created",{target:r})}function se(){for(var e=wcdp_parameters.canvas_w,t=wcdp_parameters.canvas_h,a=wcdp_parameters.grid_size,r=new fabric.Group([],{clas:"grid",evented:!1,selectable:!1}),s={stroke:"rgba(0,0,0,.2)",strokeDashArray:[3,3],strokeWidth:1},n=Math.ceil(e/a);n--;)r.add(new fabric.Line([a*n,0,a*n,t],s));for(n=Math.ceil(t/a);n--;)r.add(new fabric.Line([0,a*n,e,a*n],s));return r}function ne(e,t){if(t=1==me().length?a.getActiveObject():a.getActiveGroup()){"i-text"==t.type&&t.isEditing&&t.exitEditing();var r=a.getZoom(),s=t.getPointByOrigin("center","center"),n=t.getBoundingRect(),o=x();"left"==e?s.x=(o?o.x:0)+n.width/2/r:"right"==e?s.x=(o?o.x+o.w:wcdp_parameters.canvas_w)-n.width/2/r:"center-h"==e?s.x=o?o.w/2+o.x:wcdp_parameters.canvas_w/2:"center-v"==e&&(s.y=o?o.h/2+o.y:wcdp_parameters.canvas_h/2),t.setPositionByOrigin(s,"center","center"),t.setCoords(),a.renderAll(),T()}}function oe(){for(var e=[],t=a.getObjects(),r=t.length-1;r>=0;r--)t[r].active&&e.push(t[r]);if(1==e.length){var s=e[0],n=!s.selectable;s.isEditing||(s.set({active:!1,selectable:n}),T(),ie(s))}else a.deactivateAll().renderAll(),Re("clear")}function ie(e,t){ce("lock"),!e||"group"==e.type&&"grouped"!=e.clas&&"groupSVG"!=e.clas?e||Re("clear"):(e.selectable?(e.set({editable:!0,hasControls:!0}),e.active||a.setActiveObject(e),Re("lock",e.id)):e.isEditing||(_=e,t&&(a.selection=!1),a.discardActiveObject(e),e.set({active:!0,editable:!1,hasControls:!1}),ce("unlock"),Re("unlock",e.id),Re("select",e.id)),a.renderAll()),document.onkeydown||(document.onkeydown=ae)}function ce(t){var a="btn-enabled",r="data-jbox-content",s=wcdp_translations[t],n=t.replace("un",""),o=e("#wcdp-btn-"+n);"lock"==t||"group"==t?o.removeClass(a).attr(r,s):o.addClass(a).attr(r,s),"lock"==n&&l.setContent(s)}function le(t){var a="btn-disabled",r=e("#wcdp-btn-undo"),s=e("#wcdp-btn-redo"),n=wcdp_parameters.jsonSides[t];1==n.length||0==wcdp_parameters.jsonStates[t]?r.addClass(a):r.removeClass(a),n.length>0&&wcdp_parameters.jsonStates[t]<n.length-1?s.removeClass(a):s.addClass(a),setTimeout(function(){ze()},100)}function de(){j.show();var t=e.Deferred();return setTimeout(function(){var r=U(wcdp_parameters.preview_w/a.getWidth(),"jpeg"),s=URL.createObjectURL(pe(r,"image/jpeg")),n=e(".dp-canvas-active label").html();e("body").append('<a class="wcdp-preview-img" href="'+s+'" data-jbox-image title="'+n+'"></a>'),t.resolve()},500),t.promise()}function pe(e,t){for(var a=e.split(","),r=atob(a[1]),s=r.length,n=new Uint8Array(s);s--;)n[s]=r.charCodeAt(s);return new Blob([n],{type:t})}function ue(){new jBox("Image",{closeButton:"title",closeOnClick:"body",title:wcdp_translations.preview,maxWidth:wcdp_parameters.preview_w+"px",onCloseComplete:function(){this.destroy(),e(".wcdp-preview-img").remove()}}),e(".wcdp-preview-img").eq(0).click(),j.hide()}function fe(){var e=a.getActiveGroup(),t=!(!e||"clone"==e.clas);ve(me(),t,!0)}function ve(e,t,r){a.discardActiveGroup();var s=e.length;if(s>0){t&&e.reverse();var n=function(t){0==t?function(e){a.deactivateAll().discardActiveGroup();for(var t=[],r=0,s=a.getObjects(),n=s.length-1;n>=0;n--)r<e&&t.push(s[n].set("active",!0)),r++;1==t.length?a.setActiveObject(t[0]):re(t,!0);a.setCursor("default"),a.renderAll(),T(),Ke()}(s):(t--,fabric.util.getKlass(e[t].type).async?e[t].clone(function(e){he(e,r),n(t)}):(he(e[t].clone(),r),n(t)))};n(s)}}function he(e,t){1==t&&e.set({left:e.left+20,top:e.top+20}),e.set("id",Ze()),a.add(e.setCoords())}function ge(){var t=me();t.length>=1&&(a.discardActiveObject(),a.discardActiveGroup(),e.each(t,function(e,t){t.editable=!1,a.remove(t)}),a.setCursor("default"),a.renderAll(),T(),Ke())}function me(){return a.getActiveObject()?[a.getActiveObject()]:a.getActiveGroup()?a.getActiveGroup().getObjects():[]}function we(e){for(var t=a.getObjects(),r=0;r<t.length;++r)if(t[r].id&&t[r].id==e)return t[r]}function _e(){var e=["left","center","right"];return d&&(e[0]="right",e[2]="left"),{fontWeight:["bold"],fontStyle:["italic"],textDecoration:["underline","line-through","overline"],textAlign:e}}function be(e,t,a){var r=0,s="dp-item-selected";for(var n in t.removeClass(s),a)for(var o=0;o<a[n].length;o++)e[n]==a[n][o]&&t.eq(r).addClass(s),r++}function ye(){var t=e("#wcdp-images-panel"),a=t.find(".dp-hori-tab .htab-selected").attr("data-id"),r=e("#wcdp-box-"+a);t.find(".dp-row.md__res").eq(1).removeClass("md__dsb"),t.find(".dp-res-content").hide(),r.find(".dp-res-items").empty().append('<div class="dp-res-overlay"></div>'),r.mCustomScrollbar("update").show(),o.page=1,"flaticon"!=a||o.token?ke(a):(r.addClass("dp-loading-sources"),Ce().then(function(e){e?(o.token=e,ke(a)):Fe("Token not found")}))}function ke(t){var a="pixabay"==t,r="unsplash"==t,s="pexels"==t,n="flaticon"==t,i="#wcdp-box-"+t,c=i+" .dp-res-items",l="dp-loading-sources",d=o.page,p=e("#wcdp-text-box-search-res"),u=encodeURIComponent(p.val()),f=n?"Bearer "+o.token:wcdp_settings[t+"_api"],v="https://"+(a?"pixabay.com/api/?key="+f+"&page="+d+"&per_page=40&q="+u:r?"api.unsplash.com/"+(u&&"search/")+"photos?client_id="+f+"&per_page=20&page="+d+(u&&"&query="+u):s?"api.pexels.com/v1/"+(u?"search?query="+u+"+query&":"curated?")+"per_page=20&page="+d:n&&"api.flaticon.com/v2/search/icons?page="+d+"&q="+u);(s||n)&&(v={url:v,headers:{Authorization:f}}),e(i).addClass(l),e.getJSON(v,function(d){var p=a?d.hits:r?u?d.results:d:s?d.photos:n&&d.data;o.totals=parseInt(a?d.totalHits:r?u?d.total:500:s?u?d.total_results:500:n&&d.metadata.total),o.totals>0?(e.each(p,function(o,i){var l=a?i.largeImageURL:r?i.urls.regular:s?i.src.large:n&&("on"==wcdp_settings.flaticon_svg?i.images.svg:i.images.png[512]),d=a?i.previewURL:r?i.urls.thumb:s?i.src.small:n&&i.images.png[128],p=a||n?"Tags: "+i.tags:r?"Author: "+i.user.name:s&&"Photographer: "+i.photographer,u=n?106:106*(a?i.webformatHeight/i.webformatWidth:i.height/i.width),f='<span class="dp-img-res" data-source="'+l+'" data-tags="'+p+'" data-name="Image by '+Ve(t)+'"><img class="lazyload dp-loading-lazy" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="'+d+'" style="height:'+u+'px;"/></span>';e(f).appendTo(c)}),e(c).data("masonry")?e(c).masonry("reloadItems").masonry():e(c).masonry({itemSelector:".dp-img-res",transitionDuration:0}),e(i).removeClass(l),Je(i+" img.lazyload")):(e(i).removeClass(l),e(c).empty(),e(c).data("masonry")&&e(c).masonry("destroy"),e(i).mCustomScrollbar("update"),e('<span class="wcdp-icon-res-empty dp-search-empty"></span><label>'+wcdp_translations.no_resources+"</label>").appendTo(c))}).fail(function(a){var r=function(t){e(i).removeClass(l),Fe(t)};if(n){var s=JSON.parse(a.responseText);"Expired token"==s.message?Ce().then(function(e){e?(o.token=e,ke(t)):r("Token not found")}):r(s.message)}else r(wcdp_translations.error_process)})}function Ce(){var t=e.Deferred();return e.ajax({url:"https://api.flaticon.com/v2/app/authentication",method:"post",data:{apikey:wcdp_settings.flaticon_api},success:function(e){t.resolve(e.data.token)},error:function(e){t.resolve(!1)}}),t.promise()}function xe(e,t){var a=new XMLHttpRequest;a.onload=function(){if(200==this.status){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(a.response)}else Fe(wcdp_translations.error_file)},a.open("GET",e),a.responseType="blob",a.send()}function Ae(e,t,a,r){var s=e.substr(e.lastIndexOf(".")+1);"jpg"==s||"jpeg"==s||"png"==s?xe(e,function(s){Se(s,r?"clip-img":"img",t,a?e:0)}):"gif"==s?function(e,t){var a=new Image;a.onload=function(){var e=document.createElement("canvas");e.width=this.naturalWidth,e.height=this.naturalHeight,e.getContext("2d").drawImage(this,0,0),t(e.toDataURL("image/png"))},a.src=e}(e,function(s){Se(s,r?"clip-img":"img",t,a?e:0)}):"svg"==s?De(e,r?"clip-svg":"svg",t,a):Fe(wcdp_translations.error_process)}function je(t,a,r){var s=e("#wcdp-images-panel .dp-box-img .mCSB_container");s.find(".dp-img-contain").length||s.html(""),s.append('<span class="dp-img-contain dp-'+a+'" data-name="'+r+'"><img class="loaded" src="'+t+'"/></span>')}function Se(e,t,r,s){j.show(),O.show();var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){var e=n.height/n.width,o=void 0!==wcdp_parameters.image_size?parseInt(wcdp_parameters.image_size):150,i=new fabric.Image(n,{top:40,left:40,clas:t,name:r,width:o,height:o*e,crossOrigin:"Anonymous"});a.discardActiveGroup().add(i).setActiveObject(i).renderAll(),ee(i),T(),j.hide(),O.hide(),s&&je(s,t,r)},n.src=e,n.onerror=function(){Fe(wcdp_translations.error_process)}}function De(t,r,s,n){j.show(),O.show(),fabric.loadSVGFromURL(t,function(o,i){var c=fabric.util.groupSVGElements(o,i),l=void 0!==wcdp_parameters.image_size?parseInt(wcdp_parameters.image_size):150,d=function(t){var a,r,s,n,o=void 0!==t.paramsCMYK?JSON.parse(t.paramsCMYK):{};return e.each(t.paths,function(e,t){for(var i=t,c="fill",l="transparent",d=t.fill?t.fill:l,p=0;p<2;p++){var u=[];if(1==p&&(c="stroke",d=(t=i).stroke?t.stroke:l),"linear"==d.type||"radial"==d.type)for(var f=0;f<d.colorStops.length;f++){var v={colorStops:f};v[c]=d.colorStops[f].color,u.push(v)}else{var h={colorStops:"patch"};h[c]=d,u.push(h)}for(var g=0;g<u.length;g++){var m=u[g].colorStops,w=u[g][c];"patch"!=m&&(t=d.colorStops[m]),(w.match(/^(rgb|rgba)\(\s*([0-9]){1,3}\s*,\s*([0-9]){1,3}\s*,\s*([0-9]){1,3}\s*,*\s*([0-9])*\.*([0-9])*\s*\)$/i)||w==l)&&(w=w==l?l:"#"+Ne(w),"patch"==m?t[c]=w:t.color=w);var _=o[w];_="#000000"==w?"0,0,0,100":void 0===_?"0,0,0,0":_,t[c+"CMYK"]=_,0==p?(a=w,s=_):(r=w,n=_)}}}),delete t.paramsCMYK,[a,s,r,n]}(c);c.set({top:50,left:50,clas:r,name:s,fill:d[0],fillCMYK:d[1],stroke:d[2],strokeCMYK:d[3]}).scaleToWidth(l).scaleToHeight(l*c.height/c.width),a.discardActiveGroup().add(c).setActiveObject(c).renderAll(),ee(c),T(),j.hide(),O.hide(),n&&je(t,r,s)})}function Oe(){if("backend"==wcdp_parameters.editor||"on"==wcdp_parameters.user_mask){var t=0,a=["images","cliparts"];for(var r in a){var s=e("#wcdp-"+a[r]+"-panel");if("block"==s.css("display")){t=s.find('.box__tool[data-id="mask"]');break}}if(t&&!t.hasClass("box__dsb")){var n=me(),o=t.find(".dp-remove-mask"),i=t.find(".mCSB_container");if(o.hide(),i.empty(),1==n.length&&("img"==n[0].clas||"clip-img"==n[0].clas)){var c=Ge(n=n[0]);n.mask&&o.show()}c||(c='<div class="dp-mask-guide"></div><label>'+wcdp_translations.no_mask+"</label>"),i.append(c)}}}e(window).resize(function(){var t=e(window).width();t!=z&&(z=t,B())}),e("#wcdp-zoom-canvas").on("input change",function(t){t.preventDefault();var r=e(this).val(),s=r/100,n=k;if(s==n)K();else if(s>n){var o=e("#wcdp-zoom-move"),i=o.find("span"),c=a.getWidth()-wcdp_parameters.canvas_w*s,l=a.getHeight()-wcdp_parameters.canvas_h*s,d=a.viewportTransform;o.fadeIn(),d[4]>=0?a.viewportTransform[4]=0:d[4]<c&&(a.viewportTransform[4]=c),d[5]>=0?a.viewportTransform[5]=0:d[5]<l&&(a.viewportTransform[5]=l),a.setZoom(s).calcOffset().renderAll();var p=a.viewportTransform,u=Math.abs(p[4]/(c/(o.width()-i.width())))+1,f=Math.abs(p[5]/(l/(o.height()-i.width())))+1;i.css({top:+f+"px",left:+u+"px"})}P(s),G(r)}),e("#wcdp-zoom-move span").draggable({containment:"#wcdp-zoom-move",drag:function(t){var r=a.getZoom(),s=e("#wcdp-zoom-move"),n=s.find("span"),o=e(this).position(),i=o.left*(a.getWidth()-wcdp_parameters.canvas_w*r)/(s.width()-n.width()),c=o.top*(a.getHeight()-wcdp_parameters.canvas_h*r)/(s.height()-n.width());a.viewportTransform[4]=i,a.viewportTransform[5]=c,a.renderAll()},stop:function(e){var t=a.getActiveGroup(),r=a.getObjects();t&&t.setCoords();for(var s=r.length-1;s>=0;s--)r[s].setCoords();a.renderAll()}}),e("#wcdp-tabs-content").on("mouseenter mouseleave",".dp-img-res, .dp-img-contain, .dp-my-design-cover",function(t){if(t.preventDefault(),"on"==wcdp_style.popup_show)if(g){var a=e(this),r=a.find("img"),s=a.attr("data-source"),n=a.parents(".wcdp-tab-section").attr("id").slice(5,-6),o=s||("images"==n||"my-designs"==n?r.attr("src"):r.attr("data-src"));o&&function(t,a,r){var s=t.attr("data-name"),n=t.attr("data-tags"),o=e("#wcdp-thumbs-preview"),i=o.find(".dp-title"),c=o.find("picture"),l=o.find(".dp-tags"),d=o.data("activetimer");if("mouseenter"==r){d&&(clearTimeout(d),o.removeData("activetimer")),i.html()&&i.empty(),l.html()&&l.empty(),c.removeAttr("style class"),o.addClass("loading-thumb-preview").show();var p=new Image;p.crossOrigin="Anonymous",p.onload=function(){c.css("background-image","url("+this.src+")").addClass("loaded"),o.removeClass("loading-thumb-preview"),s&&i.html(s),n&&l.html(n)},p.src=a}else"mouseleave"==r&&(d=setTimeout(function(){o.hide()},250),o.data("activetimer",d))}(a,o,t.type)}else e("#wcdp-thumbs-preview").hide()}),e(".post-type-wcdp-designs #publish").click(function(t){e(this).attr("data-save")||(t.preventDefault(),W("publish"))}),e("#wcdp-btn-save").parent().click(function(t){if(t.preventDefault(),"frontend"==wcdp_parameters.editor){var a=wcdp_settings.number_save_user?wcdp_settings.number_save_user:"unlimited";if("unlimited"==a||n<a){var r=wcdp_parameters.productName;new jBox("Confirm",{title:wcdp_translations.design_title,content:'<input type="text" class="dp-design-name" placeholder="'+r+'"/>',addClass:"jBox-Modal"+(d?" md__rtl":""),closeOnEsc:!0,closeButton:"title",cancelButton:wcdp_translations.cancel,confirmButton:wcdp_translations.save_design,confirm:function(){var t=e("#"+this.id).find(".dp-design-name").val();h=""!=t?t:r,W("save")},onCloseComplete:function(){this.destroy()}}).open()}else Fe(wcdp_translations.save_max_user+": "+(a<=0?0:a))}else Ue(wcdp_translations.save_content,function(){W("save")})}),fabric.util.object.extend(fabric.Canvas.prototype,{_setSVGObjects:function(e,t){var a,r=x(),s=!("on"!=wcdp_parameters.bleed_clip||!r);if(s){var n=r.r<=0?0:r.r;e.push('<clipPath id="wcdp-bleed-area"><rect x="'+r.x+'" y="'+r.y+'" rx="'+n+'" ry="'+n+'" width="'+r.w+'" height="'+r.h+'"></rect></clipPath><g clip-path="url(#wcdp-bleed-area)">')}for(var o=0,i=this.getObjects(),c=i.length;o<c;o++)(a=i[o]).excludeFromExport||this._setSVGObject(e,a,t);s&&e.push("</g>")}}),e("#wcdp-my-designs-panel").on("click",".dp-my-design-cover",function(t){t.preventDefault();var a=e(this).parent();a.attr("page-id")?Ue(wcdp_translations.load,function(){window.open(SITE_URL+"/?page_id="+a.attr("page-id")+"&dp_mode=save&design_id="+a.attr("sid"),"_self")}):Fe(wcdp_translations.product_id+' <b>"'+a.attr("pid")+'"</b> '+wcdp_translations.product_unavailable)}),e("#wcdp-my-designs-panel").on("click",".dp-remove-my-design",function(t){t.preventDefault();var a=e(this).parent(),r=a.attr("sid"),s=a.find(".dp-loader-box");Ue(wcdp_translations.delete,function(){s.show(),O.show(),e.ajax({url:AJAX_URL,type:"POST",data:{action:"wcdp_remove_canvas_design_ajax",designID:r},success:function(t){if("delete_successful"==t){if(a.remove(),n--,0==e(".dp-my-design-contain").length){var r='<div class="dp-label-center">';r+='<span class="dp-search-empty" id="wcdp-btn-mydesigns-empty"></span>',r+="<label>"+wcdp_translations.no_designs+"</label></div>",e("#wcdp-my-designs-panel .dp-contain-box .mCSB_container").append(r)}}else Fe(wcdp_translations.error_process);s.hide(),O.hide()}})})}),e("#wcdp-download-my-design").click(function(e){e.preventDefault(),Ue(wcdp_translations.download_content,function(){W("download")})}),e('#wcdp-settings-panel .variations [data-layout="product_colors"] .dp-attr-colors span').click(function(t){t.preventDefault();var a=e(this),r="sp-thumb-active";if(!a.hasClass(r)){var s=a.attr("name"),n=a.css("background-color"),o="sp-thumb-dark",i="sp-thumb-light";a.parent().find("span").removeClass(r+" "+o+" "+i),a.addClass(r+" "+("rgba(0, 0, 0, 0)"!=n?tinycolor("#"+Ne(n)).toHsl().l<.5?o:i:"")),a.closest(".dp-row").find("select").val(s).change()}}),e('#wcdp-settings-panel .variations [data-layout="radio_checkbox"] .dp-attr-radio input').change(function(t){t.preventDefault();var a=e(this),r=a.val();a.closest(".dp-row").find("select").val(r).change()}),e("#wcdp-settings-panel .variations select").on("change",function(t){t.preventDefault(),e(this).val()&&N(this,!0)}),e("#wcdp-btn-addtocart").parent().click(function(t){t.preventDefault();var a=e("#wcdp-product-input-qty"),r=a.find("input").val();if(a.length>0)if(r>0){var s={type:u,variation_id:0,attributes:{},qty:r};if("variable"==u){var n=e("#wcdp-settings-panel .variations .dp-row");if(!e(".woocommerce-variation-add-to-cart").hasClass("woocommerce-variation-add-to-cart-enabled"))return n.find("select").each(function(){e(this).val()||e(this).parent().addClass("dp-disabled")}),e("#wcdp-btn-settings").hasClass("vtab-selected")||H("wcdp-btn-settings"),Fe(wcdp_translations.addtocart_disabled),!1;n.each(function(){var t=e(this).find("select").attr("data-attribute_name"),a=e(this).find("select option:selected").val();s.attributes[t]=a}),s.variation_id=e("#wcdp-variation-id").val()}var o=function(){W("addtocart",s)},i=e("<div/>").html(wcdp_settings.text_confirm_box).text(),c=wcdp_settings.label_confirm_box;if(wcdp_settings.confirm_box&&i&&c)var l=new jBox("Confirm",{id:"wcdp-confirm-design",addClass:d?"md__rtl":"",content:i+'<label><input type="checkbox"/>'+c+"</label>",cancelButton:wcdp_translations.cancel,confirmButton:wcdp_translations.confirm,closeOnConfirm:!1,confirm:function(){if(e("#wcdp-confirm-design input").is(":checked"))l.close(),o();else{var t="dp-no-approved",a=e("#wcdp-confirm-design label");a.addClass(t),setTimeout(function(){a.removeClass(t)},1e3)}},onCloseComplete:function(){this.destroy()}}).open();else o()}else Fe(wcdp_translations.qty_zero);else Fe(wcdp_translations.out_stock)}),e("#wcdp-settings-panel .variations .dp-row").on("change","select",function(t){t.preventDefault(),e(this).val()&&e(this).parent().removeClass("dp-disabled")}),e(document).on("change","#wcdp-confirm-design input",function(t){t.preventDefault();var a=e(this).parent();a.removeAttr("class"),e(this).is(":checked")&&a.addClass("dp-approved")}),e("#wcdp-tabs-icons > span").click(function(t){t.preventDefault(),a.deactivateAll().renderAll(),q(!1),H(e(this).attr("id"))}).eq(0).click(),a.on("object:selected",function(t){var a=t.target;if(b)Re("clear"),me().forEach(function(e){Re("select",e.id)});else if("i-text"==a.clas){H("wcdp-btn-text"),be(a,e(".dp-col-8 span"),_e()),e("#wcdp-text-fontFamily").val(a.fontFamily),e("#wcdp-text-fontSize").val(a.fontSize),e("#wcdp-text-color-font").spectrum("set",a.fill).spectrum("setCMYK",a.fillCMYK),e("#wcdp-text-outline-color").spectrum("set",a.stroke).spectrum("setCMYK",a.strokeCMYK),e("#wcdp-text-stroke").val(a.strokeWidth),e("#wcdp-text-opacity").val(a.opacity);var r=e("#wcdp-new-textbox"),s="placeholder",n=wcdp_translations.new_text;a.text==n?r.attr(s,n).val(""):1==a[s]?r.attr(s,a.text).val(""):r.val(a.text).removeAttr(s),r.removeAttr("disabled");var o="i-text"==a.type,i=o?300:a.radius,c=o?a.charSpacing/25:a.spacing,l=o?"none":1==a.reverse?"reverse":a.effect;e("#wcdp-text-radius").val(i),e("#wcdp-text-spacing").val(c),e("#wcdp-text-curved").val(l)}else if("img"==a.clas||"svg"==a.clas||"groupSVG"==a.clas){H("wcdp-btn-images"),Z(a,"images");var d=a._objects?a._objects[0]:a.paths?a.paths[0]:a;e("#wcdp-svg-stroke").val(d.strokeWidth),e("#wcdp-image-opacity").val(d.opacity)}else"shap"==a.clas?(H("wcdp-btn-shapes"),e("#wcdp-shap-color").spectrum("set",a.fill).spectrum("setCMYK",a.fillCMYK),e("#wcdp-shap-outline-color").spectrum("set",a.stroke).spectrum("setCMYK",a.strokeCMYK),e("#wcdp-shap-stroke").val(a.paths?a.paths[0].strokeWidth:a.strokeWidth),e("#wcdp-shap-opacity").val(a.opacity)):"clip-img"==a.clas||"clip-svg"==a.clas?(H("wcdp-btn-cliparts"),Z(a,"cliparts"),e("#wcdp-clip-svg-stroke").val(a.paths?a.paths[0].strokeWidth:a.strokeWidth),e("#wcdp-clipart-opacity").val(a.opacity)):"qr"==a.clas?(H("wcdp-btn-qr"),e("#wcdp-bg-qr-color").spectrum("set",a.paths[0].fill).spectrum("setCMYK",a.paths[0].fillCMYK),e("#wcdp-fg-qr-color").spectrum("set",a.paths[1].fill).spectrum("setCMYK",a.paths[1].fillCMYK),e("#wcdp-text-box-qr").val(a.dataDP.text),e("#wcdp-qr-level").val(a.dataDP.level),e("#wcdp-qr-border").val(a.dataDP.border),e("#wcdp-qr-range").val(a.dataDP.range)):"maps"==a.clas&&(H("wcdp-btn-maps"),e("#wcdp-map-icon-color").spectrum("set",a.dataDP.fill).spectrum("setCMYK",a.dataDP.fillCMYK),e("#wcdp-text-box-map").val(a.dataDP.address.replace(/\+/g," ")),e("#wcdp-map-zoom").val(a.dataDP.zoom),e("#wcdp-map-type").val(a.dataDP.type),e("#wcdp-map-icon-size").val(a.dataDP.size),e("#wcdp-map-icon-label").val(a.dataDP.label));!function(e){var t=e.clas,a="backend"==wcdp_parameters.editor||"on"==wcdp_parameters.ungroup_svg;ce("group"),("grouped"==t||a&&("groupSVG"==t||"qr"!=t&&"path-group"==e.type&&e.paths.length>1))&&ce("ungroup")}(a),R("bring"),q(!0)}),a.on("selection:cleared",V),e("body").on("mousedown, keydown","input[type=text], input[type=number], [contenteditable], textarea",function(e){e.stopPropagation(),document.onkeydown&&(document.onkeydown=null)}),a.on("text:editing:entered",function(e){e.target.placeholder=!1,document.onkeydown=null}).on("text:changed",function(t){e("#wcdp-new-textbox").val(t.target.text)}),e("#wcdp-btn-info").jBox("Modal",{animation:"zoomIn",closeButton:"title",draggable:"title",maxHeight:600,title:wcdp_translations.shortcuts.title,content:function(){var e="<ul>",t=wcdp_shortcutkeys;"typeF"==wcdp_parameters.type&&(t.clone_sides_ck=!1);for(var a in t)if("on"!=t[a]&&"on"==t[a+"_ck"]){var r=t[a].split("+");r=1==r.length?wcdp_translations.shortcuts.keyCodes[r[0]]:r[0]+"+"+wcdp_translations.shortcuts.keyCodes[r[1]],e+="<li><b>"+r.toUpperCase()+":</b> "+wcdp_translations.shortcuts[a]+"</li>"}void 0===r&&(e+="<li>"+wcdp_translations.shortcuts.keys_empty+"</li>");return e+"</ul>"}(),addClass:d?"md__rtl":""}),e("#wcdp-btn-select-all").click(function(e){e.preventDefault(),a.discardActiveObject(),a.discardActiveGroup();for(var t=[],r=a.getObjects(),s=r.length-1;s>=0;s--)r[s].selectable&&t.push(r[s].set("active",!0));1==t.length?a.setActiveObject(t[0]):t.length>1&&re(t.reverse()),a.renderAll()}),e("#wcdp-btn-clear").click(function(e){e.preventDefault(),Ue(wcdp_translations.clear,function(){a.discardActiveGroup();for(var e=a.getObjects(),t=e.length-1;t>=0;t--)e[t].selectable&&a.remove(e[t]);j.show(),Y().then(function(){T(),j.hide(),Ke()})})}),e("#wcdp-btn-grid").click(function(t){t.preventDefault();var r="btn-enabled";e(this).hasClass(r)?(a.remove(c),e(this).removeClass(r)):(a.add(c),e(this).addClass(r)),a.renderAll()}),a.on("object:moving",function(t){var a=t.target;if(e("#wcdp-btn-grid").hasClass("btn-enabled")){var r=wcdp_parameters.grid_size;a.set({left:Math.round(a.left/r)*r,top:Math.round(a.top/r)*r})}else if("on"==wcdp_style.auto_snap){a.setCoords();var s=parseInt(wcdp_style.snap_tolerance>=1?wcdp_style.snap_tolerance:5),n=this.getZoom(),o=this.viewportTransform,i=a.getPointByOrigin("center","center"),c=a.getBoundingRect(),l=x(),d=l?l.w/2+l.x:wcdp_parameters.canvas_w/2,p=l?l.h/2+l.y:wcdp_parameters.canvas_h/2,u="none",f="none",v=0,h=0;this.forEachObject(function(e){if("bleed"!=e.clas&&"grid"!=e.clas&&e!=a&&!e.active){var t=e.getBoundingRect();Math.abs(c.left-t.left)<s&&(i.x=(t.left-o[4]+c.width/2)/n,v=t.left,u="block"),Math.abs(c.left+c.width-t.left)<s&&(i.x=(t.left-o[4]-c.width/2)/n,v=t.left,u="block"),Math.abs(c.left-t.left-t.width)<s&&(i.x=(t.left-o[4]+t.width+c.width/2)/n,v=t.left+t.width,u="block"),Math.abs(c.left+c.width-t.left-t.width)<s&&(i.x=(t.left-o[4]+t.width-c.width/2)/n,v=t.left+t.width,u="block"),Math.abs(c.top-t.top)<s&&(i.y=(t.top-o[5]+c.height/2)/n,h=t.top,f="block"),Math.abs(c.top+c.height-t.top)<s&&(i.y=(t.top-o[5]-c.height/2)/n,h=t.top,f="block"),Math.abs(c.top-t.top-t.height)<s&&(i.y=(t.top-o[5]+t.height+c.height/2)/n,h=t.top+t.height,f="block"),Math.abs(c.top+c.height-t.top-t.height)<s&&(i.y=(t.top-o[5]+t.height-c.height/2)/n,h=t.top+t.height,f="block")}}),Math.abs(c.left-o[4]+c.width/2-d*n)<s&&(i.x=d,v=d*n+o[4],u="block"),Math.abs(c.top-o[5]+c.height/2-p*n)<s&&(i.y=p,h=p*n+o[5],f="block"),"block"!=u&&"block"!=f||(a.setPositionByOrigin(i,"center","center"),a.setCoords()),D.css({display:u,left:v+"px"}),S.css({display:f,top:h+"px"})}}),e("#wcdp-btn-center-h, #wcdp-btn-center-v").click(function(t){t.preventDefault(),ne(e(this).attr("id").substring(9))}),e("#wcdp-btn-flipX, #wcdp-btn-flipY").click(function(t){t.preventDefault(),qe({obj:"all",set:{toggle:e(this).attr("id").substring(9)}})}),e("#wcdp-btn-rotate").click(function(e){e.preventDefault(),qe({obj:"all",set:{angle:"obj.getAngle()-15"},cmd:!0});var t=a.getActiveGroup();t&&(t.addWithUpdate(),a.renderAll())}),e("#wcdp-btn-bringForward, #wcdp-btn-sendBackwards").click(function(t){t.preventDefault();var r=e(this).attr("id").substring(9),s=a.getActiveObject();if(!s)return!1;s[r](),R("bring"),a.renderAll(),T(),Ke()}),e("#wcdp-btn-lock").click(function(e){e.preventDefault(),oe()}),a.on("mouse:dblclick",oe).on("mouse:down",function(e){ie(e.target,!0)}).on("mouse:up",function(e){a.selection||(a.selection=!0),"remove"==y?ge():"duplicate"==y&&fe(),y=0,D.hide(),S.hide(),Oe()}).on("mouse:move",function(e){var t=e.target;t&&(t.selectable?t.set("hoverCursor","move"):t.set("hoverCursor","pointer"))}).on("object:added",function(e){var t=e.target;t.lockMovementX&&t.set({selectable:!1,lockMovementX:!1,lockMovementY:!1}),_&&_.active&&(ce("lock"),_.active=!1),"on"==wcdp_parameters.bleed_clip&&i&&"bleed"!=t.clas&&"grid"!=t.clas&&"function"!=typeof t.clipTo&&t.set("clipTo",function(e){try{return this._drawClipArea(e)}catch(e){}}),t.id||t.set("id",Ze()),t.layerThumb||Pe(t),t.lockUser&&"frontend"==wcdp_parameters.editor&&t.set({evented:!1,selectable:!1}),"on"==wcdp_style.hide_middle_corners&&t.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1}),t.setCoords(),setTimeout(function(){Oe()},100)}),e("#wcdp-btn-group").click(function(t){t.preventDefault();var r,s=me(),n="backend"==wcdp_parameters.editor||"on"==wcdp_parameters.ungroup_svg;1==s.length?"grouped"==s[0].clas||n&&"groupSVG"==s[0].clas?(r=s[0],j.show(),O.show(),setTimeout(function(){var e=r._objects;r._restoreObjectsState();for(var t=0;t<e.length;t++)a.add(e[t]).item(a.size()-1).set("active",!0);a.remove(r),re(e),a.renderAll(),T(),j.hide(),O.hide(),Ke()},100)):n&&"qr"!=s[0].clas&&"path-group"==s[0].type&&s[0].paths.length>1&&function(t){j.show(),O.show(),setTimeout(function(){for(var r=0;r<t.paths.length;r++){var s=t.paths[r];if(s._removeTransformMatrix(),"text"==s.type){for(var n=0,o=Math.abs(s.fontSize-p[0]),i=s.fontFamily.replace(/["']/g,"").split(",")[0],c=s.strokeWidth?Math.round(10*s.strokeWidth)/10:0,l=s.width,d=s.height,u=1;u<p.length;u++){var f=Math.abs(s.fontSize-p[u]);f<o&&(o=f,n=u)}(s=new fabric.IText(s.text,{clas:"i-text",top:s.top,left:s.left,fontSize:p[n],fontStyle:s.fontStyle?s.fontStyle:"",fontWeight:s.fontWeight?s.fontWeight:"",textAlign:s.textAlign?s.textAlign:"left",textDecoration:s.textDecoration?s.textDecoration:"",fill:s.fill?s.fill:"transparent",fillCMYK:s.fillCMYK?s.fillCMYK:"0,0,0,0",stroke:s.stroke?s.stroke:"transparent",strokeCMYK:s.strokeCMYK?s.strokeCMYK:"0,0,0,0",strokeWidth:c>10?10:c,strokeLineJoin:"round",fontFamily:-1==e.inArray(i,w)?"titillium":i})).set({scaleX:l/s.width,scaleY:d/s.height})}else if("image"==s.type)s.clas=t.clas.replace("svg","img");else{var v=s.strokeWidth?Math.round(s.strokeWidth):0;s.set({clas:t.clas,opacity:s.opacity?s.opacity:1,fill:s.fill?s.fill:"transparent",fillCMYK:s.fillCMYK?s.fillCMYK:"0,0,0,0",stroke:s.stroke?s.stroke:"transparent",strokeCMYK:s.strokeCMYK?s.strokeCMYK:"0,0,0,0",strokeWidth:v>50?50:v})}t.paths[r]=s,s.set({id:Ze(),layerThumb:!0}),a.add(s).item(a.size()-1).set("active",!0)}var h=new fabric.Group(t.paths,{skewX:t.skewX,scaleX:t.scaleX,scaleY:t.scaleY,canvas:a}).addWithUpdate(null).setAngle(t.getAngle());h.set({top:t.top,left:t.left,width:t.getWidth(),height:t.getHeight()}).addWithUpdate().setCoords(),a.trigger("selection:created",{target:h}),a.remove(t).setActiveGroup(h).renderAll(),h.getObjects().forEach(function(e){Pe(e)}),T(),j.hide(),O.hide(),Ke()},100)}(s[0]):s.length>1&&function(e,t){j.show(),O.show(),setTimeout(function(){var r=!0,s=a.getActiveGroup();"clone"==s.clas&&s._objects.reverse(),s.clone(function(s){a.discardActiveGroup(),e.forEach(function(e){"path-group"!=e.type&&"grouped"!=e.clas&&"groupSVG"!=e.clas||(r=!1),a.remove(e)}),s.clas=t&&r?"groupSVG":"grouped",a.add(s).setActiveObject(s).renderAll(),T(),j.hide(),O.hide(),Ke()})},100)}(s,n)}),e("#wcdp-btn-duplicate").click(function(e){e.preventDefault(),fe()}),e("#wcdp-btn-delete").click(function(e){e.preventDefault(),ge()}),e("#wcdp-btn-undo, #wcdp-btn-redo").click(function(t){t.preventDefault();var r=e("#wcdp-canvas-thumbs-container .dp-canvas-active").attr("data-id"),s=wcdp_parameters.jsonStates[r];"undo"==e(this).attr("id").substring(9)?s--:s++,e(this).hasClass("btn-disabled")||(a.clear(),wcdp_parameters.jsonStates[r]=s,a.loadFromJSON(JSON.parse(wcdp_parameters.jsonSides[r][s]),function(){a.renderAll.bind(a),X(),Be(0),R("add"),Ke()}),le(r))}),e("#wcdp-btn-preview").click(function(t){if(t.preventDefault(),"on"==wcdp_parameters.preview_e){var a=e(this),r="btn-enabled",s=e("#wcdp-canvas-thumbs-container div");a.addClass(r),de().then(function(){1==s.length?(a.removeClass(r),ue()):s.not(".dp-canvas-active").click()})}}),e("#wcdp-templates-panel .dp-tpl-content").on("click",".dp-img-contain",function(t){t.preventDefault();var r=e(this),s=r.attr("page-id"),n=r.attr("design-id");if("on"===wcdp_parameters.loadObjs){j.show(),O.show();var o=WCDP_URL_UPLOADS+"/save-admin/designID"+n+"/front.json";e.getJSON(o+"?"+(new Date).getTime(),function(e){a.discardActiveObject(),a.discardActiveGroup();for(var t=a.getObjects(),r=t.length-1;r>=0;r--)"bleed"!=t[r].clas&&"grid"!=t[r].clas&&a.remove(t[r]);if(e.objects&&e.objects.length>0){var s=[];e.objects.forEach(function(e){"i-text"==e.clas&&-1==s.indexOf(e.fontFamily)&&s.push(e.fontFamily)}),Xe(s).then(function(){fabric.util.enlivenObjects(e.objects,function(e){if(1==e.length){var t=e[0];a.add(t)}else if(e.length>1){e.forEach(function(e){a.add(e)}),re(e);t=a.getActiveGroup()}var r=t.getPointByOrigin("center","center"),s=x();r.x=s?s.w/2+s.x:wcdp_parameters.canvas_w/2,r.y=s?s.h/2+s.y:wcdp_parameters.canvas_h/2,t.setPositionByOrigin(r,"center","center"),t.setCoords(),a.discardActiveGroup(),a.renderAll(),T(),j.hide(),O.hide()})})}else j.hide(),O.hide()}).fail(function(e){Fe(wcdp_translations.error_process),j.hide(),O.hide()})}else"on"===wcdp_parameters.loadAjax&&s?(j.show(),O.show(),e.ajax({url:AJAX_URL,type:"POST",data:{action:"wcdp_get_json_design_ajax",designID:n},success:function(t){var r=JSON.parse(t);r?setTimeout(function(){Xe(r.fontsDesign).then(function(){if(wcdp_parameters.paramID!==r.paramID){for(var t=["border_bleed_e","auto_hide_bleed","bleed_clip","border_bleed_w","margin_bleed_lr","margin_bleed_tb","bleed_top","bleed_left","bleed_radius","canvas_h","canvas_w","font_size","image_size","shape_size","qr_size","grid_size","label_f","label_b","maps_h","maps_w","output_w","paramID","pdf_h","pdf_margin","pdf_w","pdf_scale","pdf_strech","preview_w","radius","type","watermark_img","watermark_rep","hide_bc","hide_bg","hide_ov"],o=0;o<t.length;o++)wcdp_parameters[t[o]]=r[t[o]];i=C(),c=se(),a.setWidth(r.canvas_w),a.setHeight(r.canvas_h);var l={front:r.label_f},d=e("#wcdp-canvas-thumbs-container"),p=100*r.canvas_h/r.canvas_w+"px",u='style="height:'+p+'"';for(var f in d.empty(),"typeF"!=r.type&&(l.back=r.label_b),l)d.append('<div data-id="'+f+'"><img width="100" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="'+u+"/><label>"+l[f]+"</label></div>");e("#wcdp-zoom-move").css("height",p)}B(),wcdp_parameters.pageID=s,wcdp_parameters.designID=n,wcdp_parameters.jsonSides=r.jsonSides,wcdp_parameters.jsonStates=r.jsonStates,J(),M(Object.keys(wcdp_parameters.jsonSides).reverse(),0)})},100):(Fe(wcdp_translations.error_process),j.hide(),O.hide())}})):s?Ue(wcdp_translations.load_template,function(){window.open(SITE_URL+"/?page_id="+s+"&dp_mode=designer&product_id="+wcdp_parameters.productID+"&design_id="+n,"_self")}):Fe(wcdp_translations.template_id+' <b>"'+n+'"</b> '+wcdp_translations.product_unavailable)}),e("#wcdp-text-panel .dp-col-8 span").click(function(t){t.preventDefault();var a=_e(),r=e(this).attr("id").substring(9),s="",n={};e.map(a,function(e,t){-1!=e.indexOf(r)&&(s=t)}),n[s]=r,qe({obj:"i-text",set:n,default:!0});var o=me();1==o.length&&be(o[0],e(".dp-col-8 span"),a)}),e("#wcdp-text-fontFamily, #wcdp-text-fontSize").change(function(t){t.preventDefault();var a={};a[e(this).attr("id").substring(10)]=e(this).val(),qe({obj:"i-text",set:a,point:!0})}),e("#wcdp-text-radius, #wcdp-text-spacing, #wcdp-text-opacity").on("input change",function(t){t.preventDefault();var a={},r=e(this).attr("id").substring(10);a[r]=e(this).val(),qe({obj:"i-text",set:a,save:!1,point:"opacity"!=r}),"change"==t.type&&T()}),e("#wcdp-add-new-text").click(function(t){t.preventDefault();var r=wcdp_translations.new_text;e("#wcdp-new-textbox").attr("placeholder",r);var s=new fabric.IText(r,{placeholder:!0,clas:"i-text",left:50,top:50,textAlign:d?"right":"left",fontFamily:"titillium",fontSize:wcdp_parameters.font_size,fill:wcdp_style.text_color_editor.RGB,fillCMYK:wcdp_style.text_color_editor.CMYK,stroke:wcdp_style.text_color_editor_outline.RGB,strokeCMYK:wcdp_style.text_color_editor_outline.CMYK,strokeWidth:0});a.discardActiveGroup().add(s).renderAll().setActiveObject(s),ee(s),T()}),e("#wcdp-new-textbox").keyup(function(t){t.preventDefault(),qe({obj:"i-text",set:{writeText:e(this).val(),placeholder:!1},point:!0})}),wcdp_spectrum_functions.change_text_color=function(e,t){qe({obj:"i-text",set:{fill:"#"+e,fillCMYK:t},save:!1})},e("#wcdp-text-stroke").change(function(t){t.preventDefault(),qe({obj:"i-text",set:{strokeWidth:parseFloat(e(this).val()),strokeLineJoin:"round"}})}),wcdp_spectrum_functions.change_text_color_outline=function(e,t){qe({obj:"i-text",set:{stroke:"#"+e,strokeCMYK:t},save:!1})},e("#wcdp-text-curved").change(function(t){t.preventDefault();var r=me();if(1==r.length&&"grouped"!=r[0].clas){var s="IText",n=r[0].toObject(),o={textAlign:"center",radius:150,spacing:10,effect:e(this).val(),reverse:!1};for(var i in delete n.type,o)delete n[i];if("none"!=e(this).val()){for(var c in s="CurvedText",o)n[c]=o[c];"reverse"==e(this).val()&&(n.reverse=!0,n.effect="curved")}s=new fabric[s](r[0].getText(),n),a.add(s).renderAll().setActiveObject(s).remove(r[0]),T()}}),e("#wcdp-upload-images").click(function(t){t.preventDefault(),e(this).prev().click()}),e("#wcdp-ajax-upload-user").change(function(t){t.preventDefault();var a=e(this).prop("files")[0];if(void 0!==a){var r=a.name.split(".").pop(),s=["jpg","jpeg","png","gif"];if("on"==wcdp_settings.upload_svg&&s.push("svg"),-1===e.inArray(r.toLowerCase(),s))Fe(wcdp_translations.supported+" "+s.toString());else{j.show(),O.show();var n=new FormData;n.append("file",a),n.append("action","wcdp_upload_img_file_ajax"),e.ajax({url:AJAX_URL,type:"POST",contentType:!1,processData:!1,data:n,success:function(e){var t=JSON.parse(e);t.success?Ae(t.url,t.filename,!0):(o(),Fe(wcdp_translations.error_process))},error:function(e){o(),Fe(e.statusText)}})}var o=function(){j.hide(),O.hide()}}}),e.wcdp_upload_file_wp_enqueue_media_backend=function(e,t){Ae(e,t,!0)},e("#wcdp-images-panel .dp-hori-tab span").click(function(t){t.preventDefault();var a=e(this).attr("data-id"),r=e("#wcdp-images-panel"),s="dp-mode-upload",n="dp-mode-sources",o="htab-selected",i=r.find(".dp-hori-tab");if(e(this).hasClass(o))e("#wcdp-box-"+a).hasClass("dp-loading-sources")||"upload"==a||r.find(".dp-row.md__res").eq(1).toggleClass("md__dsb");else if(i.find("span").removeClass(o),i.find('[data-id="'+a+'"]').addClass(o),"upload"==a)r.removeClass(n).addClass(s);else{var c=wcdp_translations.search_in+" "+Ve(a);e("#wcdp-text-box-search-res").attr("placeholder",c),r.removeClass(s).addClass(n),ye()}}),e("#wcdp-btn-search-res").click(function(e){e.preventDefault(),ye()}),e("#wcdp-text-box-search-res").keyup(function(e){e.preventDefault(),13===e.keyCode&&ye()}),e("#wcdp-images-panel .dp-contain-res").on("click",".dp-img-res",function(t){t.preventDefault(),j.show(),O.show();var a=e(this),r=a.attr("data-source"),s=a.parents(".dp-res-content").attr("id").substring(9);"flaticon"!=s&&"on"==wcdp_settings.CMYK&&"on"==wcdp_settings.sources_cmyk?e.ajax({url:AJAX_URL,type:"POST",data:{action:"wcdp_convert_resource_cmyk",url:r},success:function(e){var t=JSON.parse(e);t.success?Se(t.string,"img"):(Fe(wcdp_translations.error_process),j.hide(),O.hide())}}):"flaticon"==s&&"on"==wcdp_settings.flaticon_svg?De(r,"svg"):xe(r,function(e){Se(e,"img")})}),e("#wcdp-images-panel .dp-box-img").on("click",".dp-img-contain",function(t){t.preventDefault();var a=e(this);Ae(a.find("img").attr("src"),a.attr("data-name"))}),e("#wcdp-tabs-content .dp-toolbar-img span").click(function(t){t.preventDefault();var r,s,n,o,i,c,l,p=e(this),u=p.attr("data-id");if("fill"==u||"filters"==u||"mask"==u){var f=e(".dp-toolbar-img"),v=e(".wcdp-tab-section"),h="opt-selected",g="box__dsb";p.hasClass(h)?(f.find('[data-id="'+u+'"]').removeClass(h),v.find('.dp-row[data-id="'+u+'"]').addClass(g)):(f.find("span").removeClass(h),v.find(".dp-row.box__tool").addClass(g),f.find('span[data-id="'+u+'"]').addClass(h),v.find('.dp-row.box__tool[data-id="'+u+'"]').removeClass(g)),Oe()}else"crop"==u?function(){var t=me();if(1==t.length&&("img"==t[0].clas||"clip-img"==t[0].clas||"maps"==t[0].clas)){var a=wcdp_translations,r={move:a.move,crop:a.crop,square:a.square,"zoom-in":a.zoom_in,"zoom-out":a.zoom_out,"reset-resize":a.reset,cancel:a.cancel,save:a.save_crop},s=new Image;s.onload=function(){var a='<div id="wcdp-crop-resize"><img src="'+this.src+'"/></div><div id="wcdp-crop-tools">';for(var s in r)a+="cancel"==s||"save"==s?'<span id="wcdp-crp-'+s+'">'+r[s]+"</span>":'<span class="dp-tooltip'+("crop"==s?" btn-enabled":"")+'" title="'+r[s]+'" id="wcdp-btn-'+s+'"></span>';a+="</div>",Me.contain=new jBox("Modal",{id:"wcdp_cropper_contain",addClass:d?"md__rtl":"",content:a,closeButton:!1,onCloseComplete:function(){this.destroy(),Me.tooltip.destroy()}}).open();var n=e("#wcdp-crop-resize img").get(0);Me.image={obj:t[0]},Me.tooltip=Ee("#wcdp-crop-tools .dp-tooltip"),Me.cropper=new Cropper(n,{toggleDragModeOnDblclick:!1,crop:function(e){Me.image.coords=e.detail}})},s.src=t[0]._element.src}}():"ov"==u||"bg"==u?(r=u,s=me(),o=a[n=("bg"==r?"background":"overlay")+"Image"],i=1==s.length,c=i&&s[0],l=c&&c.clas,(o||i&&(c.paths&&("svg"==l||"clip-svg"==l)||"groupSVG"==l||"img"==l||"clip-img"==l||"maps"==l))&&(j.show(),setTimeout(function(e){if(e&&a.discardActiveObject(e),o){var t=o.dataDP;a.discardActiveGroup(),a[n]=null,void 0===t?Se(o._element.src,"img"):new(fabric[fabric.util.string.camelize(fabric.util.string.capitalize(t.type))].fromObject)(t,function(e){a.add(e).setActiveObject(e).renderAll(),T()})}if(i){var s="",c=e.toObject();if("image"==e.type)s=e._element.src;else{var l=a.viewportTransform[0];a.setZoom(1),s=e.toDataURL({multiplier:wcdp_parameters.output_w/(e.width*e.scaleX)}),a.setZoom(l)}s&&(function(e,t,r){var s=new Image;s.crossOrigin="Anonymous",s.onload=function(){var e=new fabric.Image(s,{left:0,top:0,dataDP:t,opacity:t.opacity,crossOrigin:"Anonymous",width:parseInt(wcdp_parameters.canvas_w),height:parseInt(wcdp_parameters.canvas_h)});"bg"==r?a.setBackgroundImage(e).renderAll():"ov"==r&&a.setOverlayImage(e).renderAll(),T()},s.src=e,s.onerror=function(){Fe(wcdp_translations.error_process)}}(s,c,r),a.remove(e))}j.hide()},100,c))):"angle"==u&&function(){var e=a.backgroundImage;if(e){var t=e.angle,r=parseInt(wcdp_parameters.canvas_w),s=parseInt(wcdp_parameters.canvas_h);t=270==t?0:t+=90,e.set({top:180==t||270==t?s:0,left:90==t||180==t?r:0,width:90==t||270==t?s:r,height:90==t||270==t?r:s,angle:t}),a.renderAll(),T()}}()}),e("#wcdp-tabs-content").on("click",".dp-contain-mask .dp-layer-row",function(t){if(t.preventDefault(),1==(r=me()).length&&("img"==r[0].clas||"clip-img"==r[0].clas)){var r=r[0],s=we(e(this).attr("data-id"));s&&(j.show(),O.show(),setTimeout(function(){var e=a.viewportTransform[0];a.setZoom(1),s.clipTo=null;var t=s.toDataURL({multiplier:wcdp_parameters.output_w/(s.width*s.scaleX)});s.visible=!1,a.setZoom(e);var n=new Image;n.onload=function(){r.getMaskLayer(s,n,function(e){r.setSrc(e.mask,function(){a.remove(s),a.renderAll(),T(),j.hide(),O.hide(),Oe()},e.params)})},n.src=t},1))}}),e("#wcdp-tabs-content .dp-remove-mask").click(function(e){if(e.preventDefault(),1==(t=me()).length&&t[0].mask){var t=t[0];j.show(),O.show(),setTimeout(function(){var e=t.mask,r=new Image;r.onload=function(){t.setSrc(r.src,function(){Pe(t),a.renderAll(),T(),j.hide(),O.hide(),Oe()},{left:t.left,top:t.top,width:t.width,height:t.height,mask:!1})},r.src=e},1)}}),wcdp_spectrum_functions.change_svg_fill_color=function(t,a,r){e(".new-spectrum-fill-js").spectrum("destroy");var s=e(".wcdp-box-svg-multicolor");s.find(".mCSB_container").html(""),s.parent().hide();var n=["svg","groupSVG"];for(var o in n)qe({obj:n[o],set:{fill:"#"+t,fillCMYK:a},paths:!0,save:!1})},wcdp_spectrum_functions.change_svg_fill_multicolor=function(t,r,s){var n=me();if(1==n.length&&("svg"==n[0].clas||"clip-svg"==n[0].clas||"groupSVG"==n[0].clas)){var o=e("#"+s),i=o.attr("data-fill"),c=o.attr("data-paths").split(",");e.each(c,function(e,a){var s=n[0],o=a.split(":"),c="groupSVG"==s.clas?s._objects[o[0]]:s.paths?s.paths[o[0]]:s;"patch"==o[1]?c[i]="#"+t:(c=c[i].colorStops[o[1]]).color="#"+t,c[i+"CMYK"]=r}),a.renderAll()}},e("#wcdp-svg-stroke").on("input change",function(t){t.preventDefault();var a=["svg","groupSVG"];for(var r in a)qe({obj:a[r],paths:!0,set:{strokeWidth:parseInt(e(this).val())},save:!1});"change"==t.type&&T()}),wcdp_spectrum_functions.change_svg_fill_color_outline=function(t,a,r){e(".new-spectrum-stroke-js").spectrum("destroy");var s=e(".wcdp-box-svg-stroke-multicolor");s.find(".mCSB_container").html(""),s.parent().hide();var n=["svg","groupSVG"];for(var o in n)qe({obj:n[o],set:{stroke:"#"+t,strokeCMYK:a},paths:!0,save:!1})},e("#wcdp-image-opacity").on("input change",function(t){t.preventDefault();var a=["img","svg","groupSVG"];for(var r in a)qe({obj:a[r],set:{opacity:e(this).val()},paths:!0,save:!1});"change"==t.type&&T()});var Me={};function Te(t,r){var s=me();if(1==s.length&&("img"==s[0].clas||"clip-img"==s[0].clas)){j.show(),O.show();var n=".wcdp-box-filters",o="dp-item-selected",i=s[0].filters,c=JSON.stringify(i),l=fabric.Image.filters,d="grayscale"==t?new l.Grayscale:"invert"==t?new l.Invert:"purple"==t?new l.Sepia:"yellow"==t?new l.Sepia2:"noise"==t?new l.Noise({noise:150}):"pixelate"==t?new l.Pixelate({blocksize:10}):"blur"==t?new l.GaussianBlur({radius:10}):"brightness"==t?new l.Brightness({brightness:r}):"saturate"==t?new l.Saturate({saturate:r}):"contrast"==t?new l.Contrast({contrast:r}):"sepia"==t?new l.ColorMatrix({matrix:[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0]}):"cold"==t?new l.ColorMatrix({matrix:[1,0,0,0,0,0,1,0,0,0,-.2,.2,.1,.4,0,0,0,0,1,0]}):"warm"==t?new l.ColorMatrix({matrix:[.8,.2,0,0,0,.258,.742,0,0,0,0,.142,.858,0,0,0,0,0,1,0]}):"shiftToBGR"==t?new l.ColorMatrix({matrix:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]}):"vintage"==t?new l.ColorMatrix({matrix:[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0]}):"kodachrome"==t?new l.ColorMatrix({matrix:[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0]}):"technicolor"==t?new l.ColorMatrix({matrix:[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0]}):"brownie"==t?new l.ColorMatrix({matrix:[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0]}):"polaroid"==t?new l.ColorMatrix({matrix:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]}):"fantasy"==t?new l.ColorMatrix({matrix:[.299651227462123,-.21049374091738843,.9108425134552656,0,0,.26909938758978186,.9487574320612636,-.21785681965104553,0,0,-.5976969623597386,1.1223221520157451,.4753748103439934,0,0,0,0,0,1,0]}):"predator"==t?new l.ColorMatrix({matrix:[4.48965225219726,-1.9177947998046876,-1.1498447418212892,0,.16136975288391114,-1.4532279014587404,3.677262878417969,-1.1807243347167968,0,-.5264540195465088,-1.2873679161071778,-1.695001220703125,2.9905792236328126,0,.32177836894989015,0,0,0,1,0]}):"acid"==t?new l.ColorMatrix({matrix:[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0]}):"night"==t?new l.ColorMatrix({matrix:[-1,-.5,0,0,0,-.5,0,.5,0,0,0,.5,1,0,0,0,0,0,1,0]}):"ghost"==t?new l.ColorMatrix({matrix:[0,.9,.9,0,0,.9,0,.9,0,0,.9,.9,0,0,0,0,0,0,1,0]}):"sharpen"==t?new l.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}):"emboss"==t&&new l.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}),p=d.type,u=d.matrix,f=("ColorMatrix"==p||"Convolute"==p)&&u.toString().length;if("none"==t)s[0].filters=[],e(n+"-btn span").removeClass(o),e(n+'-btn [data-filter="none"]').addClass(o),e(n+"-rng input").val(0);else if(!f&&-1==c.indexOf(p)||f&&-1==c.indexOf(u))i.push(d),e(n+'-btn [data-filter="none"]').removeClass(o),e(n+'-btn [data-filter="'+t+'"]').addClass(o);else{for(var v in i)(!f&&i[v].type==p||("ColorMatrix"==i[v].type||"Convolute"==i[v].type)&&i[v].matrix.toString().length==f)&&("brightness"==t||"saturate"==t||"contrast"==t?i[v][t]=r:delete i[v]);e(n+'-btn [data-filter="'+t+'"]').removeClass(o)}setTimeout(function(){s[0].applyFilters(function(){a.renderAll(),T(),j.hide(),O.hide()})},10)}}function Ie(t){var r=me();if(null==(t=1==r.length&&"qr"==r[0].clas||"change"===t&&null))return!1;var s=e("#wcdp-fg-qr-color"),n=e("#wcdp-bg-qr-color"),o=e("#wcdp-text-box-qr").val(),i=e("#wcdp-qr-level").val(),c=parseInt(e("#wcdp-qr-range").val()),l=parseInt(e("#wcdp-qr-border").val()),d={text:o,level:i,range:c,border:l},p=qrcodegen.QrCode.encodeSegments(qrcodegen.QrSegment.makeSegments(o),qrcodegen.QrCode.Ecc[i],c).toSvgString(l,s.spectrum("get").toHexString(),n.spectrum("get").toHexString());fabric.loadSVGFromString(p,function(e,o){var i=fabric.util.groupSVGElements(e,o),c=void 0!==wcdp_parameters.qr_size?parseInt(wcdp_parameters.qr_size):80;i.paths[0].fillCMYK=n.attr("cmyk"),i.paths[1].fillCMYK=s.attr("cmyk"),t?(r[0].paths[0]=i.paths[0],r[0].paths[1]=i.paths[1],r[0].set({width:i.width,height:i.height,dataDP:d}).setCoords()):(i.set({top:50,left:50,clas:"qr",strokeWidth:0,dataDP:d}).scaleToWidth(c).scaleToHeight(c*i.height/i.width),a.discardActiveGroup().add(i).setActiveObject(i)),a.renderAll(),ee(i),T()})}function Ye(t,r,s,n){var o=wcdp_settings.maps_api;if(o){var i=me();if(null==(t=1==i.length&&"maps"==i[0].clas||"change"===t&&null))return!1;j.show();var c=e("#wcdp-text-box-map").val().replace(/\s/g,"+"),l=parseInt(wcdp_parameters.maps_w),d=parseInt(wcdp_parameters.maps_h),p=e("#wcdp-map-zoom").val(),u=e("#wcdp-map-type").val(),f=e("#wcdp-map-icon-size").val(),v=e("#wcdp-map-icon-label").val(),h=e("#wcdp-map-icon-color"),g=void 0===r?h.spectrum("get").toHexString().replace("#",""):r,m=void 0===s?h.attr("cmyk"):s,w="https://maps.googleapis.com/maps/api/staticmap?center=";w+=c+"&zoom="+p+"&scale=4&size="+l+"x"+d,w+="&maptype="+u+"&format=jpg&markers=size:"+f,w+="|color:0x"+g+"|label:"+v+"|"+c+"&key="+o+"&.jpg";var _=new Image;_.crossOrigin="Anonymous",_.onload=function(){var e={width:l,height:d,clas:"maps",crossOrigin:"Anonymous",dataDP:{address:c,type:u,zoom:p,label:v,size:f,fill:g,fillCMYK:m}};if(t)i[0].setElement(_).set(e);else{var r=new fabric.Image(_,e);a.discardActiveGroup().add(r).setActiveObject(r),ee(r)}a.renderAll(),!1!==n&&T(),j.hide()},_.src=w,_.onerror=function(){Fe(wcdp_translations.error_process)}}else Fe(wcdp_translations.api_maps)}function ze(t){if("block"==e("#wcdp-bgcolors-panel").css("display")){var r=a.backgroundColor,s=a.backgroundColorCMYK,n=e("#wcdp-bgcolors-panel .dp-box-bgcolors span");n.removeAttr("class"),!1!==t&&(e("#wcdp-bg-color").spectrum("set",r).spectrum("setCMYK",s),r&&n.each(function(){var t="#"+Ne(e(this).css("background-color"));if(t==r){var a=tinycolor(t);e(this).addClass("sp-thumb-active "+(a.toHsl().l<.5?"sp-thumb-dark":"sp-thumb-light"))}}))}}function Be(e){if("on"==wcdp_style.auto_bleed_color&&(e=e||(a.backgroundColor?a.backgroundColor:0))){var t="rgba(0, 0, 0, 0)"==e||"transparent"==e?"#000000":tinycolor("#"+Ne(e)).toHsl().l>.5?"#000000":"#ffffff";if(i){var r=i;if(r._objects&&r._objects[0].stroke!=t)for(var s=0;s<r._objects.length;s++)r._objects[s].set("stroke",t)}if(c){var n=c,o=He(t,.2);if(n._objects&&n._objects[0].stroke!=o)for(var l=0;l<n._objects.length;l++)n._objects[l].set("stroke",o)}fabric.Object.prototype.set("borderColor",He(t,.75)),a.renderAll()}}function Ke(){if("on"==wcdp_parameters.layers_e){var t=e("#wcdp-contain-layers"),a=t.find(".wcdp-layers-items");"block"==e("#wcdp-layers-panel").css("display")?(b=!0,setTimeout(function(){a.empty();var e=Ge();e||(e='<div class="dp-box-note dp-border-style"><p>'+wcdp_translations.no_layers+"</p></div>"),a.append(e),t.show()},100)):(b=0,t.hide())}}function Ge(e){var t="",r=a.getObjects(),s=wcdp_translations;e&&e.setCoords();for(var n=r.length-1;n>=0;n--){var o=r[n],i=o.clas;if("bleed"!=i&&"grid"!=i&&(!e||e&&o!==e&&o.selectable&&o.intersectsWithObject(e))){var c=!e||"",l="i-text"==i,d="shap"==i,p="qr"==i,u="maps"==i,f="img"==i||"clip-img"==i,v="svg"==i||"clip-svg"==i,h="grouped"==i||"groupSVG"==i,g=o.get("layerThumb"),m='style="color:'+(l?tinycolor(o.fill).toHsl().l<.5?"#fbfbfb":"#333333":p?o.paths[1].fill:"")+";background-color:"+(l?o.fill:p?o.paths[0].fill:"")+';"',w=c?"":' title="'+s.select_mask+'"';if(c)var _=o.active?" dp-active":"",b="backend"==wcdp_parameters.editor,y=b&&o.hide?" dp-hide-layer":"",k=b&&o.lockUser?" dp-lock-user":"",C=!b&&o.lockUser?" dp_layer_dsb":"",x=!(!b&&o.lockUser)||"",A=o.selectable?"":" dp-locked",j=s[(o.selectable?"lock":"unlock")+"_layer"];o.id||(o.id=Ze()),o.name||l||(o.name=f?s.img:v?s.svg:h?s.group:d?s.shap:p?s.qr:u&&s.map);var S=o.name?o.name:l?o.text?o.text.replace(/\n/g," "):s.text:s.new_layer;t+=['<div class="dp-layer-row'+(c&&_+y+k+C)+'"'+w+' data-id="'+o.id+'">','<div class="dp-layer-thumb"'+(c&&' title="'+s.layer_options+'"')+">",l?'<span class="wcdp-icon-text" '+m+"></span>":p?'<span class="wcdp-icon-qr" '+m+"></span>":u?'<span class="wcdp-icon-map"></span>':h?'<span class="wcdp-icon-group"></span>':o.mask?'<span class="wcdp-icon-mask"></span>':void 0!==g?'<img src="'+g+'"/>':"","</div>",'<div class="dp-layer-name"'+(c&&' title="'+S+'"')+">","<span"+(c&&x&&' contenteditable="true"')+">"+S+"</span>","</div>",c&&'<div class="dp-layer-ins">'+(y&&'<span class="wcdp-icon-hide-layer" title="'+s.show_layer+'"></span>')+(k&&'<span class="wcdp-icon-lock-user" title="'+s.unlock_layer_user+'"></span>')+(x&&'<span class="wcdp-icon-sort" title="'+s.sort_layer+'"></span>')+'<span class="wcdp-icon-lock'+A+'" title="'+j+'"></span>'+(x&&'<span class="wcdp-icon-close" title="'+s.delete_layer+'"></span>')+"</div>","</div>"].join("")}}return t}function Pe(t){if("on"==wcdp_parameters.layers_e){if(-1==e.inArray(t.clas,["bleed","grid","i-text","qr","maps","grouped","groupSVG"])&&!t.mask){var a=new Image;a.onload=function(){t.set("layerThumb",this.src)},a.src=t.getLayerThumb()}}}function Re(t,a){"clear"==t?e("#wcdp-contain-layers .dp-layer-row").removeClass("dp-active"):"select"==t?e('#wcdp-contain-layers [data-id="'+a+'"]').addClass("dp-active"):"lock"==t?e('#wcdp-contain-layers [data-id="'+a+'"] .wcdp-icon-lock').attr("title",wcdp_translations.lock_layer).removeClass("dp-locked"):"unlock"==t&&e('#wcdp-contain-layers [data-id="'+a+'"] .wcdp-icon-lock').attr("title",wcdp_translations.unlock_layer).addClass("dp-locked")}function qe(e){var t=me(),r=t.length;t.forEach(function(t){if(t.clas==e.obj||"all"==e.obj)for(var a in e.set){var s=e.set[a],n={},o=e.cmd?new Function("obj","return "+s)(t):t[a]==s&&e.default?"":s;if("i-text"==t.type&&t.isEditing&&t.exitEditing(),e.point){var i=t.textAlign;if("left"!==i)var c=t.getPointByOrigin(i,"top")}if("writeText"==a)t.setText(o);else if("spacing"==a&&"i-text"==t.type)t.set("charSpacing",25*o);else if("angle"==a)t.setAngle(o);else if("toggle"==a)t.toggle(o);else{var l=!0;if(n[a]=o,e.paths&&t.paths){for(var d in t.paths)t.paths[d].set(n);"strokeWidth"==a&&(n[a]=0)}else if(e.paths&&"groupSVG"==t.clas&&t._objects){for(var p in l=!1,t._objects)("image"!=t._objects[p].type||"maps"!=t._objects[p].clas&&"opacity"==a)&&t._objects[p].set(n);1==r&&"strokeWidth"==a&&t.addWithUpdate()}else e.path&&t.paths[e.path].set(n);l&&t.set(n)}void 0!==c&&t.setPositionByOrigin(c,i,"top"),t.setCoords()}}),a.renderAll(),0!=e.save&&T()}function We(t){var a=e("#dp-box-search-"+t),s=a.find(".mCSB_container"),n="tpl"==t,o="clip"==t,i=e(".dp-folder-contain.dp-"+t),c=e("#wcdp-text-box-search-"+t).val();(n||i.length>0)&&(s.html(""),e("#wcdp-"+(n?"templates":o?"cliparts":"calendars")+"-panel .dp-img-contain").each(function(){var t=e(this),a=[t.attr("data-name")].filter(function(e,t,a){return-1!=e.search(new RegExp(c,"i"))});if(a.length>0){var i=o?" dp-"+(t.hasClass("dp-svg")?"svg":"img"):"",l=o?' data-source="'+t.attr("data-source")+'"':"",d=n?' page-id="'+t.attr("page-id")+'"':"",p=n?' design-id="'+t.attr("design-id")+'"':"",u=t.find("img").attr("data-src");s.append('<span class="dp-img-contain'+i+'"'+l+' data-name="'+a[0]+'"'+d+p+'><img class="lazyload dp-loading-lazy" src="'+r+'" data-src="'+u+'"/></span>')}}),e(".dp-"+t+"-content").hide(),i.removeClass("dp-folder-open"),e(".dp-contain-"+t).show(),a.show(),setTimeout(function(){Je("#dp-box-search-"+t+" img.lazyload")},100),0==a.find("span").length&&s.append('<span class="dp-search-empty" id="wcdp-btn-'+t+'-empty"></span><label>'+wcdp_translations["no_search_"+t]+"</label>"))}function Le(t,a){var r="dp-folder-open",s="dp-"+a+"-content",n=t.hasClass(r);e(".dp-folder-contain.dp-"+a).removeClass(r),e("."+s).hide(),n?(e(".dp-contain-"+a).hide(),"tpl"==a&&void 0!==wcdp_parameters.multipleDesigns&&e("#wcdp-tpl-general, .dp-contain-tpl").show()):(t.addClass(r),e("."+s+"[data-id="+t.attr("data-id")+"], .dp-contain-"+a).show())}function Ee(t,a){return e(t).jBox("Tooltip",{offset:{y:parseInt(wcdp_style.tooltip_offset_y),x:parseInt(wcdp_style.tooltip_offset_x)},delayOpen:300,addClass:d?"md__rtl":"",getContent:a?"data-jbox-content":"title"})}function Fe(e){new jBox("Modal",{closeButton:"box",content:e,addClass:d?"md__rtl":"",onCloseComplete:function(){this.destroy()}}).open(),j.hide()}function Ue(e,t){new jBox("Confirm",{content:e,addClass:d?"md__rtl":"",cancelButton:wcdp_translations.cancel,confirmButton:wcdp_translations.confirm,confirm:t,onCloseComplete:function(){this.destroy()}}).open()}function Je(e){new WCDP_LazyLoad({elements_selector:e,class_loading:"dp-loading-lazy"})}function Xe(t){var a=e.Deferred();return t.length?WebFont.load({custom:{families:t},active:function(){a.resolve()}}):a.resolve(),a.promise()}function Ne(e){var t,a=e;if(a.indexOf("#")>-1)t=a;else{var r=a.match(/\d+/g);t=("0"+parseInt(r[0],10).toString(16)).slice(-2)+("0"+parseInt(r[1],10).toString(16)).slice(-2)+("0"+parseInt(r[2],10).toString(16)).slice(-2)}return t}function He(e,t){return"rgba("+parseInt(e.slice(1,3),16)+","+parseInt(e.slice(3,5),16)+","+parseInt(e.slice(5,7),16)+","+t+")"}function Ve(e){return e.toLowerCase().replace(/\b./g,function(e){return e.toUpperCase()})}function Ze(){for(var e="",t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",a=0;a<18;a++){if(0==Math.floor(2*Math.random())){e+=Math.floor(9*Math.random())}else{var r=Math.floor(Math.random()*t.length);e+=t.substring(r,r+1)}}return e}e("body").on("click","#wcdp-crop-tools span",function(t){t.preventDefault();var r=e(this),s="btn-enabled",n=r.attr("id").substring(9),o=Me.cropper;"move"==n||"crop"==n?(e("#wcdp-btn-move, #wcdp-btn-crop").removeClass(s),r.addClass(s),o.setDragMode(n)):"square"==n?r.hasClass(s)?(r.removeClass(s),o.setAspectRatio(NaN)):(r.addClass(s),o.setAspectRatio(1.1)):"zoom-in"==n?o.zoom(.1):"zoom-out"==n?o.zoom(-.1):"reset-resize"==n?o.reset():"cancel"==n?Me.contain.close():"save"==n&&(j.show(),setTimeout(function(){var e=Me.image,t=e.obj._element.naturalWidth/e.obj.width,r=e.obj._element.naturalHeight/e.obj.height,s=e.obj.toObject(),n=new Image;n.crossOrigin="Anonymous",n.onload=function(){"maps"==s.clas&&(s.clas="img"),s.filters=[],s.width=e.coords.width/t,s.height=e.coords.height/r,s.left=e.obj.left+e.coords.x/t*e.obj.scaleX,s.top=e.obj.top+e.coords.y/r*e.obj.scaleY;var o=new fabric.Image(n,s);a.add(o).setActiveObject(o),a.remove(e.obj).renderAll(),T(),j.hide()},n.src=o.getCroppedCanvas().toDataURL("image/png"),n.onerror=function(){Fe(wcdp_translations.error_process)}},500),Me.contain.close())}),e("#wcdp-tabs-content .wcdp-box-filters-btn span").click(function(t){t.preventDefault(),Te(e(this).attr("data-filter"))}),e("#wcdp-tabs-content .wcdp-box-filters-rng input").change(function(t){t.preventDefault(),Te(e(this).attr("data-filter"),parseFloat(100*this.value))}),e("#wcdp-shapes-panel .dp-box-shap").on("click",".dp-img-contain",function(e){e.preventDefault(),fabric.loadSVGFromString(this.innerHTML,function(e,t){var r=fabric.util.groupSVGElements(e,t),s=void 0!==wcdp_parameters.shape_size?parseInt(wcdp_parameters.shape_size):80,n={clas:"shap",fill:wcdp_style.color_shapes_editor.RGB,fillCMYK:wcdp_style.color_shapes_editor.CMYK,stroke:wcdp_style.color_shapes_editor_outline.RGB,strokeCMYK:wcdp_style.color_shapes_editor_outline.CMYK,strokeWidth:0};if(r.paths)for(var o in r.paths)r.paths[o].set(n);n.top=50,n.left=50,r.set(n).scaleToWidth(s).scaleToHeight(s*r.height/r.width),a.discardActiveGroup().add(r).setActiveObject(r).renderAll(),ee(r),T()})}),wcdp_spectrum_functions.change_shap_fill_color=function(e,t,a){qe({obj:"shap",set:{fill:"#"+e,fillCMYK:t},paths:!0,save:!1})},e("#wcdp-shap-stroke").on("input change",function(t){t.preventDefault(),qe({obj:"shap",set:{strokeWidth:parseInt(e(this).val())},paths:!0,save:!1}),"change"==t.type&&T()}),wcdp_spectrum_functions.change_shap_fill_color_outline=function(e,t,a){qe({obj:"shap",set:{stroke:"#"+e,strokeCMYK:t},paths:!0,save:!1})},e("#wcdp-shap-opacity").on("input change",function(t){t.preventDefault(),qe({obj:"shap",set:{opacity:e(this).val()},paths:!0,save:!1}),"change"==t.type&&T()}),e("#wcdp-cliparts-panel .dp-clip-content").on("click",".dp-img-contain",function(t){t.preventDefault();var a=e(this);a.find("img").hasClass("loaded")&&Ae(a.attr("data-source"),a.attr("data-name"),!1,!0)}),wcdp_spectrum_functions.change_clip_fill_color=function(t,a,r){e(".new-spectrum-fill-js").spectrum("destroy");var s=e(".wcdp-box-svg-multicolor");s.find(".mCSB_container").html(""),s.parent().hide(),qe({obj:"clip-svg",set:{fill:"#"+t,fillCMYK:a},paths:!0,save:!1})},e("#wcdp-clip-svg-stroke").on("input change",function(t){t.preventDefault(),qe({obj:"clip-svg",paths:!0,set:{strokeWidth:parseInt(e(this).val())},save:!1}),"change"==t.type&&T()}),wcdp_spectrum_functions.change_clip_fill_color_outline=function(t,a,r){e(".new-spectrum-stroke-js").spectrum("destroy");var s=e(".wcdp-box-svg-stroke-multicolor");s.find(".mCSB_container").html(""),s.parent().hide(),qe({obj:"clip-svg",set:{stroke:"#"+t,strokeCMYK:a},paths:!0,save:!1})},e("#wcdp-clipart-opacity").on("input change",function(t){t.preventDefault();var a=["clip-img","clip-svg"];for(var r in a)qe({obj:a[r],set:{opacity:e(this).val()},paths:!0,save:!1});"change"==t.type&&T()}),e("#wcdp-btn-make-qr").click(function(e){e.preventDefault(),Ie()}),e("#wcdp-qr-level, #wcdp-qr-border, #wcdp-qr-range").change(function(e){e.preventDefault(),Ie("change")}),e("#wcdp-text-box-qr").keyup(function(e){e.preventDefault(),Ie(13!==e.keyCode&&"change")}),wcdp_spectrum_functions.change_qrcode_fill_color=function(e,t,a){qe({obj:"qr",set:{fill:"#"+e,fillCMYK:t},path:"fg"==a.slice(5,-9)?"1":"0",save:!1})},e("#wcdp-btn-make-map").click(function(e){e.preventDefault(),Ye()}),e("#wcdp-map-type, #wcdp-map-zoom, #wcdp-map-icon-label, #wcdp-map-icon-size").change(function(e){e.preventDefault(),Ye("change")}),e("#wcdp-text-box-map").keyup(function(e){e.preventDefault(),13===e.keyCode&&Ye()}),wcdp_spectrum_functions.change_map_icon_color=function(e,t){Ye("change",e,t,!1)},fabric.Image.prototype.getSvgSrc=function(){var e=this._element.src;return"maps"==this.clas&&(e=e.replace(/&/g,"&amp;")),e},e("#wcdp-calendars-panel .dp-contain-caz").on("click",".dp-img-contain",function(t){t.preventDefault();var a=e(this),r=a.find("img");r.hasClass("loaded")&&Ae(r.attr("src"),a.attr("data-name"))}),e("#wcdp-bgcolors-panel .dp-box-bgcolors span").click(function(t){t.preventDefault();var a=e(this),r=a.css("background-color"),s=a.attr("data-cmyk");wcdp_spectrum_functions.change_bg_color(Ne(r),s,!0),Be(r)}),wcdp_spectrum_functions.change_bg_color=function(e,t,r){a.backgroundColor="#"+e,a.backgroundColorCMYK=t,a.renderAll(),1==r?T():ze(!1)},e("#wcdp-contain-layers").on("click",".dp-layer-row",function(t){t.preventDefault();var r=e(t.target),s=we(e(this).attr("data-id"));s&&(r.hasClass("dp-layer-thumb")&&s.selectable&&"grouped"!=s.clas&&(b=0),("backend"==wcdp_parameters.editor||s.evented)&&(a.deactivateAll().setActiveObject(s).renderAll(),ie(s),r.hasClass("wcdp-icon-lock-user")?e("#wcdp-btn-lock-user").click():r.hasClass("wcdp-icon-hide-layer")?e("#wcdp-btn-out-hide").click():r.hasClass("wcdp-icon-lock")?e("#wcdp-btn-lock").click():r.hasClass("wcdp-icon-close")&&ge()))}).on("keyup","[contenteditable]",function(t){t.preventDefault();var a=e(this),r=a.html(),s=we(a.parents(".dp-layer-row").attr("data-id"));s&&s.name!=r&&-1==e.inArray(t.keyCode,[13,16,17,18,20,37,38,39,40])&&(s.name=r,T())}).on("keydown","[contenteditable]",function(e){return 13!=e.which}),e("#wcdp-contain-layers .wcdp-layers-items").sortable({axis:"y",scroll:!1,opacity:.7,items:".dp-layer-row",handle:".wcdp-icon-sort",containment:"parent",placeholder:"dp-layer-row dp-sortable-placeholder",update:function(t,r){var s=e(this).children();setTimeout(function(){var t=a.getObjects();s.each(function(r,s){for(var n=e(s).attr("data-id"),o=0;o<t.length;++o){var i=t[o];if(i.id&&i.id==n){a.sendToBack(i);break}}}),a.renderAll(),T()},10)}}),e("#wcdp-btn-lock-user, #wcdp-btn-out-hide").click(function(t){t.preventDefault();var r=e("#wcdp-contain-layers .dp-layer-row.dp-active");if(1==r.length){var s=we(r.attr("data-id"));if(s){var n="lock-user"==e(this).attr("id").substring(9),o=n?!s.lockUser:!s.hide,i=o&&wcdp_translations[n?"unlock_layer_user":"show_layer"],c=n?"lock-user":"hide-layer";o?r.addClass("dp-"+c).find(".dp-layer-ins span:eq("+(n?-3:0)+")").before('<span class="wcdp-icon-'+c+'" title="'+i+'"></span>'):r.removeClass("dp-"+c).find(".wcdp-icon-"+c).remove(),s.set(n?"lockUser":"hide",o),a.renderAll(),T()}}}),e("#wcdp-btn-search-tpl, #wcdp-btn-search-clip, #wcdp-btn-search-caz").click(function(t){t.preventDefault(),We(e(this).attr("id").substring(16))}),e("#wcdp-text-box-search-tpl, #wcdp-text-box-search-clip, #wcdp-text-box-search-caz").keyup(function(t){t.preventDefault(),13===t.keyCode&&We(e(this).attr("id").substring(21))}),e("#wcdp-templates-panel .dp-folder-contain").click(function(t){t.preventDefault(),Le(e(this),"tpl")}),void 0===wcdp_parameters.multipleDesigns&&e("#wcdp-templates-panel .dp-folder-contain").eq(0).click(),e("#wcdp-cliparts-panel .dp-folder-contain").click(function(t){t.preventDefault(),Le(e(this),"clip")}).eq(0).click(),e("#wcdp-calendars-panel .dp-folder-contain").click(function(t){t.preventDefault(),Le(e(this),"caz")}).eq(0).click(),Ee("#wcdp-container .dp-tooltip"),e("#wcdp-code-run").click(function(t){t.preventDefault(),new Function("canvas",e("#wcdp-canvas-console").val())(a),a.renderAll(),T()}),e("#wcdp-code-get").click(function(t){t.preventDefault(),e("#wcdp-canvas-console").val(I()).select()}),e("#wcdp-code-add").click(function(t){t.preventDefault(),a.clear(),a.loadFromJSON(JSON.parse(e("#wcdp-canvas-console").val()),function(){a.renderAll.bind(a),R("add"),T()})}),e("#wcdp-code-img").click(function(t){t.preventDefault();var r=U(wcdp_parameters.output_w/a.getWidth(),"png",!1,!0),s=e(".dp-canvas-active label").html()+"_design_"+wcdp_parameters.designID+".png",n=pe(r,"image/png");if(navigator.msSaveBlob)navigator.msSaveBlob(n,s);else{var o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=s,document.body.appendChild(o),o.click()}}),e("#wcdp-code-clear").click(function(t){t.preventDefault(),e("#wcdp-canvas-console").val("")})})}(jQuery);