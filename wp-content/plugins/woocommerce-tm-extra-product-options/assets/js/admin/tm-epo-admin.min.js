!function(c,a){"use strict";var e,r=c.TMEPOADMINJS,i=0;function n(){var i=a("#product-type").val();a(".tc-normal-epo").toArray().forEach(function(t){var t=a(t),e=t.find(".tmcp_attribute").val(),o=t.find("select.tmcp_att").val(),c=t.find("select.tmcp-variation").val(),c="input.tmcp-price-input-variation-"+c+"[data-price-input-attribute='"+o+"'],select.tmcp-price-input-variation-"+c+"[data-price-input-attribute='"+o+"']";"variable"!==i&&"variable-subscription"!==i?t.find(".show_if_variable").hide():t.find(".show_if_variable").show(),t.find("select.tmcp_att").hide(),t.find("select.tmcp_att[data-tm-attr='"+e+"']").show(),t.find("input.tmcp-price-input").hide(),t.find("select.tmcp-price-input-type").hide(),t.find(c).show()})}function p(t,e){var o=t.val(),t=t.closest(".tc-normal-epo"),c=t.find("input.tmcp_loop").val(),i=t.find("select.tmcp_att").val(),a=t.find("select.tmcp-variation").val(),n="";switch(t.find("input.tmcp-price-input").hide(),t.find("select.tmcp-price-input-type").hide(),e){case"variation":n="input.tmcp-price-input-variation-"+(a=o)+"[data-price-input-attribute='"+i+"'],select.tmcp-price-input-variation-"+o+"[data-price-input-attribute='"+i+"']";break;case"attribute":n="input.tmcp-price-input-variation-"+a+"[data-price-input-attribute='"+(i=o)+"'],select.tmcp-price-input-variation-"+a+"[data-price-input-attribute='"+o+"']"}t.find(n).length<=0&&((e=t.find(".tmcp-pricing")).append('<input type="text" name="tmcp_regular_price['+c+"]["+i+"]["+a+']" value="" class="wc_input_price tmcp-price-input tmcp-price-input-variation-'+a+'" data-price-input-attribute="'+i+'">'),e.append('<select class="tmcp-price-input-type tmcp-price-input tmcp-price-input-variation-'+a+'" data-price-input-attribute="'+i+'" name="tmcp_regular_price_type['+c+"]["+i+"]["+a+']"><option value="">'+r.i18n_fixed_type+'</option><option value="percent">'+r.i18n_percent_type+"</option></select>")),t.find(n).show()}function l(t){t&&(a("#tm-meta-cpf-mode").val(t),a(".tm-mode-selector").addClass("tc-active"),a(".tm-mode-builder,.tm-mode-local,.tm-mode-settings").hide(),a(".tm-mode-"+t).show(),a(".tc-builder-select,.tc-local-select,.tc-settings-select").removeClass("button-primary"),a(".tc-"+t+"-select").addClass("button-primary"))}function m(t){t=t.filter(":checked");t.closest(".price-display-mode-wrap").removeClass(function(t,e){return(e.match(/(^|\s)mode-\S+/g)||[]).join(" ")}).addClass("mode-"+t.val())}r&&a(function(){var t=a("#bulk-action-selector-top"),o=!1;0<t.length&&t.children("option").each(function(t,e){"tcline"===a(e).val()?(o=!0,a(e).replaceWith(a('<optgroup class="tc-bulk-opt" label="'+a(e).text()+'">'))):o&&"tcclear"!==a(e).val()&&"tcproductclear"!==a(e).val()&&"tcclearexclude"!==a(e).val()&&"tcclearexcludeadd"!==a(e).val()&&a(e).appendTo(a(".tc-bulk-opt")),"tcline2"===a(e).val()&&a(e).remove()}),e={items:".tc-normal-epo",cursor:"move",axis:"y",handle:"h3 .move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){t&&e.item.css("background-color","#f6f6f6")},stop:function(t,e){t&&e.item.removeAttr("style"),a(".tc-normal-epos .tc-normal-epo").toArray().forEach(function(t){a(".tm_epo_menu_order",t).val(parseInt(a(t).index(".tc-normal-epos .tc-normal-epo"),10))})}},n(),a("#tc-admin-extra-product-options").on("change","select.tmcp-variation",function(){p(a(this),"variation")}),a("#tc-admin-extra-product-options").on("change","select.tmcp_att",function(){p(a(this),"attribute")}),a("#tc-admin-extra-product-options").on("tc_normal_epo_added",function(){a(".tc-normal-epos").sortable(e)}),a("#tc-admin-extra-product-options").on("tc_normal_epos_loaded",function(){a(".tc-normal-epos").sortable(e)}),a(".tc-normal-epos").sortable(e),a("#variable_product_options").on("click","button.remove_variation",function(){i=1}),a("#variable_product_options").on("woocommerce_variations_added",function(){i=1}),a(".product_attributes").on("click","button.add_new_attribute",function(){i=1}),a(".save_attributes").on("click",function(){i=1}),a(".tc-epo-woocommerce-tab a").on("click",function(){var t;1===i&&(a("#tc-admin-extra-product-options").block({message:null}),t={action:"woocommerce_tm_load_epos",post_id:r.post_id,security:r.load_tm_epo_nonce},a.post(r.ajax_url,t,function(t){a(".tm-mode-local").html(t),a("#tc-admin-extra-product-options").unblock(),a("#tc-admin-extra-product-options").trigger("tc_normal_epos_loaded"),i=0,n()}))}),a("#tc-admin-extra-product-options").on("click","button.tm_add_epo",function(){var t=a("select.tmcp-attr-list").val(),e=a(".tc-normal-epos .tc-normal-epo[data-epo-attr='"+t+"']"),o=a(".tc-normal-epo").length,t={action:"woocommerce_tm_add_epo",post_id:r.post_id,att_id:t,loop:o,security:r.add_tm_epo_nonce};if(!(0<e.length))return a(".tm-mode-local").block({message:null}),a.post(r.ajax_url,t,function(t){"max"===t?(c.alert(r.i18n_max_tmcp),a(".tm-mode-local").unblock()):t&&(a(".tc-normal-epos").append(t),a("#tc-admin-extra-product-options").trigger("tc_normal_epo_added"),n())}).always(function(){a(".tm-mode-local").unblock()}),!1;e.find(".woocommerce-tmcp-attributes").show()}),a("#tc-admin-extra-product-options").on("click",".remove_tm_epo",function(t){var e,o=c.confirm(r.i18n_remove_tmcp);return t.preventDefault(),o&&(e=a(this).parent().parent(),0<(t=a(this).attr("rel"))?(e.block({message:null}),o={action:"woocommerce_tm_remove_epo",tmcpid:t,security:r.delete_tm_epo_nonce},a.post(r.ajax_url,o,function(){e.fadeOut("300",function(){e.remove()})})):e.fadeOut("300",function(){e.remove()})),!1}),a("#tc-admin-extra-product-options").on("change",".tm-type",function(){var t=a(this),e=t.closest(".data").find(".tmcp_choices");"checkbox"===t.val()?e.removeClass("tm-hidden"):e.addClass("tm-hidden")}),a("#tc-admin-extra-product-options").on("click",".tc-select-mode",function(t){var e="local";t.preventDefault(),a(this).is(".tc-builder-select")&&(e="builder"),l(e=a(this).is(".tc-settings-select")?"settings":e)}),a("#tc-admin-extra-product-options").on("change",".price-display-mode",function(){m(a(this))}),m(a(".price-display-mode")),a("#tm-meta-cpf-mode").val()||a("#tm-meta-cpf-mode").val("builder"),l(a("#tm-meta-cpf-mode").val()),a.tmEPOAdmin&&a.tmEPOAdmin.create_normal_dropdown(a(".tm-mode-settings")),a.fn.tmcheckboxes&&a(".tm-mode-settings").tmcheckboxes()})}(window,(document,window.jQuery));