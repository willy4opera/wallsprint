!function(d,r,P){"use strict";var e,s,c,m,u,p,w,n,_=d.wp,a=d.TMEPOADMINJS,g=d.TMEPOGLOBALADMINJS,f=d.toastr,h=d._,i=d.plupload,y=!1,v={tc_builder_elements:_.template("tc-builder-elements"),tc_builder_section:_.template("tc-builder-section")},O=d.JSON,b="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=";function A(t){var i=[];return Object.keys(t).forEach(function(e){Object.prototype.hasOwnProperty.call(t,e)&&(i[i.length]=t[e])}),i}P.tmEPOAdmin={addEventsDone:0,variationsCheckForChanges:0,elementLogicObject:{},sectionLogicObject:{},elementShippingLogicObject:{},logicOperators:{is:g.i18n_is,isnot:g.i18n_is_not,isempty:g.i18n_is_empty,isnotempty:g.i18n_is_not_empty,startswith:g.i18n_starts_with,endswith:g.i18n_ends_with,greaterthan:g.i18n_greater_than,lessthan:g.i18n_less_than,greaterthanequal:g.i18n_greater_than_equal,lessthanequal:g.i18n_less_than_equal},builderItemsSortableObj:{start:{},end:{}},builderSectionsSortableObj:{start:{},end:{}},builderSize:{w1:"1%",w2:"2%",w3:"3%",w4:"4%",w5:"5%",w6:"6%",w7:"7%",w8:"8%",w9:"9%",w10:"10%",w11:"11%",w12:"12%","w12-5":"12.5%",w13:"13%",w14:"14%",w15:"15%",w16:"16%",w17:"17%",w18:"18%",w19:"19%",w20:"20%",w21:"21%",w22:"22%",w23:"23%",w24:"24%",w25:"25%",w26:"26%",w27:"27%",w28:"28%",w29:"29%",w30:"30%",w31:"31%",w32:"32%",w33:"33%",w34:"34%",w35:"35%",w36:"36%",w37:"37%","w37-5":"37.5%",w38:"38%",w39:"39%",w40:"40%",w41:"41%",w42:"42%",w43:"43%",w44:"44%",w45:"45%",w46:"46%",w47:"47%",w48:"48%",w49:"49%",w50:"50%",w51:"51%",w52:"52%",w53:"53%",w54:"54%",w55:"55%",w56:"56%",w57:"57%",w58:"58%",w59:"59%",w60:"60%",w61:"61%",w62:"62%","w62-5":"62.5%",w63:"63%",w64:"64%",w65:"65%",w66:"66%",w67:"67%",w68:"68%",w69:"69%",w70:"70%",w71:"71%",w72:"72%",w73:"73%",w74:"74%",w75:"75%",w76:"76%",w77:"77%",w78:"78%",w79:"79%",w80:"80%",w81:"81%",w82:"82%",w83:"83%",w84:"84%",w85:"85%",w86:"86%",w87:"87%","w87-5":"87.5%",w88:"88%",w89:"89%",w90:"90%",w91:"91%",w92:"92%",w93:"93%",w94:"94%",w95:"95%",w96:"96%",w97:"97%",w98:"98%",w99:"99%",w100:"100%"},isElementDragged:!1,variationSection:!1,variationSectionIndex:!1,variationFieldIndex:!1,checkboxStates:{},canTakeLogic:["product","color","range","radiobuttons","checkboxes","selectbox","selectboxmultiple","textfield","textarea","variations"],addSortables:function(){P.tmEPOAdmin.is_original&&(P(".builder-layout").sortable({handle:".move",cursor:"move",items:".builder-wrapper:not(.tma-nomove)",start:function(e,t){var i=P(t.item).closest(".builder-wrapper").index();P.tmEPOAdmin.builderSectionsSortableObj.start.section=i,t.placeholder.height(t.helper.outerHeight()),t.placeholder.width(t.helper.outerWidth())},stop:function(e,t){t=P(t.item).closest(".builder-wrapper").index();P.tmEPOAdmin.builderSectionsSortableObj.end.section=t,w.splice(t,0,w.splice(P.tmEPOAdmin.builderSectionsSortableObj.start.section,1)[0]),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.builderSectionsSortableObj={start:{},end:{}}},cancel:".tma-nomove",forcePlaceholderSize:!0,placeholder:"bitem pl2",tolerance:"pointer"}),P.tmEPOAdmin.builder_items_sortable(P(".builder-wrapper .bitem-wrapper")))},getBuilder:function(){return w},getBuilderJSON:function(){return O.stringify(w)},setBuilder:function(e){w=P.epoAPI.util.deepCopyArray(P.epoAPI.util.parseJSON(e))},addEvents:function(){var e,a,n,l,o,t=P(".tagchecklist");1!==P.tmEPOAdmin.addEventsDone&&(P.tmEPOAdmin.addSortables(),e=P("#builder_import_file"),(e=new i.Uploader({url:g.import_url,browse_button:e[0],file_data_name:"builder_import_file",multi_selection:!1})).init(),e.bind("FilesAdded",function(e){var t,i=P.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:"",title:g.i18n_import_title});a=P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"300px",classname:"flasho tc-wrapper",data:i}),t=P('<div class="tc-progress-bar tc-notice"><span class="tc-percent"></span></div><div class="tc-progress-info"><span class="tc-progress-info-content"></span></div>'),P('<div class="override-selection"><button type="button" class="tc tc-button details-override">'+g.i18n_overwrite_existing_elements+'</button><button type="button" class="tc tc-button details-append">'+g.i18n_append_new_elements+"</button></div>").appendTo("#tc-floatbox-content"),w=P.tmEPOAdmin.checkSections(w),n=P.tmEPOAdmin.tm_escape(O.stringify(P.tmEPOAdmin.prepareForJson(P.tmEPOAdmin.tcSerializeJsOptionsObject(w)))),g.is_original_post?(P(".details-override").on("click",function(){P("#tc-floatbox-content").find(".override-selection").remove(),t.appendTo("#tc-floatbox-content"),P(".tc-progress-info-content").html(g.i18n_importing),e.setOption("multipart_params",{action:"import",import_override:1,post_id:g.post_id,security:g.import_nonce,is_original_post:g.is_original_post}),e.start(),P(".flasho").addClass("tc-color-notice")}),P(".details-append").on("click",function(){P("#tc-floatbox-content").find(".override-selection").remove(),t.appendTo("#tc-floatbox-content"),P(".tc-progress-info-content").html(g.i18n_importing),e.setOption("multipart_params",{action:"import",import_override:0,post_id:g.post_id,tm_uploadmeta:n,security:g.import_nonce,is_original_post:g.is_original_post}),e.start(),P(".flasho").addClass("tc-color-notice")})):(P("#tc-floatbox-content").find(".override-selection").remove(),t.appendTo("#tc-floatbox-content"),P(".tc-progress-info-content").html(g.i18n_importing),e.setOption("multipart_params",{action:"import",import_override:1,post_id:g.post_id,tm_uploadmeta:n,security:g.import_nonce,is_original_post:g.is_original_post}),e.start(),P(".flasho").addClass("tc-color-notice"))}),e.bind("FileUploaded",function(e,t,i){var n=P.epoAPI.util.parseJSON(i.response);n&&void 0!==n.result&&n.message&&P(".tc-progress-info-content").html(n.message),n&&n.error&&n.message&&P(".tc-progress-info-content").html(n.message),n&&void 0!==n.result&&1===P.epoAPI.math.toFloat(n.result)?(P(".tc-progress-bar").removeClass("tc-notice").addClass("tc-success"),P(".tc-progress-info-content").removeClass("tc-color-error").addClass("tc-color-success"),P(".flasho").removeClass("tc-color-notice tc-color-error").addClass("tc-color-success"),P(".floatbox-cancel").remove(),P(".tc-progress-info-content").html(g.i18n_saving),P(d).off("beforeunload.edit-post"),n.options&&(Array.isArray(n.jsobject)?(P(".builder-layout").html(n.options),w=n.jsobject,P.tmEPOAdmin.setGlobalVariationObject("initialitize_on_after"),f.success(n.message,g.i18n_epo)):f.error(g.i18n_invalid_request,g.i18n_epo)),a.destroy()):(P(".tc-progress-bar").removeClass("tc-notice").addClass("tc-error"),P(".tc-progress-info-content").removeClass("tc-color-success").addClass("tc-color-error"),P(".flasho").removeClass("tc-color-notice tc-color-success").addClass("tc-color-error"),!n&&i&&i.response&&P(".tc-progress-info-content").addClass("tc-normal-font").html(i.response),f.error(g.i18n_invalid_request,g.i18n_epo))}),e.bind("UploadProgress",function(e,t){t=parseInt(t.percent,10);P(".tc-progress-bar").css("width",t+"%"),P(".tc-percent").html(t+"%")}),e.bind("Error",function(e,t){t&&t.message&&P(".tc-progress-info-content").removeClass("tc-color-success").addClass("tc-color-error").html("\nError #"+t.code+": "+t.message),P(".tc-progress-bar").removeClass("tc-notice").addClass("tc-error"),P(".flasho").removeClass("tc-color-notice tc-color-success").addClass("tc-color-error")}),e.bind("UploadComplete",function(){P("body").removeClass("overflow")}),P(r).on("click.cpf","#builder_export",function(e){var t=P(this);e.preventDefault(),t.data("doing_export")||(t.data("doing_export",1).prepend('<i class="tm-icon tcfa tcfa-spin tcfa-spinner"></i>'),w=P.tmEPOAdmin.checkSections(w),e=P.tmEPOAdmin.prepareForJson(P.tmEPOAdmin.tcSerializeJsOptionsObject(w)),e={action:"tm_export",metaserialized:O.stringify(e),is_original_post:g.is_original_post,security:g.export_nonce},P.post(g.ajax_url,e,function(e){e&&e.result&&""!==e.result?d.location=e.result:e&&e.error&&e.message&&(e=P.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+e.message+"</div>",title:g.i18n_error_title}),P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"300px",classname:"flasho tc-wrapper tm-error",data:e}))},"json").always(function(){t.data("doing_export",0).find(".tm-icon").remove()}))}),P(r).on("click.cpf","#builder_save",function(e){var t,i=P(this);i.data("doing_export")||(i.data("doing_export",1).prepend('<i class="tm-icon tcfa tcfa-spin tcfa-spinner"></i>'),w=P.tmEPOAdmin.checkSections(w),t={action:"tm_save",tm_uploadmeta:P.tmEPOAdmin.tm_escape(O.stringify(P.tmEPOAdmin.prepareForJson(P.tmEPOAdmin.tcSerializeJsOptionsObject(w)))),post_id:g.post_id,security:g.save_nonce},P("#tmformfieldsbuilderwrap").addClass("disabled"),e.preventDefault(),P.post(g.ajax_url,t,function(e){e&&e.result&&1===e.result?f.success(e.message,g.i18n_epo):f.error(e.message,g.i18n_epo)},"json").always(function(e){P("#tmformfieldsbuilderwrap").removeClass("disabled"),"-1"===e.responseText&&f.error(g.i18n_invalid_request,g.i18n_epo),i.data("doing_export",0).find(".tm-icon").remove()}))}),P(r).on("click.cpf","#builder_import,.tc-add-import-csv",function(e){e.preventDefault(),P("#builder_import_file").trigger("click")}),P(r).on("click.cpf","#builder-fullsize",function(e){e.preventDefault(),P("body").addClass("overflow fullsize")}),P(r).on("click.cpf","#builder-fullsize-close",function(e){e.preventDefault(),P("body").removeClass("overflow fullsize")}),P(r).on("click.cpf",".builder-add-element",P.tmEPOAdmin.builder_add_element_onClick),P(r).on("click.cpf",".builder_add_section,.tc-add-section ",P.tmEPOAdmin.builder_add_section_onClick),P(r).on("click.cpf",".builder-add-section-and-element,.tc-add-element",P.tmEPOAdmin.builder_add_section_and_element_onClick),P(r).on("click.cpf",".builder_add_variation",P.tmEPOAdmin.builder_add_variation_onClick),P(r).on("click.cpf",".builder-wrapper .section-settings .edit",P.tmEPOAdmin.builder_section_item_onClick),P(r).on("click.cpf",".builder-wrapper .section-settings .clone",P.tmEPOAdmin.builder_section_clone_onClick),P(r).on("click.cpf",".builder-wrapper .section-settings .plus",P.tmEPOAdmin.builder_section_plus_onClick),P(r).on("click.cpf",".builder-wrapper .section-settings .minus",P.tmEPOAdmin.builder_section_minus_onClick),P(r).on("click.cpf",".builder-wrapper .btitle .delete:not(.builder-wrapper.tma-variations-wrap .btitle .delete)",P.tmEPOAdmin.builder_section_delete_onClick),P(r).on("click.cpf",".builder-wrapper .btitle .fold",P.tmEPOAdmin.builder_section_fold_onClick),P(r).on("click",".builder-wrapper.tma-variations-wrap .btitle .delete",P.tmEPOAdmin.builder_variation_delete_onClick),P(r).on("click.cpf",".bitem .bitem-settings .edit",P.tmEPOAdmin.builder_item_onClick),P(r).on("click.cpf",".bitem .bitem-settings .clone",P.tmEPOAdmin.builder_clone_onClick),P(r).on("click.cpf",".bitem .bitem-settings .change",P.tmEPOAdmin.builder_change_onClick),P(r).on("click.cpf",".bitem .bitem-settings .plus",P.tmEPOAdmin.builder_plus_onClick),P(r).on("click.cpf",".bitem .bitem-settings .minus",P.tmEPOAdmin.builder_minus_onClick),P(r).on("click",".bitem .delete",P.tmEPOAdmin.builder_delete_onClick),P(r).on("click",".edit-element .tm-element-uniqid",P.tmEPOAdmin.builder_uniqid_onClick),P(r).on("click.cpf",".builder-panel-add",P.tmEPOAdmin.builder_panel_add_onClick),P(r).on("click.cpf",".builder-panel-add-separator",P.tmEPOAdmin.builder_panel_add_separator_onClick),P(r).on("click.cpf",".builder-panel-mass-add",P.tmEPOAdmin.builder_panel_mass_add_onClick),P(r).on("click.cpf",".builder-panel-populate",P.tmEPOAdmin.builder_panel_populate_onClick),P(r).on("click.cpf",".builder-image-delete",P.tmEPOAdmin.builder_image_delete_onClick),P(r).on("click.cpf",".builder_panel_delete",P.tmEPOAdmin.builder_panel_delete_onClick),P(".builder_panel_delete").on("click.cpf",P.tmEPOAdmin.builder_panel_delete_onClick),P(r).on("click.cpf",".builder_panel_delete_all",P.tmEPOAdmin.builder_panel_delete_all_onClick),P(r).on("click.cpf",".builder_panel_up",function(){var e=P(this),t=e.closest(".options-wrap");t.prev().before(t),P.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),P.tmEPOAdmin.paginattion_init("current")}),P(r).on("click.cpf",".builder_panel_down",function(){var e=P(this),t=e.closest(".options-wrap");t.next().after(t),P.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),P.tmEPOAdmin.paginattion_init("current")}),P(r).on("keyup.cpf change.cpf",".tm_option_title",function(){P(this).closest(".options-wrap").find(".tm_option_value").val(P("<div/>").html(P(this).val()).text())}),P(r).on("change.cpf changechoice",".tm_option_enabled",function(){var e=P(this);e.is(":checked")?e.closest(".options-wrap").removeClass("choice-is-disabled"):e.closest(".options-wrap").addClass("choice-is-disabled")}),P(r).on("click.cpf",".tc-element-setting-price, .tc-element-setting-sale-price, .tm_option_price, .tm_option_sale_price",function(){var e,r,a,i=P(this),t=i.is(".dynamic-product-price")||i.is(".change-product-weight"),n=i.is(".override-product-price")||i.is(".change-product-weight"),l=i.is(".tc-element-setting-price, .tc-element-setting-sale-price")?P(".tm-pricetype-selector"):i.closest(".options-wrap").find(".tm_option_price_type");"math"===l.val()&&(a=function(e){for(var t,i,n,a,l=[],o=["'",'"'],d=0;d<e.length;d++)if(t=e[d],o.includes(t)){for(i=t,n=d+1;n<e.length&&e[n]!==i;)n++;d=n}else if("["===t||"{"===t)l.push(t);else if(("]"===t||"}"===t)&&(!(a=l.pop())||"]"===t&&"["!==a||"}"===t&&"{"!==a))return!1;return 0===l.length},r=function(){var e,t=d.tcmexp,i=P(".tc-element-setting-edit-price").val(),n=!0;return t&&(e=i.replace(/\{[^}]+\}|\[[^\]]+\]/g,"(0)"),!1!==(n=t.parse(e))&&a(i)?P(".tc-element-setting-edit-price").removeClass("formula-error").addClass("formula-correct"):P(".tc-element-setting-edit-price").removeClass("formula-correct").addClass("formula-error")),n},l=i.val(),e=P.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content-pop",update:g.i18n_save,html:'<div class="tm-inner"><textarea class="tc-element-setting-edit-price"></textarea><div class="tc-price-variables"></div></div>',title:g.i18n_edit_price},"tc-floatbox-edit"),P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"50%",height:"80%",top:"10%",left:"25%",classname:"flasho tc-wrapper tc-builder-add-section-and-element",data:e,cancelClass:".floatbox-edit-cancel",updateClass:".floatbox-edit-update",updateEvent:function(e){var t=P(".tc-element-setting-edit-price").val();r(),i.val(t),e.destroy()},unique:!0}),P.tmEPOAdmin.populatePriceVariables(P(".tc-price-variables"),t,n),P(".tc-element-setting-edit-price").val(l),r(),P(".tc-var-field").on("click.cpf",function(e){var t=P(".tc-element-setting-edit-price"),i=t.val(),n=t[0],a=n.selectionStart,l=n.scrollTop,o=i.substring(0,a),i=i.substring(n.selectionEnd,i.length),d=P(this).attr("data-value");e.preventDefault(),t.val(o+d+i),a+=d.length,n.selectionStart=a,n.selectionEnd=a,t.trigger(" focus"),n.scrollTop=l,r()}),P(".formula-field-mode").on("change.cpf",function(){var t=P(this).val();P(".tc-var-list.other .tc-var-field").toArray().forEach(function(e){P(e).attr("data-value","{field."+P(e).attr("title")+"."+t+"}")})}),P(".tc-element-setting-edit-price").on("input.cpf",function(){r()}))}),P(r).on("click.cpf",".tc-upload-button",P.tmEPOAdmin.upload),P(r).on("change.cpf",".changes-product-image,.tm-use-lightbox,.replacement-mode",P.tmEPOAdmin.floatbox_content_js),P(r).on("change.cpf",".use_url",P.tmEPOAdmin.tm_url),P(r).on("change.cpf",".tm-pricetype-selector",P.tmEPOAdmin.tm_pricetype_selector),P(r).on("change.cpf",".tm_option_price_type",P.tmEPOAdmin.tm_option_price_type),P(r).on("change.cpf",".dynamic-mode",P.tmEPOAdmin.dynamicMode),P(r).on("change.cpf",".variations-display-as",P.tmEPOAdmin.variations_display_as),P(r).on("change.cpf",".tm-attribute .tm-changes-product-image",P.tmEPOAdmin.variations_display_as),P(r).on("click.cpf",".tm-upload-button-remove",P.tmEPOAdmin.tm_upload_button_remove_onClick),P(r).on("change.cpf",".tm-weekday-picker",P.tmEPOAdmin.tm_weekday_picker),P(r).on("change.cpf",".tm-month-picker",P.tmEPOAdmin.tm_month_picker),P(r).on("click.cpf",".tm-tags-container .tab-header",function(){var e=P(this),t=e.closest(".tm-tags-container"),i=t.find(".tm-elements-container").find("li.tm-element-button"),t=t.find(".tab-header"),n=e.attr("data-tm-tag");t.removeClass("open").addClass("closed"),e.removeClass("closed").addClass("open"),("all"===n?i:(i.addClass("tm-hidden"),i.filter("."+n))).removeClass("tm-hidden")}),P(r).on("click.cpf",".tm_editor_wrap",function(){var e=P(this).find("textarea");e.attr("id")&&(d.wpActiveEditor=e.attr("id"))}),P(r).on("change.cpf",".cpf-logic-element",P.tmEPOAdmin.cpf_logic_element_onchange),P(r).on("change.cpf",".cpf-logic-operator",P.tmEPOAdmin.cpf_logic_operator_onchange),P(r).on("change.cpf",".activate-sections-logic, .activate-element-logic",function(){P(this).is(":checked")?P(this).closest(".message0x0").find(".builder-logic-div").show():P(this).closest(".message0x0").find(".builder-logic-div").hide()}),P(r).on("dblclick.cpf",".tm-default-radio",function(){P(this).prop("checked",!1)}),o=function(e){if(13===e.keyCode)return e.preventDefault(),P.tmEPOAdmin.force_current_edit_label=!0,l(),!1},l=function(e){var t,i,n=P.tmEPOAdmin.current_edit_label;!P.tmEPOAdmin.current_edit_label||!0!==P.tmEPOAdmin.force_current_edit_label&&(n.is(e.target)||0!==n.has(e.target).length||P(e.target).is(".tm-internal-name"))||((e=n.closest(".tm-label-desc").next(".tm-label-desc-edit").find(".tm-internal-name")).trigger("change"),n.is(".tm-internal-label")&&n.html(e.val()).removeClass("tm-hidden"),n.is(".tm-element-label")&&n.removeClass("tm-hidden").closest(".tm-label-desc").find(".tm-internal-label").html(e.val()),n.closest(".tm-label-desc").removeClass("tm-hidden").next(".tm-label-desc-edit").addClass("tm-hidden"),""===e.val()?(n.closest(".tm-label-desc").removeClass("tc-has-value").addClass("tc-empty-value"),n.closest(".tm-label-desc").find(".tm-internal-label").html(n.closest(".tm-label-desc").find(".tm-element-label").html()),e.val(n.closest(".tm-label-desc").find(".tm-element-label").html())):n.closest(".tm-label-desc").removeClass("tc-empty-value").addClass("tc-has-value"),n=e.closest(".builder-wrapper").index(),t=P.tmEPOAdmin.find_index(w[n].section.is_slider,e.closest(".bitem")),(i=e.closest(".tm-label-desc-edit")).is(".tm-for-bitem")?P.tmEPOAdmin.setFieldValue(n,t,"internal_name",e.val(),!0):i.is(".tm-for-section")&&(w[n].section.sections_internal_name.default=e.val(),w[n].sections_internal_name=e.val()),e.remove(),P.tmEPOAdmin.current_edit_label=!1,P.tmEPOAdmin.force_current_edit_label=!1,P(r).off("mouseup",l),P(r).off("keydown",o))},P(r).on("click",".tm-element-label,.tm-internal-label",function(){var e,t,i=P(this),n=(P.tmEPOAdmin.current_edit_label=i).addClass("tm-hidden").closest(".tm-label-desc").addClass("tm-hidden").next(".tm-label-desc-edit").removeClass("tm-hidden"),a=i.closest(".builder-wrapper").index(),i=P.tmEPOAdmin.find_index(w[a].section.is_slider,i.closest(".bitem"));n.is(".tm-for-bitem")?(e=n.attr("data-element"),t=P.tmEPOAdmin.getFieldValue(w[a].fields[i],"internal_name",!0)):n.is(".tm-for-section")&&(e="sections",t=w[a].section.sections_internal_name.default),e+="_internal_name",e=P("<input type='text' value='"+t.replace(/'/g,"&#39;")+"' name='tm_meta[tmfbuilder]["+e+"][]' class='t tm-internal-name'>"),n.append(e),e.trigger(" focus"),P(r).on("mouseup",l),P(r).on("keydown",o)}),P(r).on("click.cpf",".cpf-add-rule",P.tmEPOAdmin.cpf_add_rule),P(r).on("click.cpf",".cpf-delete-rule",P.tmEPOAdmin.cpf_delete_rule),P(r).on("click.cpf",".tm-logic-add-rule-set",P.tmEPOAdmin.cpf_add_rule_set),P(r).on("click.cpf",".tma-handle-wrap .tma-handle",P.tmEPOAdmin.builder_fold_onClick),P(r).on("keyup change","#tc-floatbox-content .n[type=text]",function(){var e,t,i=P(this),n=i.val();return s&&n!==t&&(e=new RegExp("[^-0-9%.\\"+s.mon_decimal_point+"]+","gi"),t=n.replace(e,""),i.val(t),0===i.parent().find(".wc_error_tip").length)&&(n=i.position(),i.after('<div class="wc_error_tip">'+s.i18n_mon_decimal_error+"</div>"),P(".wc_error_tip").css("left",n.left+i.width()-i.width()/2-P(".wc_error_tip").width()/2).css("top",n.top+i.height()).fadeIn("100")),this}),P(r).on("click",".tc-enable-responsive",function(){var e=P(this),t=e.find(".on"),i=e.find(".off"),n=P("#tc-floatbox-content").find(".builder_responsive_div");e.is(".active")?(e.removeClass("active"),t.addClass("tc-hidden"),i.removeClass("tc-hidden"),n.addClass("tc-hidden")):(e.addClass("active"),t.removeClass("tc-hidden"),i.addClass("tc-hidden"),n.removeClass("tc-hidden"))}),P(r).on("change.cpf",".product-mode",function(){var e=P("#tc-floatbox-content"),t=P(this).val(),i=P(".product-default-value-search"),n=P(".product-products-selector");"product"===t?(t="products",n.is(".enhanced")&&n.prop("multiple")&&(n.selectWoo("destroy").removeClass("enhanced"),n.prop("multiple",!1),P.tmEPOAdmin.create_products_search(e)),n.prop("multiple",!1)):"products"===t&&(n.is(".enhanced")&&!n.prop("multiple")&&(n.selectWoo("destroy").removeClass("enhanced"),n.prop("multiple",!0),P.tmEPOAdmin.create_products_search(e)),n.prop("multiple",!0)),i.is(".enhanced")&&(i.selectWoo("destroy").removeClass("enhanced"),"products"===t?(i.removeData("action"),i.addClass("enhanced-dropdown"),n.triggerHandler("change.cpf"),P.tmEPOAdmin.create_enhanced_dropdown(e)):(i.data("action","wc_epo_search_products_in_categories"),i.addClass("wc-product-search"),P.tmEPOAdmin.create_products_search(e))),P(".product-"+t+"-selector").trigger("change.cpf")}),P(r).on("change.cpf",".product-default-value-search",function(){var i,n,t=P(this),a=t.val(),l=P(".product-mode"),e={action:"wc_epo_get_product_categories",product_id:a,security:g.get_products_categories_nonce};a&&P.post(g.ajax_url,e,function(e){t.data("categoryIds","success"===e.result?e.category_ids:[]),t.data("categoryIds")&&("categories"!==l.val()||a===t.attr("data-current-selected")||(i=P(".product-categories-selector").find(":selected").toArray().map(function(e){return parseInt(P(e).val(),10)}),n=!1,P.each(t.data("categoryIds"),function(e,t){if(-1!==P.inArray(parseInt(t,10),i))return!(n=!0)}),n)?(t.attr("data-current-selected",a),t.data("current-selected-text",t.find(":selected").text())):(t.find("option").remove(),this.removeAttr("data-current-selected"),this.removeData("current-selected-text"),this.removeData("categoryIds"),this.removeData("include")))})}),P(r).on("change.cpf",".product-products-selector",function(){var e=P(this),t=P(".product-default-value-search"),e=e.find(":selected").clone().prop("selected",!1).removeAttr("data-select2-id");t.removeData("action"),t.find("option").remove(),t.append(e),t.val(t.attr("data-current-selected")).trigger("change.cpf")}),P(r).on("change.cpf",".product-categories-selector",function(){var i,n=P(this).find(":selected").toArray().map(function(e){return parseInt(P(e).val(),10)}),e=P(".product-default-value-search");e.data("include",n),e.data("action","wc_epo_search_products_in_categories"),e.data("categoryIds")&&(i=!1,P.each(e.data("categoryIds"),function(e,t){if(-1!==P.inArray(parseInt(t,10),n))return!(i=!0)}),i||(e.find("option").remove(),e.removeAttr("data-current-selected"),e.removeData("current-selected-text"),e.removeData("categoryIds")))}),P().ajaxChosen&&P("select.ajax_chosen_select_tmProductIds").ajaxChosen({method:"GET",url:g.ajax_url,dataType:"json",afterTypeDelay:100,data:{action:"woocommerce_json_search_products",security:g.search_products_nonce}},function(e){var i={};return P.each(e,function(e,t){i[e]=t}),i}),P("body").on("woocommerce-product-type-change",function(){var e=P("#product-type");P.tmEPOAdmin.initSectionsCheck(),e.length&&("variable"!==e.val()&&"variable-subscription"!==e.val()&&(e=P(".builder-layout .element-variations")).length&&(e.closest(".builder-wrapper").remove(),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.section_logic_init(),P.tmEPOAdmin.initSectionsCheck(),P.tmEPOAdmin.toggleVariationButton(),P.tmEPOAdmin.var_remove("tm-style-variation-added")),P.tmEPOAdmin.toggleVariationButton())}),P(r).on("change.cpf",".apply-mode, .product_page_tm-global-epo #product_catdiv input:checkbox, .product_page_tm-global-epo #tm_product_ids, .product_page_tm-global-epo #tc-enabled-options, .product_page_tm-global-epo #tc-disabled-options",function(){setTimeout(function(){P.tmEPOAdmin.checkIfApplied()},100)}),P(r).on("change.cpf",".apply-mode",function(){P.tmEPOAdmin.applyMode(P(this))}),P('#product_catchecklist input[type="checkbox"]').on("change",function(){P.tmEPOAdmin.checkboxStates[this.id]=P(this).prop("checked"),setTimeout(function(){P.tmEPOAdmin.applyMode(P(".apply-mode:checked"))},100)}),t.length&&t.toArray().forEach(function(e){new MutationObserver(function(){P.tmEPOAdmin.checkIfApplied()}).observe(e,{attributes:!0,childList:!0,subtree:!0})}),P.tmEPOAdmin.addEventsDone=1)},initialitize:function(){P.tmEPOAdmin.setGlobalVariationObject("initialitize_on")},initialitize_on:function(){P.tmEPOAdmin.isinit=!0,P.tmEPOAdmin.pre_element_logic_init_obj={},P.tmEPOAdmin.pre_element_logic_init_obj_options={},P.tmEPOAdmin.pre_element_logic_init(!0),P.tmEPOAdmin.pre_element_logic_init_done=!0,P.tmEPOAdmin.is_original=g.is_original_post,P.tmEPOAdmin.current_edit_label=!1,P.tmEPOAdmin.force_current_edit_label=!1,P.tmEPOAdmin.toggleVariationButton(),P.tmEPOAdmin.addEvents(),P.tmEPOAdmin.check_section_logic(),P.tmEPOAdmin.check_element_logic(),P.tmEPOAdmin.sectionLogicStart(),P.tmEPOAdmin.elementLogicStart(),P(".builder-wrapper.tm-slider-wizard").each(function(){var e=P(this);P.tmEPOAdmin.createSlider(e)}),P("#side-sortables").prepend(P('<div class="tc-info-box hidden"></div>')),P(function(){P.tmEPOAdmin.checkIfApplied(),P.tmEPOAdmin.applyModeInit(),P.tmEPOAdmin.checkboxStates={},P('#product_catchecklist input[type="checkbox"]').each(function(){P.tmEPOAdmin.checkboxStates[this.id]=P(this).prop("checked")})}),P.tmEPOAdmin.initSectionsCheck(),P.tmEPOAdmin.fixFormSubmit(),P.tmEPOAdmin.pre_element_logic_init_done=!1,P.tmEPOAdmin.isinit=!1,P(".builder-layout").removeClass("tm-hidden"),P.tmEPOAdmin.makeResizables(P(".builder-wrapper")),P.tmEPOAdmin.makeResizables(P(".bitem"))},initialitize_on_after:function(){P.tmEPOAdmin.isinit=!0,P.tmEPOAdmin.pre_element_logic_init_obj={},P.tmEPOAdmin.pre_element_logic_init_obj_options={},P.tmEPOAdmin.pre_element_logic_init(!0),P.tmEPOAdmin.pre_element_logic_init_done=!0,P.tmEPOAdmin.is_original=g.is_original_post,P.tmEPOAdmin.current_edit_label=!1,P.tmEPOAdmin.force_current_edit_label=!1,P.tmEPOAdmin.var_remove("tm-style-variation-added"),P.tmEPOAdmin.toggleVariationButton(),P.tmEPOAdmin.addSortables(),P.tmEPOAdmin.check_section_logic(),P.tmEPOAdmin.check_element_logic(),P.tmEPOAdmin.sectionLogicStart(),P.tmEPOAdmin.elementLogicStart(),P(".builder-wrapper.tm-slider-wizard").each(function(){var e=P(this);P.tmEPOAdmin.createSlider(e)}),P.tmEPOAdmin.initSectionsCheck(),P.tmEPOAdmin.fixFormSubmit(),P.tmEPOAdmin.makeResizables(P(".builder-wrapper")),P.tmEPOAdmin.makeResizables(P(".bitem")),P.tmEPOAdmin.pre_element_logic_init_done=!1,P.tmEPOAdmin.isinit=!1},makeResizables:function(e){var s,t=Object.keys(P.tmEPOAdmin.builderSize),c=[];0===(e=P(e)).length||e.closest(".builder-layout").is(".builder-template")||(t.forEach(function(e){c.push(parseFloat(P.tmEPOAdmin.builderSize[e].replace("%",""),10))}),e.not(".tma-nomove").toArray().forEach(function(d){var r;d=P(d),r=d.is(".bitem")?d.closest(".bitem-wrapper").first():d.closest(".builder-layout"),d.is(".ui-resizable")&&d.resizable().resizable("destroy"),d.resizable({maxWidth:r.width(),minWidth:r.width()/8,start:function(e,t){t.originalElement.addClass("tm-label-info-hidden"),s=parseFloat(P.tmEPOAdmin.builderSize[t.originalElement.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0]].replace("%",""),10)},stop:function(e,t){var i,n,a=100*t.size.width/r.width(),l=c.filter(function(e){return e<=a}),o=c.filter(function(e){return a<=e}),t=t.originalElement;t.removeClass("ui-highlight tm-label-info-hidden"),l=l[l.length-1],((o=void 0===(o=o[0])?c[c.length-1]:o)-(l=void 0===l?o<=s?c[c.length-1]:c[1]:l))/2<a-l?(i="w"+o.toString().replace(".","-"),t.css("width",o+"%")):(i="w"+l.toString().replace(".","-"),t.css("width",l+"%")),o=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],l=P.tmEPOAdmin.builderSize[i],i!==o&&(t.removeClass(String(o)),t.addClass(String(i)),(d.is(".bitem")?t.find(".bitem-inner .size"):t.find(".section-inner .size")).text(l),o=t.closest(".builder-wrapper").index(),n=P.tmEPOAdmin.find_index(w[o].section.is_slider,t),d.is(".bitem")?P.tmEPOAdmin.setFieldValue(o,n,"div_size",i):(w[o].section.sections_size.default=i,w[o].size=l)),d.is(".builder-wrapper")&&P.tmEPOAdmin.makeResizables(d.find(".bitem")),(t.is(".bitem")?t.find(".bitem-settings"):t.find(".section-settings")).removeClass("show")},resize:function(e,t){var i=100*t.size.width/r.width(),n=c.filter(function(e){return e<=i}),a=t.originalElement;void 0===(n=n[n.length-1])&&(n=c[c.length-1]),a.addClass("ui-highlight"),(a.is(".bitem")?a.find(".bitem-settings").addClass("show").find(".bitem-setting.size"):a.find(".section-settings").addClass("show").find(".section-setting.size")).html(n+"%"),t.size.height=t.originalSize.height}})}))},cpf_logic_element_onchange:function(e,t){var i,n,a,l,o,d,r=P(this),s="tc-hidden-no-events";e instanceof P&&(r=e),e=(t=void 0===t?!(t=P(this).closest(".section_elements, .builder-wrapper, .bitem, .builder-element-wrap")).is(".section_elements")&&!t.is(".builder-wrapper"):t)?2===t?P.tmEPOAdmin.elementShippingLogicObject:P.tmEPOAdmin.elementLogicObject:P.tmEPOAdmin.sectionLogicObject,t=r.val(),i=r.children("option:selected").attr("data-section"),n=r.children("option:selected").attr("data-type"),a=void 0!==(a=e)[i]&&void 0!==(a=e[i].values)[t]&&e[i].values[t],e=r.closest(".tm-logic-rule").find(".tm-logic-value"),l=(r=r.closest(".tm-logic-rule").find(".cpf-logic-operator")).val(),d=(o=["startswith","endswith","greaterthan","lessthan","greaterthanequal","lessthanequal"]).concat("is","isnot"),a?(a=P(a),e.empty().append(a),r.children().filter(function(e,t){return-1!==P.inArray(P(t).val(),["is","isnot"])}).removeClass(s),"variation"===n||"multiple"===n?(-1!==P.inArray(l,o)&&r.val("isempty"),r.children().filter(function(e,t){return-1!==P.inArray(P(t).val(),o)}).addClass(s),r.trigger("change.cpf")):r.children().filter(function(e,t){return-1!==P.inArray(P(t).val(),o)}).removeClass(s)):t===i?(-1!==P.inArray(l,d)&&r.val("isempty"),r.children().filter(function(e,t){return-1!==P.inArray(P(t).val(),d)}).addClass(s),r.trigger("change.cpf")):r.children().filter(function(e,t){return-1!==P.inArray(P(t).val(),d)}).removeClass(s)},cpf_logic_operator_onchange:function(e){var t=P(this),e=(t=e instanceof P?e:t).val(),t=t.closest(".tm-logic-rule").find(".tm-logic-value");"isempty"===e||"isnotempty"===e?t.hide():t.show()},createSlider:function(d){d.tmtabs({headers:"tm-slider-wizard-headers",header:"tm-slider-wizard-header",selectedtab:0,showonhover:function(){return P.tmEPOAdmin.isElementDragged},useclasstohide:!0,afteraddtab:function(e,t){var i,n,a=d.index();P.tmEPOAdmin.builder_items_sortable(t),d.is(".tm-slider-wizard")?(i=d.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(","),n=w[a].section.sections_tabs_labels.default||"null",(n=(n=P.epoAPI.util.parseJSON(n))||[]).push(P(e).text()),n=O.stringify(n)):(i="",(n=[]).push(P(e).text())),w[a].section.sections_slides.default=i,w[a].section.sections_tabs_labels.default=n},deletebutton:!0,deleteconfirm:!0,beforedeletetab:function(e,t){var i=d.index(),n=t.find(".bitem").length,a=P.tmEPOAdmin.find_index(!0,t.find(".bitem").first());P.tmEPOAdmin.sliderTabDeleteBefore=[],t.find(".bitem").toArray().forEach(function(e){P.tmEPOAdmin.sliderTabDeleteBefore.push({field_index:P.tmEPOAdmin.find_index(!0,P(e)),disabledFieldIndex:P.tmEPOAdmin.find_index(!0,P(e),".bitem",".element-is-disabled")})}),w[i].fields.splice(a,n),w[i].section.sections.default=parseInt(w[i].section.sections.default,10)-n,w[i].section.sections.default=w[i].section.sections.default.toString(),t=w[i].section.sections_tabs_labels.default||"null",t=(t=P.epoAPI.util.parseJSON(t))||[],a=e.closest(".tm-box").index(),t.splice(a,1),t=O.stringify(t),w[i].section.sections_tabs_labels.default=t},afterdeletetab:function(){var e,i=d.index(),n=0,t=d.is(".tm-slider-wizard")?d.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(","):"";d.is(".is-slider")&&(e=[],d.find(".tm-slider-wizard-header").toArray().forEach(function(e){P(e).find(".tab-text").html(P(e).closest(".tm-box").index()+1)}),e=O.stringify(e),w[i].section.sections_tabs_labels.default=e),w[i].section.sections_slides.default=t,P.tmEPOAdmin.sliderTabDeleteBefore.forEach(function(e,t){P.tmEPOAdmin.builderItemsSortableObj.start.section=w[i].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.start.section_eq=i.toString(),P.tmEPOAdmin.builderItemsSortableObj.start.element=-1===P.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex?"-1":parseInt(P.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex,10)-t+n,-1===P.tmEPOAdmin.sliderTabDeleteBefore[t].disabledFieldIndex&&(P.tmEPOAdmin.builderItemsSortableObj.start.disabled=!0,P.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=-1,n+=1),P.tmEPOAdmin.builderItemsSortableObj.end.section="delete",P.tmEPOAdmin.builderItemsSortableObj.end.section_eq="delete",P.tmEPOAdmin.builderItemsSortableObj.end.element="delete",P.tmEPOAdmin.builderItemsSortableObj.end.novalidate="delete",P.tmEPOAdmin.logic_reindex()}),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.section_logic_init(),P.tmEPOAdmin.initSectionsCheck()},aftermovetab:function(e,t){var i,n=d.index();w[n].section.sections_slides.default=P(".builder-wrapper").eq(n).find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(","),i=w[n].section.sections_tabs_labels.default||"null",t=(i=(i=P.epoAPI.util.parseJSON(i))||[]).splice(t,1)[0],i.splice(e,0,t),i=O.stringify(i),w[n].section.sections_tabs_labels.default=i,P.tmEPOAdmin.section_logic_init(),P.tmEPOAdmin.initSectionsCheck(),d.is(".is-slider")&&(i=[],d.find(".tm-slider-wizard-header").toArray().forEach(function(e){var t=P(e).closest(".tm-box").index()+1;P(e).find(".tab-text").html(t),i.push(t)}),i=O.stringify(i),w[n].section.sections_tabs_labels.default=i)},beforemovebitem:function(e,t,i,n,a){var l=d.index();P.tmEPOAdmin.builderItemsSortableObj.start.section=w[l].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),P.tmEPOAdmin.builderItemsSortableObj.start.element=P.tmEPOAdmin.find_index(!0,a).toString(),P.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=P.tmEPOAdmin.find_index(!0,a,".bitem",".element-is-disabled")},aftermovebitem:function(e,t,i,n,a){var l=d.index(),o=P.tmEPOAdmin.find_index(!0,a);P.tmEPOAdmin.builderItemsSortableObj.end.section=w[l].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.end.section_eq=l.toString(),P.tmEPOAdmin.builderItemsSortableObj.end.element=P.tmEPOAdmin.find_index(!0,a).toString(),P.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=P.tmEPOAdmin.find_index(!0,a,".bitem",".element-is-disabled"),w[l].fields.splice(o,0,w[P.tmEPOAdmin.builderItemsSortableObj.start.section_eq].fields.splice(P.tmEPOAdmin.builderItemsSortableObj.start.element,1)[0]),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.logic_reindex()},editbutton:d.is(".is-tabs"),oneditbutton:function(t){var i=d.index(),n=w[i].section.sections_tabs_labels.default||"null",a=t.closest(".tm-box").index(),e=P.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content-pop",update:g.i18n_save,html:'<div class="tm-inner"><input type="text" class="tc-element-setting-edit-tab"></div>',title:g.i18n_edit_tab},"tc-floatbox-edit"),l=P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"50%",top:"25%",left:"25%",classname:"flasho tc-wrapper",data:e,cancelClass:".floatbox-edit-cancel",unique:!0}),o=this;n=(n=P.epoAPI.util.parseJSON(n))||[],P(".tc-element-setting-edit-tab").val(n[a]),P(".floatbox-edit-update").on("click.cpf",function(e){e.preventDefault(),n[a]=P(".tc-element-setting-edit-tab").val(),t.closest(".tm-slider-wizard-header").find(".tab-text").html(n[a]),n=O.stringify(n),w[i].section.sections_tabs_labels.default=n,l.destroy(),o.trigger("refresh")})},addbutton:!!P.tmEPOAdmin.is_original}),w[d.index()].section.is_slider=!0},sections_type_onChange:function(e){var t,i,n,a=w[e].section.sections_type.default,l=P(".builder-wrapper").eq(e);"slider"!==a&&"tabs"!==a||!l.hasClass("tm-slider-wizard")?"slider"!==a&&"tabs"!==a||l.hasClass("tm-slider-wizard")?"slider"!==a&&"tabs"!==a&&l.hasClass("tm-slider-wizard")&&(l.find(".bitem-wrapper").wrapAll('<div class="tmtemp"></div>'),l.find(".bitem-wrapper .bitem").appendTo(l.find(".tmtemp")),l.find(".bitem-wrapper").remove(),l.find(".tmtemp").addClass("bitem-wrapper").removeClass("tmtemp"),P.tmEPOAdmin.builder_items_sortable(l.find(".bitem-wrapper")),l.find(".tm-slider-wizard-headers").remove(),l.find(".tc-tab-headers-wrap").remove(),l.removeClass("tm-slider-wizard is-tabs is-slider has-add-button"),l.removeData("tctabs").removeData("tmHasTmtabs"),w[e].section.sections_slides.default="",w[e].section.sections_tabs_labels.default="",w[e].section.is_slider=!1):(t=l.find(".bitem-wrapper"),n=l.find(".btitle"),l.addClass("tm-slider-wizard is-"+a),n.after('<div class="transition tm-slider-wizard-headers"><div class="tm-box"><h4 class="tm-slider-wizard-header" data-id="tc-tab-slide0"><span class="tab-text">1</span></h4></div></div>'),t.addClass("tc-tab-slide tc-tab-slide0"),P.tmEPOAdmin.createSlider(l),w[e].section.sections_slides.default=l.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(","),w[e].section.is_slider=!0,w[e].section.sections_tabs_labels.default=O.stringify(["1"])):l.is(".is-slider")&&"tabs"===a?(i=[],l.find(".tm-slider-wizard-header").toArray().forEach(function(e){e=P(e).find(".tab-text");void 0!==e.data("tabtext")&&e.html(e.data("tabtext")),i.push(e.text())}),i=O.stringify(i),l.removeClass("is-slider").addClass("is-tabs").tcTabs("set",{editbutton:!0}),w[e].section.sections_tabs_labels.default=i):l.is(".is-tabs")&&"slider"===a&&(l.removeClass("is-tabs has-add-button").addClass("is-slider").tcTabs("set",{editbutton:!1}),l.find(".tm-slider-wizard-header").toArray().forEach(function(e){var e=P(e),t=e.find(".tab-text"),e=e.closest(".tm-box").index()+1;t.data("tabtext",t.text()),t.html(e)}),w[e].section.sections_tabs_labels.default="")},variationEventsSuccess:function(){setTimeout(function(){P.tmEPOAdmin.setGlobalVariationObject("reindex")},600),P(r).unbind("ajaxSuccess",P.tmEPOAdmin.variationEventsSuccess),P.tmEPOAdmin.var_remove("tma-remove_variation-added")},variationsCheckEventsSuccess:function(){setTimeout(function(){P.tmEPOAdmin.variationsCheckForChanges=1,P.tmEPOAdmin.tm_variations_check()},600),P(r).unbind("ajaxSuccess",P.tmEPOAdmin.variationsCheckEventsSuccess),P.tmEPOAdmin.var_remove("tma-remove_variation-added")},addVariationEvents:function(){!0!==P.tmEPOAdmin.var_is("tma-variation-events-added")&&(!0!==P.tmEPOAdmin.var_is("tma-remove_variation-added")&&P("#variable_product_options").on("click.tma",".remove_variation",function(){P(r).ajaxSuccess(P.tmEPOAdmin.variationEventsSuccess),P.tmEPOAdmin.var_is("tma-remove_variation-added",!0),P(r).ajaxSuccess(P.tmEPOAdmin.variationsCheckEventsSuccess)}),!0!==P.tmEPOAdmin.var_is("tma-remove_variation-added")&&P(".wc-metaboxes-wrapper").on("click","a.bulk_edit",function(){"delete_all"===P("select#field_to_edit").val()&&(P(r).ajaxSuccess(P.tmEPOAdmin.variationEventsSuccess),P.tmEPOAdmin.var_is("tma-remove_variation-added",!0),P(r).ajaxSuccess(P.tmEPOAdmin.variationsCheckEventsSuccess))}),P("#variable_product_options").on("woocommerce_variations_added",function(){P.tmEPOAdmin.setGlobalVariationObject("reindex"),P(r).ajaxSuccess(P.tmEPOAdmin.variationsCheckEventsSuccess)}),P("#woocommerce-product-data").on("woocommerce_variations_saved",function(){P.tmEPOAdmin.setGlobalVariationObject("reindex"),P(r).ajaxSuccess(P.tmEPOAdmin.variationsCheckEventsSuccess)}),P(r).on("click.cpf",".save_attributes",function(){P(r).ajaxSuccess(P.tmEPOAdmin.variationsCheckEventsSuccess)}),P.tmEPOAdmin.var_is("tma-variation-events-added",!0))},toggleVariationButton:function(){var e,t,i=P("#product-type");i.length&&("variable"===i.val()||"variable-subscription"===i.val()?(P(".builder_add_section").addClass("inline"),P(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),P(".tma-variations-wrap").removeClass("tm-hidden"),P.tmEPOAdmin.addVariationEvents(),i=!1,(e=P(".builder-layout .element-variations")).length?"1"===P.tmEPOAdmin.getFieldValue(P.tmEPOAdmin.variationSection,"variations_disabled")&&(i=!0,e=P(".builder-layout .element-variations"),P.tmEPOAdmin.var_is("tm-style-variation-forced",!0)):(P.tmEPOAdmin.var_is("tm-style-variation-forced",!0),P.tmEPOAdmin.builder_add_variation_onClick(),i=!0,e=P(".builder-layout .element-variations")),e.length&&((t=e.closest(".builder-wrapper")).find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),t.addClass("tma-nomove tma-variations-wrap"),P.tmEPOAdmin.var_is("tm-style-variation-added",!0),e.addClass("tma-nomove"),e.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.change,.bitem-settings .minus,.tm-label-delete").remove(),i?(P.tmEPOAdmin.setFieldValue(P.tmEPOAdmin.variationSectionIndex,P.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),P(".builder_add_section").addClass("inline"),P(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),P(".tma-variations-wrap").addClass("tm-hidden")):(P.tmEPOAdmin.setFieldValue(P.tmEPOAdmin.variationSectionIndex,P.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),P(".builder_add_section").removeClass("inline"),P(".builder_add_variation").removeClass("inline").addClass("tm-hidden"),P(".tma-variations-wrap").removeClass("tm-hidden")),P.tmEPOAdmin.variationsCheckForChanges=1,P.tmEPOAdmin.tm_variations_check()),1<P(".tma-variations-wrap").length&&P(".tma-variations-wrap").not(":first").each(function(){var e=P(this).closest(".builder-wrapper"),t=e.index();e.remove(),w.splice(t,1),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.section_logic_init(),P.tmEPOAdmin.initSectionsCheck()})):(P(".builder_add_section").removeClass("inline"),P(".builder_add_variation").removeClass("inline").addClass("tm-hidden")))},tcSerializeJsOptionsArray:function(e){var t=[].concat.apply([],e.map(function(t){return Object.keys(t.section).map(function(e){return t&&"object"==typeof t.section[e]?t.section[e]:null}).filter(function(e){return null!=e})})),i=[].concat.apply([],e.map(function(e){return[].concat.apply([],e.fields.map(function(e){return[].concat.apply([],e.filter(function(e){return null!==e}).map(function(e){return e&&"multiple"===e.id?[].concat.apply([],e.multiple):e}))}))}));return e=(e=[].concat.apply([],[t,i])).map(function(e){return e?void 0===e.checked||!0===e.checked?{name:e.tags.name,value:e.default}:{name:e.tags.name,value:""}:{}}).filter(function(e){return null!=e})},tcSerializeJsOptionsObject:function(e){var t={},e=P.tmEPOAdmin.tcSerializeJsOptionsArray(e);return P("#tm_meta_priority").length&&e.push({name:"tm_meta[priority]",value:P("#tm_meta_priority").val()}),P.each(e,function(){void 0!==t[this.name]?"[]"===this.name.slice(-2)?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):""===t[this.name]&&(t[this.name]=this.value||""):null!==this.value&&void 0!==this.value&&this.value.push?t[this.name]=[this.value]:t[this.name]=this.value||""}),t},checkSections:function(t){return Object.keys(t).forEach(function(e){t[e].section.sections.default=t[e].fields.length}),t},prepareForJson:function(t){var i,n,a={};return Object.keys(t).forEach(function(e){0===e.indexOf("tm_meta[")&&((i=e.split(/[[\]]{1,2}/)).pop(),i=i.map(function(e){return""===e?null:e}),n=0<i.length&&null===i[i.length-1],i=i.filter(function(e){return null!=e?e:null}),n="object"!=typeof t[e]&&n?[t[e]]:t[e],a=P.tmEPOAdmin.constructObject(i,n,a))}),a},constructObject:function(e,t,i){var n=e.shift();return 0<e.length?(Object.prototype.hasOwnProperty.call(i,n)||(i[n]={}),i[n]=P.tmEPOAdmin.constructObject(e,t,i[n])):i[n]=t,i},createTmMetaSerialized:function(){var e,t,i=P("input#wp-preview"),n=P("#tmformfieldsbuilderwrap");P(".tm_meta_serialized").remove(),P(".tm_meta_serialized_wpml").remove(),t=P.tmEPOAdmin.is_original?"tm_meta_serialized":"tm_meta_serialized_wpml",w=P.tmEPOAdmin.checkSections(w),e=P.tmEPOAdmin.tm_escape(O.stringify(P.tmEPOAdmin.prepareForJson(P.tmEPOAdmin.tcSerializeJsOptionsObject(w)))),t=P("<textarea class='tm_meta_serialized tm-hidden' name='"+t+"'></textarea>").val(e),n.prepend(t),0<i.length&&""!==i.val()&&P(".tm_meta_serialized").remove()},fixFormSubmit:function(){var n,e=P("#post");1===e.length?e.on("submit",function(){return P.tmEPOAdmin.createTmMetaSerialized(),!0}):_.data&&void 0!==_.data.subscribe&&(n=!1,"function"==typeof(e=_.data.subscribe))&&e(function(){var e,t,i;_.data.select("core/editor")&&(t=_.data.select("core/editor").didPostSaveRequestSucceed(),i=_.data.select("core/editor").didPostSaveRequestFail(),_&&_.data&&_.data.select("core/editor")&&(e=_.data.select("core/editor").isSavingPost()),!n&&e&&(n=!0,P.tmEPOAdmin.createTmMetaSerialized()),n)&&(t||i)&&(n=!1,setTimeout(function(){P(".tm_meta_serialized").remove(),P(".tm_meta_serialized_wpml").remove()},600))})},initSectionsCheck:function(){var e=P(".builder-wrapper").length;(e=1===e&&P(".builder-wrapper.tma-variations-wrap.tm-hidden").length?0:e)?(P(".builder-add-section-action").show(),P(".builder-selector").show(),P(".tc-welcome").hide(),P(".builder-layout").show()):(P(".builder-add-section-action").hide(),P(".builder-selector").hide(),P(".tc-welcome").show(),P(".builder-layout").hide())},applyModeInit:function(){setTimeout(function(){P.tmEPOAdmin.applyMode(P(".apply-mode:checked"))},100)},applyMode:function(e){var t,i,e=e.val(),n="disable-form"===e||"customize-selection"===e&&!P("#product_catchecklist :checkbox:checked").length?1:0,a=P("#tm_product_ids"),l=P("#tm_product_exclude_ids"),o=P("#tc-enabled-options"),d=P("#tc-disabled-options");if("apply-to-all-products"===e)P("#product_catchecklist").find(":checkbox").prop("checked",!1);else for(t in P.tmEPOAdmin.checkboxStates)P("#"+t).prop("checked",P.tmEPOAdmin.checkboxStates[t]);"apply-to-all-products"===e||"customize-selection"===e?((i=l.data("saved-exclude-ids"))&&i.length&&(l.html(P.map(i,function(e){return e.html}).join("")),l.find("option").each(function(e){i[e].checked&&P(this).prop("selected",!0)}),l.removeData("saved-exclude-ids")),(i=o.data("saved-enabled-roles"))&&i.length&&(o.html(P.map(i,function(e){return e.html}).join("")),o.find("option").each(function(e){i[e].checked&&P(this).prop("selected",!0)}),o.removeData("saved-enabled-roles")),(i=d.data("saved-disabled-roles"))&&i.length&&(d.html(P.map(i,function(e){return e.html}).join("")),d.find("option").each(function(e){i[e].checked&&P(this).prop("selected",!0)}),d.removeData("saved-disabled-roles"))):"disable-form"===e&&(i=l.find("option").map(function(){return{html:P(this).prop("outerHTML"),checked:P(this).prop("selected")}}).get(),l.data("saved-exclude-ids",i),l.html(""),i=o.find("option").map(function(){return{html:P(this).prop("outerHTML"),checked:P(this).prop("selected")}}).get(),o.data("saved-enabled-roles",i),o.html(""),i=d.find("option").map(function(){return{html:P(this).prop("outerHTML"),checked:P(this).prop("selected")}}).get(),d.data("saved-disabled-roles",i),d.html("")),"customize-selection"===e?(i=a.data("saved-include-ids"))&&i.length&&(a.html(P.map(i,function(e){return e.html}).join("")),a.find("option").each(function(e){i[e].checked&&P(this).prop("selected",!0)}),a.removeData("saved-include-ids")):"apply-to-all-products"!==e&&"disable-form"!==e||(i=a.data("saved-include-ids"))&&i.length||(i=a.find("option").map(function(){return{html:P(this).prop("outerHTML"),checked:P(this).prop("selected")}}).get(),a.data("saved-include-ids",i),a.html("")),"apply-to-all-products"===e?(P("#product_catdiv").hide(),P('.postbox[id^="tagsdiv-"]').hide(),P("#tc-product-search").hide(),P("#tc-product-exclude").show(),P("#tc-product-roles").show()):"customize-selection"===e?(P("#product_catdiv").show(),P('.postbox[id^="tagsdiv-"]').show(),P("#tc-product-search").show(),P("#tc-product-exclude").show(),P("#tc-product-roles").show()):"disable-form"===e&&(P("#product_catdiv").hide(),P('.postbox[id^="tagsdiv-"]').hide(),P("#tc-product-search").hide(),P("#tc-product-exclude").hide(),P("#tc-product-roles").hide()),P("#tm_meta_disable_categories").val(n)},checkIfApplied:function(){var e,t,i,n,a;P("body").is(".product_page_tm-global-epo")&&(e=P(".apply-mode:checked").val(),t=0<P("#product_catdiv input:checkbox").filter(":checked").length,a=0<P(".tagchecklist").children("li").length,i=P("#tm_product_ids").val(),n=P("#tc-enabled-options").val(),i=!(!i||null===i)&&0<i.length,n=!(!n||null===n)&&0<n.length,"apply-to-all-products"===e?P(".tc-info-box").removeClass("hidden error").addClass("tc-all-products").html(g.i18n_form_is_applied_to_all):"customize-selection"===e&&(t||a||i||n)?P(".tc-info-box").removeClass("tc-error tc-all-products").addClass("hidden").html(""):P(".tc-info-box").removeClass("hidden tc-all-products").addClass("tc-error").html(g.i18n_form_not_applied_to_all))},check_section_logic:function(e){var i;!(Number.isFinite(e)||e instanceof P)&&P.tmEPOAdmin.isinit&&P.tmEPOAdmin.done_check_section_logic||(void 0===(e=e instanceof P?parseInt(e.index(),10):e)?i=w:(i=[],e=P.epoAPI.math.toFloat(e),i[e]=w[e]),Object.keys(i).forEach(function(e){var t=i[e];void 0===t.section||(t=t.section.sections_uniqid.default)&&""!==t&&void 0!==t&&!1!==t||(w[e].section.sections_uniqid.default=P.epoAPI.math.uniqueid("",!0))}),P.tmEPOAdmin.done_check_section_logic=!0)},check_element_logic:function(e,t){var n,a,l,o,d=[],r=!1;!(Number.isFinite(e)||e instanceof P)&&P.tmEPOAdmin.isinit&&P.tmEPOAdmin.done_check_element_logic||(e instanceof P&&e.length&&(t=e.closest(".builder-wrapper").index(),w[t])&&w[t].section&&(e=P.tmEPOAdmin.find_index(w[t].section.is_slider,e)),void 0===t&&void 0!==e)||(void 0===e?(n=w,r=!0):(n=[],t=P.epoAPI.math.toFloat(t),e=P.epoAPI.math.toFloat(e),n[t]=P.extend(!0,{},w[t]),l=n[t].fields[e],n[t].fields=[],n[t].fields[e]=l),Object.keys(n).forEach(function(i){a=n[i].fields,Object.keys(a).forEach(function(e){var t;l=a[e],o=P.tmEPOAdmin.getFieldValue(l,"element_type"),t=P.tmEPOAdmin.getFieldValue(l,"uniqid",o),(r&&-1!==d.indexOf(t)||!t||""===t||void 0===t||!1===t)&&P.tmEPOAdmin.setFieldValue(i,e,"uniqid",P.epoAPI.math.uniqueid("",!0),o),r&&d.push(P.tmEPOAdmin.getFieldValue(w[i].fields[e],"uniqid",o))})}),P.tmEPOAdmin.done_check_element_logic=!0)},sectionLogicStart:function(e){var t,i;void 0===e?t=w:(t=[],e=P.epoAPI.math.toFloat(e),t[e]=P.extend(!0,{},w[e])),Object.keys(t).forEach(function(e){P.tmEPOAdmin.section_logic_init(e);try{i=t[e].section.sections_logicrules.default||"null",i=P.epoAPI.util.parseJSON(i),i=P.tmEPOAdmin.logic_check_section_rules(i),w[e].section.sections_logicrules.default=O.stringify(i),w[e].section.rules_toggle=i.toggle}catch(e){}})},elementLogicStart:function(e,t){var i,n,a,l,o,d;void 0===e?a=w:(a=[],t=P.epoAPI.math.toFloat(t),e=P.epoAPI.math.toFloat(e),a[t]=P.extend(!0,{},w[t]),o=a[t].fields[e],a[t].fields=[],a[t].fields[e]=o),Object.keys(a).forEach(function(t){void 0!==(l=a[t].fields)&&Object.keys(l).forEach(function(e){o=l[e],P.tmEPOAdmin.element_logic_init(e,t);try{d=P.tmEPOAdmin.getFieldValue(o,"element_type"),n=P.tmEPOAdmin.getFieldValue(o,"logic",d)||"null",i=P.tmEPOAdmin.getFieldValue(o,"logicrules",d)||"null",i=P.epoAPI.util.parseJSON(i),n&&"null"!==n&&(i=P.tmEPOAdmin.logic_check_element_rules(i,t,e)),P.tmEPOAdmin.setFieldValue(t,e,"logicrules",O.stringify(i),d)}catch(e){}})})},panelsReorder:function(e){P(e).children(".options-wrap").each(function(e,t){P(t).find(".tm-default-radio,.tm-default-checkbox").val(e)})},panelsSortable:function(e){0!==P(e).length&&P.tmEPOAdmin.is_original&&e.sortable({handle:".move",cancel:"input,select,button:not(.move)",cursor:"move",tolerance:"pointer",forcePlaceholderSize:!0,placeholder:"panel_wrap pl",stop:function(e,t){P.tmEPOAdmin.panelsReorder(P(t.item).closest(".panels_wrap"))}})},builder_panel_delete_all_onClick:function(e){var t=P(this).closest(".onerow").find(".tcpagination"),i=P(".flasho.tc-wrapper").find(".panels_wrap");e.preventDefault(),P(this).trigger("hideTtooltip"),t.tcPagination("destroy"),1<i.children().length&&((e=i.find(".options-wrap")).each(function(e){if(0===e)return!0;P(this).remove(),i.find(".numorder").each(function(e){P(this).html(parseInt(e,10)+1)})}),e.find("input").val(""),P.tmEPOAdmin.panelsReorder(i))},builder_image_delete_onClick:function(e){var t=P(this);e.preventDefault(),t.trigger("hideTtooltip"),t.closest(".tm_cell_images").find("input."+t.attr("rel")).val(""),t.closest("span").find("img").attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=")},builder_panel_delete_onClick:function(e){var t=P(this).closest(".panels_wrap");e.preventDefault(),P(this).trigger("hideTtooltip"),1<t.children().length&&P(this).closest(".options-wrap").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){P(this).remove(),t.find(".numorder").each(function(e){P(this).html(parseInt(e,10)+1)}),t.children(".options-wrap").each(function(t){P(this).find("[id]").each(function(){var e=P(this).attr("name").replace(/[[\]]/g,"");P(this).attr("id",e+"_"+t)})}),P.tmEPOAdmin.panelsReorder(t)})},builder_panel_mass_add_onClick:function(e){var t=P(this);e.preventDefault(),t.is(".disabled")||(t.addClass("disabled"),e='<div class="tm-panel-populate-wrapper"><textarea class="tm-panel-populate"></textarea><button type="button" class="tc tc-button builder-panel-populate">'+g.i18n_populate+"</button></div>",t.after(e))},builder_panel_populate_onClick:function(e){var i=P(".flasho.tc-wrapper").find(".panels_wrap"),n=i.children(),a=P(""),t=P(".tm-panel-populate").val().split(/\n/),l=[];e.preventDefault(),P(this).remove(),t.forEach(function(e){/\S/.test(e)&&l.push(P.epoAPI.util.trim(e))}),l.forEach(function(e){var e=e.split("|"),t=e.length;0!==t&&(1===t&&(e[1]=""),e[0]=P.epoAPI.util.trim(e[0]),void 0!==e[1]&&""!==e[1]?e[1]=parseFloat(P.epoAPI.util.trim(e[1])):e[1]="",Number.isFinite(e[1])||(e[1]=""),t=P.tmEPOAdmin.add_panel_row(e,i,n),a=a.add(t))}),a.length&&(i.append(a),a.find(".tm_option_enabled").prop("checked",!0).val("1").trigger("changechoice"),P.tcToolTip(a.find(".tm-tooltip"))),P(".builder-panel-mass-add").removeClass("disabled"),P(".tm-panel-populate-wrapper").remove(),P.tmEPOAdmin.paginattion_init("last"),P.tmEPOAdmin.floatbox_content_js()},add_panel_row:function(e,t,i){var n=i.last().tcClone();return n?(P.tmEPOAdmin.builder_clone_elements_after_events(n),n.find("[name]").val(""),n.find(".tm_option_title").val(e[0]),n.find(".tm_option_value").val(P("<div/>").html(e[0]).text()),n.find(".tm_option_price").val(e[1]),e[2]&&(n.find(".tm_option_price_type").val(e[2]),!1===n.find(".tm_option_price_type").val())&&n.find(".tm_option_price_type").val(""),e[3]&&(n.find(".tm_option_description").val(e[3]),!1===n.find(".tm_option_description").val())&&n.find(".tm_option_description").val(""),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),n):P("")},builder_panel_add_separator_onClick:function(e){var t=P(this).prevUntil(".panels_wrap").prev(),i=t.children(),n=i.last().tcClone();e.preventDefault(),n&&(n.addClass("separator"),n.find(".tc-cell:not(.tm_cell_move,.tm_cell_title,.tm_cell_description,.tm_cell_delete)").addClass("tm-hidden"),n.find("[name]").val(""),n.find(".tc-cell-value input").removeClass("tm_option_value").val("-1"),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),P.tmEPOAdmin.builder_clone_elements_after_events(n),t.append(n),n.find("input:checkbox").toArray().forEach(function(e){(e=P(e)).val(e.data("builder").tags.value),e.is(".tm_option_enabled")&&e.prop("checked",!0).trigger("changechoice")}),P.tcToolTip(n.find(".tm-tooltip")),P.tmEPOAdmin.paginattion_init("last"),P.tmEPOAdmin.floatbox_content_js())},builder_panel_add_onClick:function(e){var t=P(this).prev(".panels_wrap"),i=t.children().not(".separator"),n=i.last().tcClone();e.preventDefault(),n&&(n.find("[name]").val(""),n.find(".tm_upload_image img").attr("src",""),n.find("input.tm_option_image").val(""),n.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(i.length),P.tmEPOAdmin.builder_clone_elements_after_events(n),t.append(n),n.find("input:checkbox").toArray().forEach(function(e){(e=P(e)).val(e.data("builder").tags.value),e.is(".tm_option_enabled")&&e.prop("checked",!0).trigger("changechoice")}),P.tcToolTip(n.find(".tm-tooltip")),P.tmEPOAdmin.paginattion_init("last"),P.tmEPOAdmin.floatbox_content_js())},builder_add_section_onClick:function(e,t,i){var n,a,l=P.epoAPI.template.html(v.tc_builder_section,{});return e&&e.preventDefault(),!(!l||!(e=P(l)))&&(e.addClass("w100"),e.find(".tm-builder-sections-uniqid").val(P.epoAPI.math.uniqueid("",!0)),n=P.tmEPOAdmin.getFieldObject(e),a={},Object.keys(n).forEach(function(e){a[n[e].id]=n[e]}),l={fields:[],section:a,size:P.tmEPOAdmin.builderSize[a.sections_size.default],sections_internal_name:a.sections_internal_name.default},e.find(".section_elements").empty(),e.find(".tm-internal-name").remove(),t?(e.appendTo(".builder-layout"),w.push(l)):0<P(".builder-layout .tma-variations-wrap").length?(P(".builder-layout .tma-variations-wrap").after(e),w.splice(1,0,l)):(e.prependTo(".builder-layout"),w.unshift(l)),P.tmEPOAdmin.check_section_logic(e),P.tmEPOAdmin.section_logic_init(e),i||(P.tmEPOAdmin.builder_items_sortable(e.find(".bitem-wrapper")),P.tmEPOAdmin.builder_reorder_multiple(),P(this).is("a")&&P(d).tcScrollTo(e)),P.tmEPOAdmin.initSectionsCheck(),P.tmEPOAdmin.makeResizables(e),e)},builder_add_element_onClick:function(e){var n=P(this),t=P.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+g.element_data+"</div>",title:g.i18n_add_element}),a=P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"70%",height:"70%",top:"15%",left:"15%",classname:"flasho tc-wrapper tc-builder-add-element",data:t});e&&e.preventDefault(),P(".tc-builder-add-element .tc-element-button").on("click.cpf",function(e){var t=n.closest(".builder-wrapper"),i=P(this).attr("data-element");e.preventDefault(),n.is(".tc-prepend")?P.tmEPOAdmin.builder_clone_element(i,t,"prepend"):P.tmEPOAdmin.builder_clone_element(i,t),P.tmEPOAdmin.logic_reindex(),a.destroy()})},builder_add_section_and_element_onClick:function(e){var t=P.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+g.element_data+"</div>",title:g.i18n_add_element}),i=P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"70%",height:"70%",top:"15%",left:"15%",classname:"flasho tc-wrapper tc-builder-add-section-and-element",data:t});e&&e.preventDefault(),P(".tc-builder-add-section-and-element .tc-element-button").on("click.cpf",function(e){var t=P.tmEPOAdmin.builder_add_section_onClick(!1,!0);e.preventDefault(),t&&(e=P(this).attr("data-element"),P.tmEPOAdmin.builder_clone_element(e,t),P.tmEPOAdmin.logic_reindex(),i.destroy())})},tm_variations_check:function(){var e,i;P(".builder-layout .element-variations").length&&1===P.tmEPOAdmin.variationsCheckForChanges&&a&&(P("#tc-admin-extra-product-options").block({message:null}),e={action:"woocommerce_tm_variations_check",post_id:a.post_id,security:a.check_attributes_nonce},P.post(a.ajax_url,e,function(e){w[0].variations_html=e.html,P(".tma-variations-wrap .tm-all-attributes").html(e.html),e.jsobject&&(w[0].jsobject=e.jsobject,w[0].fields[0].find(function(e,t){return"multiple"===e.id&&(i=t),"multiple"===e.id}),void 0!==i?w[0].fields[0][i]=e.jsobject:w[0].fields[0].push(e.jsobject)),P("#tc-admin-extra-product-options").unblock(),P("#tc-admin-extra-product-options").trigger("woocommerce_tm_variations_check_loaded"),P.tmEPOAdmin.variationsCheckForChanges=0,P.tmEPOAdmin.builder_reorder_multiple()},"json"))},builder_variation_delete_onClick:function(){P.tmEPOAdmin.var_is("tm-style-variation-forced",!0),P(".builder_add_section").addClass("inline"),P(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),1<P(".tma-variations-wrap").length&&P(".tma-variations-wrap").not(":first").each(function(){var e=P(this).closest(".builder-wrapper"),t=e.index();e.remove(),w.splice(t,1),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.section_logic_init(),P.tmEPOAdmin.initSectionsCheck()}),P(".tma-variations-wrap").addClass("tm-hidden"),P.tmEPOAdmin.setFieldValue(P.tmEPOAdmin.variationSectionIndex,P.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),P.tmEPOAdmin.initSectionsCheck()},builder_add_variation_onClick:function(e){e&&e.preventDefault(),!0===P.tmEPOAdmin.var_is("tm-style-variation-added")?!0===P.tmEPOAdmin.var_is("tm-style-variation-forced")&&(P.tmEPOAdmin.var_is("tm-style-variation-forced",!1),P(".builder_add_variation").addClass("tm-hidden"),P(".builder_add_section").removeClass("inline"),P(".tma-variations-wrap").removeClass("tm-hidden"),P.tmEPOAdmin.setFieldValue(P.tmEPOAdmin.variationSectionIndex,P.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),P.tmEPOAdmin.initSectionsCheck()):(e=P.tmEPOAdmin.builder_add_section_onClick(!1,!1,!0))&&(e.find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),e.addClass("tma-nomove tma-variations-wrap"),P.tmEPOAdmin.var_is("tm-style-variation-added",!0),e=P.tmEPOAdmin.builder_clone_element("variations",P(".builder-layout").find(".builder-wrapper").first()),P.tmEPOAdmin.setVariationSection(),!0===P.tmEPOAdmin.var_is("tm-style-variation-forced")?(P(".builder_add_section").addClass("inline"),P(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),P(".tma-variations-wrap").addClass("tm-hidden"),P.tmEPOAdmin.setFieldValue(P.tmEPOAdmin.variationSectionIndex,P.tmEPOAdmin.variationFieldIndex,"variations_disabled","1")):(P(".builder_add_variation").addClass("tm-hidden"),P(".builder_add_section").removeClass("inline"),P(".tma-variations-wrap").removeClass("tm-hidden"),P.tmEPOAdmin.var_is("tm-style-variation-forced",!1),P.tmEPOAdmin.setFieldValue(P.tmEPOAdmin.variationSectionIndex,P.tmEPOAdmin.variationFieldIndex,"variations_disabled","")),e.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.bitem-settings .minus,.tm-label-delete").remove(),e.addClass("tma-nomove"),e.find(".builder-remove-for-variations").remove(),e.find(".builder_hide_for_variation").hide(),P.tmEPOAdmin.pre_element_logic_init_set(),P.tmEPOAdmin.logic_reindex_force(),P.tmEPOAdmin.variationsCheckForChanges=1,P.tmEPOAdmin.tm_variations_check())},var_is:function(e,t){if(!t)return P("body").data(e);P("body").data(e,t)},var_remove:function(e){e&&P("body").removeData(e)},tm_escape:function(e){return encodeURIComponent(e)},tm_unescape:function(e){return decodeURIComponent(e)},get_element_logic_init:function(e){return P.tmEPOAdmin.pre_element_logic_init_done||P.tmEPOAdmin.pre_element_logic_init(e),P.tmEPOAdmin.isinit?P.tmEPOAdmin.pre_element_logic_init_done=!0:P.tmEPOAdmin.pre_element_logic_init_done=!1,P.tmEPOAdmin.pre_element_logic_init_obj},get_element_logic_options_init:function(e){return P.tmEPOAdmin.pre_element_logic_init_done||P.tmEPOAdmin.pre_element_logic_init(e),P.tmEPOAdmin.isinit?P.tmEPOAdmin.pre_element_logic_init_done=!0:P.tmEPOAdmin.pre_element_logic_init_done=!1,P.tmEPOAdmin.pre_element_logic_init_obj_options},find_index:function(e,t,i,n){var a=0;return e&&(a=t.closest(".bitem-wrapper").prevAll(".bitem-wrapper").find(".bitem"),a=(a=n?a.not(n):a).length),i&&n?(e=t.parent().find(i).not(n),-1!==(e=parseInt(e.index(t),10))?parseInt(a,10)+e:e):parseInt(a,10)+parseInt(t.index(),10)},setGlobalVariationObject:function(t,i){var e,n;a?(P("#tc-admin-extra-product-options").block({message:null}),e={action:"woocommerce_tm_get_variations_array",post_id:a.post_id,security:a.check_attributes_nonce},n=d.ajaxurl||a.ajax_url,P.post(n,e,function(e){e&&(y=e,!0===t?P.tmEPOAdmin.pre_element_logic_init_set(i):"reindex"===t?P.tmEPOAdmin.logic_reindex_force():"initialitize_on"===t?P.tmEPOAdmin.initialitize_on():"initialitize_on_after"===t&&P.tmEPOAdmin.initialitize_on_after())},"json").always(function(){P("#tc-admin-extra-product-options").unblock()})):"initialitize_on"===t?(y=y||{},P.tmEPOAdmin.initialitize_on()):"initialitize_on_after"===t&&(y=y||{},P.tmEPOAdmin.initialitize_on_after())},pre_element_logic_init:function(e){y?P.tmEPOAdmin.pre_element_logic_init_set(e):P.tmEPOAdmin.setGlobalVariationObject(!0,e)},getFieldValue:function(e,t,i){if((i&&!0!==i||!0===i&&(i=P.tmEPOAdmin.getFieldValue(e,"element_type")))&&(t=i+"_"+t),void 0!==(i=e.find(function(e){return e.id===t}))&&"object"==typeof i)return i.default},getFieldMultiple:function(e,t,i){var n,a;if(t="options_"+t,t="multiple_"+(t=i&&!0!==i||!0===i&&(i=P.tmEPOAdmin.getFieldValue(e,"element_type"))?i+"_"+t:t),e.find(function(e,t){return"multiple"===e.id&&(n=t),"multiple"===e.id}),void 0!==n&&(a=e[n].multiple.map(function(e){return e.find(function(e){return e.id===t})}).filter(function(e){return null!=e}))&&"object"==typeof a)return a},setFieldValue:function(e,t,i,n,a){var l;(a&&!0!==a||!0===a&&(a=P.tmEPOAdmin.getFieldValue(w[e].fields[t],"element_type")))&&(i=a+"_"+i),a=w[e].fields[t],Array.isArray(a)&&a.find(function(e,t){return e.id===i&&(l=t),e.id===i}),void 0!==l&&(w[e].fields[t][l].default=n)},setFieldValueMultiple:function(e,t,i,n,a){var l,o;i.toString.isNumeric()?o=i:(i="options_"+i,i="multiple_"+(i=a&&!0!==a||!0===a&&(a=P.tmEPOAdmin.getFieldValue(w[e].fields[t],"element_type"))?a+"_"+i:i)),w[e].fields[t].find(function(e,t){return"multiple"===e.id&&(l=t),"multiple"===e.id}),void 0!==l&&(a=w[e].fields[t][l].multiple,void 0===o?a.find(function(e,t){return e.id===i&&(o=t),e.id===i}):w[e].fields[t][l].multiple[o].default=n)},setVariationSection:function(){w.find(function(e,t){var i,n;return void 0!==(n=void 0!==e&&void 0!==e.fields?e.fields.find(function(e,t){e=e.find(function(e){return"element_type"===e.id&&"variations"===e.default});return void 0!==e&&(i=t),e}):n)&&(P.tmEPOAdmin.variationSectionIndex=t,P.tmEPOAdmin.variationFieldIndex=i,P.tmEPOAdmin.variationSection=w[P.tmEPOAdmin.variationSectionIndex].fields[P.tmEPOAdmin.variationFieldIndex],w[P.tmEPOAdmin.variationSectionIndex].section.tma_variations_wrap=!0),void 0!==n})},pre_element_logic_init_set:function(t){var i,n,a,l,o,d,r,s,c,m,u,p,_,f,h,b,g,v,O,A,E;y&&(P.tmEPOAdmin.pre_element_logic_init_obj={},P.tmEPOAdmin.pre_element_logic_init_obj_options={},i={},n={},a=[],P.tmEPOAdmin.setVariationSection(),Object.keys(w).forEach(function(e){void 0!==(O=w[e].section)&&(l=O.sections_uniqid.default,-1!==a.indexOf(l)&&(w[e].section.sections_uniqid.default=P.epoAPI.math.uniqueid("",!0),l=w[e].section.sections_uniqid.default),a.push(l),i[l]=[],t&&P.tmEPOAdmin.check_section_logic(e),g=O.sections_internal_name.default||"Section",O.tma_variations_wrap||(i[l][0]='<option data-type="section" data-section="'+l+'" value="'+l+'">'+g+" ("+l+")</option>"),o=w[e].fields.filter(function(e){var t=P.tmEPOAdmin.getFieldValue(e,"element_type");return"variations"===t||-1!==P.inArray(t,P.tmEPOAdmin.canTakeLogic)&&"1"===P.tmEPOAdmin.getFieldValue(e,"enabled",t)}),d=w[e].fields.filter(function(e){var t=P.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===P.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===P.tmEPOAdmin.getFieldValue(e,"enabled",t)}),r=[],s=[],Object.keys(o).forEach(function(e){if(A=o[e],v=P.tmEPOAdmin.getFieldValue(A,"element_type"),p=P.tmEPOAdmin.getFieldValue(A,"header_title",v),E=P.tmEPOAdmin.getFieldValue(A,"uniqid",v),c=d.findIndex(function(e){var t=P.tmEPOAdmin.getFieldValue(e,"element_type");return E===P.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&("variations"===t||-1!==P.inArray(t,P.tmEPOAdmin.canTakeLogic)&&"1"===P.tmEPOAdmin.getFieldValue(e,"enabled",!0))}),m=P.tmEPOAdmin.getFieldValue(A,"enabled",v),u="1"===P.tmEPOAdmin.getFieldValue(A,"enabled",v),m&&!u)return!0;void 0!==p&&(void 0!==(m=p)&&0!==m.length||(m=""),(u=P.tmEPOAdmin.getFieldValue(A,"internal_name",v))!==m&&(m=m+" ("+u+")"),p="variations"===v?"variation":-1!==P.inArray(v,["radiobuttons","checkboxes","product","selectbox","selectboxmultiple"])?"multiple":"text",i[l][c+1]='<option data-type="'+p+'" data-section="'+l+'" value="'+c+'">'+m+"</option>","variations"===v?(s=[],P(y.variations).each(function(e,t){var i="publish"===(i=t.status||"invalid")?"":" ("+i+")";_=[],P(t.attributes).each(function(e,t){t=P.map(t,function(e){return e});P(t).each(function(e,t){_.push(t)})}),_=_.join(" - "),f=_;try{f=P.tmEPOAdmin.tm_unescape(_)}catch(e){f=_}s.push('<option value="'+P.tmEPOAdmin.tm_escape(t.variation_id)+'">'+f+i+"</option>")}),r[c]='<select data-element="'+c+'" data-section="'+l+'" class="cpf-logic-value">'+s.join("")+"</select>"):-1!==P.inArray(v,["radiobuttons","checkboxes","selectbox","selectboxmultiple"])?(h=P.tmEPOAdmin.getFieldMultiple(A,"title",v),b=P.tmEPOAdmin.getFieldMultiple(A,"value",v),s=[],Object.keys(h).forEach(function(e){s.push('<option value="'+P.tmEPOAdmin.tm_escape(b[e].default)+'">'+h[e].default+"</option>")}),r[c]='<select data-element="'+c+'" data-section="'+l+'" class="cpf-logic-value">'+s.join("")+"</select>"):r[c]='<input data-element="'+c+'" data-section="'+l+'" class="cpf-logic-value" type="text" value="">')}),n[l]={values:r})}),P.tmEPOAdmin.pre_element_logic_init_obj=n,P.tmEPOAdmin.pre_element_logic_init_obj_options=i)},element_logic_init:function(e,t,i){var n,a,l,o,d,r,s=[],c=[],m={};e instanceof P&&(t=e.closest(".builder-wrapper").index(),e=P.tmEPOAdmin.find_index(w[t].section.is_slider,e)),t=P.epoAPI.math.toFloat(t),e=P.epoAPI.math.toFloat(e),r=P.tmEPOAdmin.getFieldValue(w[t].fields[e],"uniqid",!0),l=w[t].fields.filter(function(e){var t=P.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===P.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===P.tmEPOAdmin.getFieldValue(e,"enabled",t)}),n=l.findIndex(function(e){var t=P.tmEPOAdmin.getFieldValue(e,"element_type");return r===P.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&-1!==P.inArray(t,P.tmEPOAdmin.canTakeLogic)&&"1"===P.tmEPOAdmin.getFieldValue(e,"enabled",!0)}),P.tmEPOAdmin.check_section_logic(),P.tmEPOAdmin.check_element_logic(e,t),l=P.extend(!0,{},P.tmEPOAdmin.get_element_logic_init()),m=P.extend(!0,{},l),d=P.extend(!0,{},P.tmEPOAdmin.get_element_logic_options_init()),o=P.extend(!0,{},P.tmEPOAdmin.get_element_logic_options_init()),(a=w[t].section.sections_uniqid.default)&&l[a]&&l[a].values[n]?(m[a]={values:m[a].values},m[a].values.forEach(function(e,t){n!==t&&delete m[a].values[t]}),delete l[a].values[n],delete d[a][n+1],delete d[a][0]):a&&d[a]&&d[a][0]&&delete d[a][0],P.each(d,function(e,t){t&&P.each(t,function(e,t){t&&c.push(t)})}),P.each(o,function(e,t){e===a&&P.each(t,function(e,t){e===n+1&&s.push(t)})}),P.tmEPOAdmin.elementLogicObject.init||(P.tmEPOAdmin.elementLogicObject.init=!0),P.tmEPOAdmin.elementLogicObject=P.extend(P.tmEPOAdmin.elementLogicObject,l),P.tmEPOAdmin.elementShippingLogicObject.init||(P.tmEPOAdmin.elementShippingLogicObject.init=!0),P.tmEPOAdmin.elementShippingLogicObject=P.extend(P.tmEPOAdmin.elementShippingLogicObject,m),i&&(P.tmEPOAdmin.logic_append(i,c,"element",t,e),P.tmEPOAdmin.shipping_logic_append(i,s,"element",t,e,"enable"),P.tmEPOAdmin.shipping_logic_append(i,s,"element",t,e,"disable"))},section_logic_init:function(e,t){var i,n,a,l=[],o={};e instanceof P?e=parseInt(e.index(),10):void 0!==e&&(e=P.epoAPI.math.toFloat(e)),void 0===e?a=w:(a=[])[e]=P.extend(!0,{},w[e]),P.tmEPOAdmin.check_section_logic(e),Object.keys(a).forEach(function(e){void 0!==w[e].section&&(o=P.extend(!0,{},P.tmEPOAdmin.get_element_logic_init(!0)),i=P.extend(!0,{},P.tmEPOAdmin.get_element_logic_options_init(!0)),(n=w[e].section.sections_uniqid.default)&&o[n]&&(delete o[n],delete i[n]),P.each(i,function(e,t){t&&P.each(t,function(e,t){t&&l.push(t)})}),P.tmEPOAdmin.sectionLogicObject.init||(P.tmEPOAdmin.sectionLogicObject.init=!0),P.tmEPOAdmin.sectionLogicObject=P.extend(P.tmEPOAdmin.sectionLogicObject,o),t)&&P.tmEPOAdmin.logic_append(t,l,"section",e)})},logic_check_section_rules:function(e){var n,a;return void 0===(e="object"==typeof e&&null!==e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=P.tmEPOAdmin.convert_rules(e),n=P.epoAPI.util.deepCopyArray(e),a=P.tmEPOAdmin.sectionLogicObject,P.each(e.rules,function(i,e){Array.isArray(e)&&(P.each(e,function(e,t){void 0!==a[t.section]&&void 0!==a[t.section].values[t.element]||t.section===t.element||delete n.rules[i][e]}),0===n.rules[i].length&&delete n.rules[i],n.rules[i]=A(n.rules[i]))}),n.rules=A(n.rules),n},logic_check_element_rules:function(e,t,n){var a,l,o=!1;return void 0===(e="object"==typeof e&&e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=P.tmEPOAdmin.convert_rules(e),a=P.epoAPI.util.deepCopyArray(e),l=P.tmEPOAdmin.elementLogicObject,P.each(e.rules,function(i,e){Array.isArray(e)&&(P.each(e,function(e,t){void 0!==l[t.section]&&void 0!==l[t.section].values[t.element]||t.section===t.element||(delete a.rules[i][e],o=!0)}),0===a.rules[i].length?delete a.rules[i]:a.rules[i]=A(a.rules[i])),o&&void 0!==t&&void 0!==n&&P(".builder-layout").find(".builder-wrapper").eq(t).find(".bitem").eq(n).addClass("tm-wrong-rule")}),a.rules=A(a.rules),a},shipping_logic_check_element_rules:function(e){return void 0===(e="object"==typeof e&&e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e},convert_rules:function(e){return e.what&&("all"===e.what?e.rules=[e.rules]:"any"===e.what&&(e.rules=e.rules.reduce(function(e,t){return e.push([t]),e},[])),delete e.what),e},shipping_logic_append:function(e,t,i,n,a,l){var o,d,r,s,c,m,u,p;if(e=P(e),e=P(e).find(".tm-shipping-"+l+"-logicrules + .shipping-logic-div .tm-logic-wrapper"),!t||1!==t.length)return e.html('<div class="errortitle"><p>'+g.i18n_cannot_apply_shippingrules+"</p></div>"),!1;try{c=P.tmEPOAdmin.getFieldValue(w[n].fields[a],"shipping_methods_"+l+"_logicrules",!0)||"null",o=P.epoAPI.util.parseJSON(c),p=P.tmEPOAdmin.shipping_logic_check_element_rules(o),P.tmEPOAdmin.setFieldValue(n,a,"shipping_methods_"+l+"_logicrules",O.stringify(p),!0)}catch(e){p=!1}e.empty(),d='<fieldset class="tm-logic-rule-set"><legend>OR</legend><div class="tm-logic-rule-wrap"></div></fieldset>',s=P('<div class="tc-row tm-logic-rule"><div class="tc-cell tc-col-auto tm-logic-element"></div><div class="tc-cell tc-col-auto tm-logic-operator"></div><div class="tc-cell tc-col-auto tm-logic-value"></div><div class="tc-cell tc-col-auto tm-logic-func"><button type="button" class="tmicon tcfa tcfa-plus add cpf-add-rule"></button> <button type="button" class="tmicon tcfa tcfa-trash delete cpf-delete-rule"></button></div></div>'),c=P('<select class="cpf-logic-element">'+t.join("")+"</select>"),m="",Object.keys(P.tmEPOAdmin.logicOperators).forEach(function(e){m=m+'<option value="'+e+'">'+P.tmEPOAdmin.logicOperators[e]+"</option>"}),m=P('<select class="cpf-logic-operator">'+m+"</select>"),s.find(".tm-logic-element").append(c),s.find(".tm-logic-operator").append(m),p&&void 0!==p.rules&&p.rules.length?(u=P('<div class="temp" />'),P.each(p.rules,function(e,t){r=P(d),t&&"object"==typeof t&&(Array.isArray(t)&&(t.length?P.each(t,function(e,t){r.find(".tm-logic-rule-wrap").append(P.tmEPOAdmin.logic_append_rule(t,s,i,!0))}):r.find(".tm-logic-rule-wrap").append(P.tmEPOAdmin.logic_append_rule({},s,i,!0))),u.append(r))}),u=u.children(),e.append(u).removeClass("tc-hidden")):(u=P('<div class="temp" />'),(r=P(d)).find(".tm-logic-rule-wrap").append(P.tmEPOAdmin.logic_append_rule({},s,i,!0)),u.append(r),u=u.children(),e.append(u),u.find(".cpf-logic-element").trigger("change.cpf",["element"===i]),u.find(".cpf-logic-operator").val(u.find(".cpf-logic-operator").children(":not(.tc-hidden-no-events)").eq(0).val()).trigger("change.cpf",["element"===i]),e.addClass("tc-hidden"))},logic_append:function(e,t,i,n,a){var l,o,d,r,s,c,m,u;if(e=P(e),e=P(e).find(".builder-logic-div .tm-logic-wrapper"),!t||0===t.length)return e.html('<div class="errortitle"><p>'+g.i18n_cannot_apply_rules+"</p></div>"),!1;try{s="1"===("element"===i?P.tmEPOAdmin.getFieldValue(w[n].fields[a],"logic",!0)||"":w[n].section.sections_logic.default||"")?"element"===i?P.tmEPOAdmin.getFieldValue(w[n].fields[a],"logicrules",!0)||"null":w[n].section.sections_logicrules.default||"null":"null",l=P.epoAPI.util.parseJSON(s),u="element"===i?P.tmEPOAdmin.logic_check_element_rules(l):P.tmEPOAdmin.logic_check_section_rules(l),"element"===i?P.tmEPOAdmin.setFieldValue(n,a,"logicrules",O.stringify(u),!0):w[n].section.sections_logicrules.default=O.stringify(u)}catch(e){u=!1}e.empty(),o='<fieldset class="tm-logic-rule-set"><legend>OR</legend><div class="tm-logic-rule-wrap"></div></fieldset>',r=P('<div class="tc-row tm-logic-rule"><div class="tc-cell tc-col-auto tm-logic-element"></div><div class="tc-cell tc-col-auto tm-logic-operator"></div><div class="tc-cell tc-col-auto tm-logic-value"></div><div class="tc-cell tc-col-auto tm-logic-func"><button type="button" class="tmicon tcfa tcfa-plus add cpf-add-rule"></button> <button type="button" class="tmicon tcfa tcfa-trash delete cpf-delete-rule"></button></div></div>'),s=P('<select class="cpf-logic-element">'+t.join("")+"</select>"),c="",Object.keys(P.tmEPOAdmin.logicOperators).forEach(function(e){c=c+'<option value="'+e+'">'+P.tmEPOAdmin.logicOperators[e]+"</option>"}),c=P('<select class="cpf-logic-operator">'+c+"</select>"),r.find(".tm-logic-element").append(s),r.find(".tm-logic-operator").append(c),u&&void 0!==u.rules&&u.rules.length?(u=P.tmEPOAdmin.convert_rules(u),m=P('<div class="temp" />'),P.each(u.rules,function(e,t){d=P(o),t&&"object"==typeof t&&(Array.isArray(t)&&(t.length?P.each(t,function(e,t){d.find(".tm-logic-rule-wrap").append(P.tmEPOAdmin.logic_append_rule(t,r,i))}):d.find(".tm-logic-rule-wrap").append(P.tmEPOAdmin.logic_append_rule({},r,i))),m.append(d))}),m=m.children(),e.append(m)):(m=P('<div class="temp" />'),(d=P(o)).find(".tm-logic-rule-wrap").append(P.tmEPOAdmin.logic_append_rule({},r,i)),m.append(d),m=m.children(),e.append(m),m.find(".cpf-logic-element").trigger("change.cpf",["element"===i]),m.find(".cpf-logic-operator").val(m.find(".cpf-logic-operator").children(":not(.tc-hidden-no-events)").eq(0).val()).trigger("change.cpf",["element"===i]))},logic_append_rule:function(e,t,i,n){var t=t.clone(),a=t.find(".cpf-logic-element").find('option[data-section="'+e.section+'"][value="'+e.element+'"]');return P(a).length&&(P(a)[0].selected=!0),P.tmEPOAdmin.cpf_logic_element_onchange(t.find(".cpf-logic-element"),n?2:"element"===i),t.find(".cpf-logic-operator").val(e.operator),P.tmEPOAdmin.cpf_logic_operator_onchange(t.find(".cpf-logic-operator"),"element"===i),void 0===e.value&&(e.value=""),t.find(".cpf-logic-value").is("select")?t.find(".cpf-logic-value").val(P.tmEPOAdmin.tm_escape(P.tmEPOAdmin.tm_unescape(e.value))):t.find(".cpf-logic-value").val(P.tmEPOAdmin.tm_unescape(e.value)),t},logic_get_JSON:function(e,t,i){var n,a,l,o,e=P(e).find(".builder-logic-div"),d={},r=e.find(".epo-rule-toggle").val();return d[t]=i,d.toggle=r,d.rules=[],e.find(".tm-logic-wrapper").children(".tm-logic-rule-set").each(function(e,t){var i=[];(t=P(t)).find(".tm-logic-rule-wrap").children(".tm-logic-rule").each(function(e,t){t=P(t),a=t.find(".cpf-logic-element"),n=a.children("option:selected").attr("data-section"),a=a.val(),l=t.find(".cpf-logic-operator").val(),void 0===(o=t.find(".cpf-logic-value").val())&&(o=""),t.find(".cpf-logic-value").is("select")||(o=P.tmEPOAdmin.tm_escape(o)),i.push({section:n,element:a,operator:l,value:o})}),d.rules.push(i)}),O.stringify(d)},shipping_logic_get_JSON:function(e,t,i,n){var a,l,o,d,e=P(e).find(".tm-shipping-"+n+"-logicrules + .shipping-logic-div"),r={},n=e.find(".tm-logic-wrapper");return n.is(".tc-hidden")?"":(r[t]=i,r.toggle="show",r.rules=[],n.children(".tm-logic-rule-set").each(function(e,t){var i=[];(t=P(t)).find(".tm-logic-rule-wrap").children(".tm-logic-rule").each(function(e,t){t=P(t),l=t.find(".cpf-logic-element"),a=l.children("option:selected").attr("data-section"),l=l.val(),o=t.find(".cpf-logic-operator").val(),void 0===(d=t.find(".cpf-logic-value").val())&&(d=""),t.find(".cpf-logic-value").is("select")||(d=P.tmEPOAdmin.tm_escape(d)),i.push({section:a,element:l,operator:o,value:d})}),r.rules.push(i)}),O.stringify(r))},section_logic_get_JSON:function(e){var t,i="";return e.find(".activate-sections-logic").is(":checked")&&(t=e.find(".tm-builder-sections-uniqid").val(),i=P.tmEPOAdmin.logic_get_JSON(e,"section",t)),i},element_logic_get_JSON:function(e){var t,i="";return e.find(".activate-element-logic").is(":checked")&&(t=e.find(".tm-builder-element-uniqid").val(),i=P.tmEPOAdmin.logic_get_JSON(e,"element",t)),i},element_shipping_logic_get_JSON:function(e,t){var i=e.find(".tm-builder-element-uniqid").val();return P.tmEPOAdmin.shipping_logic_get_JSON(e,"element",i,t)},cpf_add_rule:function(e){var t=P(this).closest(".tm-logic-rule"),i=t.tcClone(!0);e.preventDefault(),i&&t.after(i)},cpf_add_rule_set:function(e){var t=P(this).closest(".builder-logic-div, .shipping-logic-div").find(".tm-logic-wrapper"),i=t.find(".tm-logic-rule-set:last()");e.preventDefault(),t.is(".tc-hidden")?t.removeClass("tc-hidden"):(e=i.tcClone(!0))&&(e.find(".tm-logic-rule:not(:first)").remove(),i.after(e),e.find(".tm-logic-rule:first .cpf-logic-element").prop("selectedIndex",0).trigger("change.cpf"))},cpf_delete_rule:function(e){var t=P(this),i=t.closest(".tm-logic-wrapper"),n=t.closest(".tm-logic-rule-set"),a=1<i.children(".tm-logic-rule-set").length,l=n.find(".tm-logic-rule-wrap").children(".tm-logic-rule").length;e.preventDefault(),t.trigger("hideTtooltip"),1<l||a?t.closest(".tm-logic-rule").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){(a&&1===l?n:P(this)).remove()}):i.addClass("tc-hidden")},section_logic_reindex:function(){var o=P.tmEPOAdmin.builderItemsSortableObj;Object.keys(w).forEach(function(n){var a,e=n,l=[],t=w[n].section.sections_logicrules.default||"null";return!w[n].section.sections_logic.default||!((t=P.epoAPI.util.parseJSON(t))&&void 0!==t.rules&&0<t.rules.length)||(t=P.tmEPOAdmin.convert_rules(t),o.end.section_eq===e?P.each(t.rules,function(i,e){Array.isArray(e)&&(l[i]=[],P.each(e,function(e,t){a=P.epoAPI.util.deepCopyArray(t),t.element>o.start.element&&t.section===o.start.section&&(a.element=parseInt(a.element,10)-1),l[i][e]=P.tmEPOAdmin.validate_rule(a,n)}),l[i]=A(l[i]))}):P.each(t.rules,function(i,e){Array.isArray(e)&&(l[i]=[],P.each(e,function(e,t){a=P.epoAPI.util.deepCopyArray(t),"check"!==o.start.section&&(t.section===o.start.section&&t.section===o.end.section?t.element===o.start.element?(a.section=o.end.section,a.element=o.end.element):parseInt(t.element,10)>parseInt(o.start.element,10)&&parseInt(t.element,10)<=parseInt(o.end.element,10)?a.element=parseInt(a.element,10)-1:parseInt(t.element,10)<parseInt(o.start.element,10)&&parseInt(t.element,10)>=parseInt(o.end.element,10)&&(a.element=parseInt(a.element,10)+1):t.section===o.start.section&&t.section!==o.end.section?t.element===o.start.element?(a.section=o.end.section,a.element=o.end.element):parseInt(t.element,10)>parseInt(o.start.element,10)&&a.section!==a.element&&(a.element=parseInt(a.element,10)-1):t.section!==o.start.section&&t.section===o.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(o.end.element,10)&&(a.element=parseInt(a.element,10)+1)),"delete"===o.end.section&&"delete"===a.element||(l[i][e]=P.tmEPOAdmin.validate_rule(a,n))}),l[i]=A(l[i]))}),0===(l=A(l)).length&&(w[n].section.sections_logic.default=""),t.rules=l,void(w[n].section.sections_logicrules.default=O.stringify(t)))})},element_logic_reindex:function(){var i,n,a=P.tmEPOAdmin.builderItemsSortableObj,e=a.start.disabledFieldIndex;e&&(a.start.element=e.toString()),(e=a.end.disabledFieldIndex)&&(a.end.element=e.toString()),Object.keys(w).forEach(function(t){Object.keys(w[t].fields).forEach(function(e){i=w[t].fields[e],n=P.tmEPOAdmin.getFieldValue(i,"element_type"),P.tmEPOAdmin.do_element_logic_reindex(i,n,t,e,a),P.tmEPOAdmin.do_element_shipping_logic_reindex(i,n,t,e,a,"enable"),P.tmEPOAdmin.do_element_shipping_logic_reindex(i,n,t,e,a,"disable")})})},do_element_logic_reindex:function(e,t,n,a,l){var o,d;return!(P.tmEPOAdmin.getFieldValue(e,"logic",t)&&(o=[],e=P.tmEPOAdmin.getFieldValue(e,"logicrules",t),e=P.epoAPI.util.parseJSON(e),e=P.tmEPOAdmin.convert_rules(e))&&void 0!==e.rules&&0<e.rules.length)||(P.each(e.rules,function(i,e){Array.isArray(e)&&(o[i]=[],P.each(e,function(e,t){if(d=P.epoAPI.util.deepCopyArray(t),void 0===t.element)return!0;t.element=t.element.toString(),"check"!==l.start.section&&(t.section===l.start.section&&t.section===l.end.section?t.element===l.start.element?d.element=l.end.element:t.section!==t.element&&parseInt(t.element,10)>parseInt(l.start.element,10)&&parseInt(t.element,10)<=parseInt(l.end.element,10)?d.element=parseInt(d.element,10)-1:t.section!==t.element&&parseInt(t.element,10)<parseInt(l.start.element,10)&&parseInt(t.element,10)>=parseInt(l.end.element,10)&&(d.element=parseInt(d.element,10)+1):t.section===l.start.section&&t.section!==l.end.section?t.element===l.start.element?(d.section=l.end.section,d.element=l.end.element):t.section!==t.element&&!P.tmEPOAdmin.builderItemsSortableObj.start.disabled&&parseInt(t.element,10)>parseInt(l.start.element,10)&&(d.element=parseInt(d.element,10)-1):t.section!==l.start.section&&t.section===l.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(l.end.element,10)&&(d.element=parseInt(d.element,10)+1)),"delete"===l.end.section&&"delete"===d.element||(P.tmEPOAdmin.builderItemsSortableObj.end.novalidate&&"delete"===P.tmEPOAdmin.builderItemsSortableObj.end.novalidate?o[i][e]=d:o[i][e]=P.tmEPOAdmin.validate_rule(d,n,a))}),0===o[i].length?delete o[i]:o[i]=A(o[i]))}),0===(o=A(o)).length&&P.tmEPOAdmin.setFieldValue(n,a,"logic","",t),e.rules=o,void P.tmEPOAdmin.setFieldValue(n,a,"logicrules",O.stringify(e),t))},do_element_shipping_logic_reindex:function(e,t,i,n,a,l){var o,d,l="shipping_methods_"+l+"_logicrules",e=P.tmEPOAdmin.getFieldValue(e,l,t);return!(e&&(o=[],e=P.epoAPI.util.parseJSON(e))&&void 0!==e.rules&&0<e.rules.length)||(P.each(e.rules,function(i,e){Array.isArray(e)&&(o[i]=[],P.each(e,function(e,t){if(d=P.epoAPI.util.deepCopyArray(t),void 0===t.element)return!0;t.element=t.element.toString(),"check"!==a.start.section&&(t.section===a.start.section&&t.section===a.end.section?t.element===a.start.element?d.element=a.end.element:t.section!==t.element&&parseInt(t.element,10)>parseInt(a.start.element,10)&&parseInt(t.element,10)<=parseInt(a.end.element,10)?d.element=parseInt(d.element,10)-1:t.section!==t.element&&parseInt(t.element,10)<parseInt(a.start.element,10)&&parseInt(t.element,10)>=parseInt(a.end.element,10)&&(d.element=parseInt(d.element,10)+1):t.section===a.start.section&&t.section!==a.end.section?t.element===a.start.element?(d.section=a.end.section,d.element=a.end.element):t.section!==t.element&&!P.tmEPOAdmin.builderItemsSortableObj.start.disabled&&parseInt(t.element,10)>parseInt(a.start.element,10)&&(d.element=parseInt(d.element,10)-1):t.section!==a.start.section&&t.section===a.end.section&&t.section!==t.element&&parseInt(t.element,10)>=parseInt(a.end.element,10)&&(d.element=parseInt(d.element,10)+1)),"delete"===a.end.section&&"delete"===d.element||(o[i][e]=d)}),0===o[i].length?delete o[i]:o[i]=A(o[i]))}),void(0===(o=A(o)).length?P.tmEPOAdmin.setFieldValue(i,n,l,"",t):(e.rules=o,P.tmEPOAdmin.setFieldValue(i,n,l,O.stringify(e),t))))},validate_rule:function(i,e,t){var n,a,l,o;return y&&i&&"object"==typeof i&&void 0!==i.element&&void 0!==i.operator&&void 0!==i.section&&(void 0!==i.value||"isempty"===i.operator||"isnotempty"===i.operator)&&-1!==(l=w.findIndex(function(e){return e.section.sections_uniqid.default===i.section}))&&(void 0!==(l=w[l].fields.filter(function(e){var t=P.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===P.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===P.tmEPOAdmin.getFieldValue(e,"enabled",t)})[i.element])?(o=P.tmEPOAdmin.getFieldValue(l,"element_type"),n=!1,-1!==P.inArray(o,["radiobuttons","checkboxes","selectbox","selectboxmultiple"])?(a=P.tmEPOAdmin.getFieldMultiple(l,"value",o),Object.keys(a).some(function(e,t){return P.tmEPOAdmin.tm_escape(a[t].default)===i.value?n=!0:a[t].default===i.value&&(i.value=P.tmEPOAdmin.tm_escape(i.value),n=!0),n})):"variations"===o&&("is"===i.operator||"isnot"===i.operator)?P(y.variations).each(function(e,t){if(P.tmEPOAdmin.tm_escape(t.variation_id)===i.value)return!(n=!0)}):n=!0):n=!0,l=P(".builder-layout").find(".builder-wrapper").eq(e),0<(l=void 0!==t?l.find(".bitem").eq(t):l).length)?n||void 0!==t&&""===P.tmEPOAdmin.getFieldValue(w[e].fields[t],"logic",o)?(l.removeClass("tm-wrong-rule"),i):(l.addClass("tm-wrong-rule"),[]):[]},logic_check_rules_reindex:function(l,e,o,t,d,r,s){var c;return void 0===(e="object"==typeof e&&null!==e?e:{}).toggle&&(e.toggle="show"),void 0===e.rules&&(e.rules=[]),e=P.tmEPOAdmin.convert_rules(e),c=P.epoAPI.util.deepCopyArray(e),o=parseInt(o,10),t=parseInt(t,10),r=parseInt(r,10),s=parseInt(s,10),P.each(e.rules,function(i,e){var n,a;Array.isArray(e)&&(P.each(e,function(e,t){n=t.section,a=t.element,n===d&&a.toString().isNumeric()&&(a=parseInt(a,10),o===a?s&&0===r?(delete c.rules[i][e],l.addClass("tm-wrong-rule")):1===r&&(a+=1,c.rules[i][e].element=a.toString()):o<a&&(0===r?(--a,c.rules[i][e].element=a.toString()):1===r&&(a+=1,c.rules[i][e].element=a.toString())))}),0===c.rules[i].length?delete c.rules[i]:c.rules[i]=A(c.rules[i]))}),c.rules=A(c.rules),c},logic_reindex:function(){var e=P.tmEPOAdmin.builderItemsSortableObj;e.start.section===e.end.section&&e.start.section_eq===e.end.section_eq&&e.start.element===e.end.element||(P.tmEPOAdmin.section_logic_reindex(),P.tmEPOAdmin.element_logic_reindex()),P.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},logic_reindex_force:function(){P.tmEPOAdmin.builderItemsSortableObj.start.section="check",P.tmEPOAdmin.builderItemsSortableObj.start.section_eq="check",P.tmEPOAdmin.builderItemsSortableObj.start.element="check",P.tmEPOAdmin.builderItemsSortableObj.end.section="check2",P.tmEPOAdmin.builderItemsSortableObj.end.section_eq="check2",P.tmEPOAdmin.builderItemsSortableObj.end.element="check2",P.tmEPOAdmin.section_logic_reindex(),P.tmEPOAdmin.element_logic_reindex(),P.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},builder_items_sortable:function(e){P.tmEPOAdmin.is_original&&e.sortable({handle:".move",cursor:"grabbing",items:".bitem",start:function(e,t){var i,n,a,l;t.placeholder.height(t.helper.outerHeight()),t.placeholder.width(t.helper.outerWidth()),P.tmEPOAdmin.isElementDragged=!0,P(t.item).hasClass("ditem")?(P.tmEPOAdmin.builderItemsSortableObj.start.section="drag",P.tmEPOAdmin.builderItemsSortableObj.start.section_eq="drag",P.tmEPOAdmin.builderItemsSortableObj.start.element="drag"):(l=(i=P(t.item).closest(".builder-wrapper")).index(),n=w[l].section.is_slider,a=P.tmEPOAdmin.find_index(n,P(t.item)),t=P.tmEPOAdmin.find_index(n,P(t.item),".bitem",".element-is-disabled"),w[l].section.sections.default=parseInt(w[l].section.sections.default,10)-1,w[l].section.sections.default=w[l].section.sections.default.toString(),n&&(w[l].section.sections_slides.default=i.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(",")),P.tmEPOAdmin.builderItemsSortableObj.start.section=w[l].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),P.tmEPOAdmin.builderItemsSortableObj.start.element=a.toString(),P.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=t),P(".builder-layout .bitem-wrapper").not(".tma-variations-wrap .bitem-wrapper").addClass("highlight")},stop:function(e,t){var i,n,a,l,o,d;P.tmEPOAdmin.isElementDragged=!1,d=(i=P(t.item).closest(".builder-wrapper")).index(),n=w[d].section.is_slider,a=P.tmEPOAdmin.find_index(n,P(t.item)),l=P.tmEPOAdmin.find_index(n,P(t.item)),o=P.tmEPOAdmin.find_index(n,P(t.item),".bitem",".element-is-disabled"),P(t.item).hasClass("ditem")||(P(".builder-wrapper.tm-zindex").css("zIndex","").removeClass("tm-zindex"),w[d].section.sections.default=parseInt(w[d].section.sections.default,10)+1,w[d].section.sections.default=w[d].section.sections.default.toString(),n&&(w[d].section.sections_slides.default=i.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(","))),P.tmEPOAdmin.builderItemsSortableObj.end.section=w[d].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.end.section_eq=d.toString(),P.tmEPOAdmin.builderItemsSortableObj.end.element=l.toString(),P.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=o,w[d].fields.splice(a,0,w[P.tmEPOAdmin.builderItemsSortableObj.start.section_eq].fields.splice(P.tmEPOAdmin.builderItemsSortableObj.start.element,1)[0]),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.logic_reindex(),P(".builder-layout .bitem-wrapper").removeClass("highlight")},tolerance:"pointer",forcePlaceholderSize:!0,placeholder:"bitem pl2",cancel:".panels_wrap,.tma-nomove",dropOnEmptyType:!0,revert:200,connectWith:".builder-wrapper:not(.tma-nomove) .bitem-wrapper"})},builder_delete_do:function(){var e,t,i,n,a,l,o,d,r=P(this);r.closest(".builder-layout").is(".builder-template")?P.tmEPOAdmin.builder_section_delete_do.apply(this):(l=(e=r.closest(".builder-wrapper")).index(),t=r.closest(".bitem"),i=w[l].section.is_slider,n=P.tmEPOAdmin.find_index(i,t),a=P.tmEPOAdmin.find_index(i,t,".bitem",".element-is-disabled"),w[l].section.sections.default=parseInt(w[l].section.sections.default,10)-1,w[l].section.sections.default=w[l].section.sections.default.toString(),d=w[l].fields[n],o=P.tmEPOAdmin.getFieldValue(d,"element_type"),d=void 0===P.tmEPOAdmin.getFieldValue(d,"enabled",o)||"1"===P.tmEPOAdmin.getFieldValue(d,"enabled",o),P.tmEPOAdmin.builderItemsSortableObj.start.section=w[l].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),P.tmEPOAdmin.builderItemsSortableObj.start.element=a.toString(),P.tmEPOAdmin.builderItemsSortableObj.end.section="delete",P.tmEPOAdmin.builderItemsSortableObj.end.section_eq="delete",P.tmEPOAdmin.builderItemsSortableObj.end.element="delete",d||(P.tmEPOAdmin.builderItemsSortableObj.start.disabled=!0,P.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=P.tmEPOAdmin.find_index(i,r,".bitem",".element-is-disabled")),t.remove(),w[l].fields.splice(n,1),P.tmEPOAdmin.logic_reindex(),i&&(w[l].section.sections_slides.default=e.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(",")),P.tmEPOAdmin.builder_reorder_multiple())},builder_delete_onClick:function(e){e.preventDefault(),P(this).trigger("blur"),P.tmEPOAdmin.doConfirm(g.i18n_builder_delete,P.tmEPOAdmin.builder_delete_do,this)},builder_fold_onClick:function(){var e=P(this),t=(e=e.is(".tma-handle")?e.find(".fold"):e).closest(".tma-handle-wrap").find(".tma-handle-wrapper").first();e.data("folded")||void 0===e.data("folded")?(e.data("folded",!1),e.removeClass("tcfa-caret-up").addClass("tcfa-caret-down"),t.removeClass("tm-hidden")):(e.data("folded",!0),e.removeClass("tcfa-caret-down").addClass("tcfa-caret-up"),t.addClass("tm-hidden"))},builder_section_fold_onClick:function(){var e=P(this),t=e.closest(".builder-wrapper");e.data("folded")?(e.data("folded",!1),t.removeClass("tm-hide-bitems"),e.removeClass("tcfa-caret-up").addClass("tcfa-caret-down")):(e.data("folded",!0),t.addClass("tm-hide-bitems"),e.removeClass("tcfa-caret-down").addClass("tcfa-caret-up"))},builder_section_delete_do:function(){var e=P(this).closest(".builder-wrapper"),t=e.index();e.remove(),w.splice(t,1),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.section_logic_init(),P.tmEPOAdmin.initSectionsCheck()},builder_section_delete_onClick:function(e){e.preventDefault(),P(this).trigger("blur"),P.tmEPOAdmin.doConfirm(g.i18n_builder_delete,P.tmEPOAdmin.builder_section_delete_do,this)},builder_plus_onClick:function(){var e=P(this).parentsUntil(".bitem").parent().first(),t=e.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],i=Object.keys(P.tmEPOAdmin.builderSize),n=i.findIndex(function(e){return e===t}),i=i[n+1],n=P.tmEPOAdmin.builderSize[i];void 0!==i&&(e.removeClass(String(t)),e.addClass(String(i)).css("width",""),e.find(".size").text(n),n=e.closest(".builder-wrapper").index(),e=P.tmEPOAdmin.find_index(w[n].section.is_slider,e),P.tmEPOAdmin.setFieldValue(n,e,"div_size",i))},builder_minus_onClick:function(){var e=P(this).parentsUntil(".bitem").parent().first(),t=e.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],i=Object.keys(P.tmEPOAdmin.builderSize),n=i.findIndex(function(e){return e===t}),i=i[n-1],n=P.tmEPOAdmin.builderSize[i];void 0!==i&&(e.removeClass(String(t)),e.addClass(String(i)).css("width",""),e.find(".size").text(n),n=e.closest(".builder-wrapper").index(),e=P.tmEPOAdmin.find_index(w[n].section.is_slider,e),P.tmEPOAdmin.setFieldValue(n,e,"div_size",i))},builder_section_plus_onClick:function(){var e,t=P(this).closest(".builder-wrapper"),i=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=Object.keys(P.tmEPOAdmin.builderSize),a=n.findIndex(function(e){return e===i}),n=n[a+1],a=P.tmEPOAdmin.builderSize[n];void 0!==n&&(t.removeClass(String(i)),t.addClass(String(n)).css("width",""),t.find(".section-settings .size").text(a),e=t.index(),w[e].section.sections_size.default=n,w[e].size=a,P.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_minus_onClick:function(){var e,t=P(this).closest(".builder-wrapper"),i=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],n=Object.keys(P.tmEPOAdmin.builderSize),a=n.findIndex(function(e){return e===i}),n=n[a-1],a=P.tmEPOAdmin.builderSize[n];void 0!==n&&(t.removeClass(String(i)),t.addClass(String(n)).css("width",""),t.find(".section-settings .size").text(a),e=t.index(),w[e].section.sections_size.default=n,w[e].size=a,P.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_item_onClick:function(){var t,i,n,e=P.epoAPI.template.html(v.tc_builder_section,{}),a=P(this).closest(".builder-wrapper"),l=a.index(),e=P(e);e.addClass(w[l].section.sections_size.default),e.addClass("appear"),!0===w[l].section.tma_variations_wrap&&(e.find(".builder-remove-for-variations").remove(),e.find(".builder_hide_for_variation").hide(),e.find(".tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce").hide()),n=e.find(".section_elements"),P.tmEPOAdmin.copyContent(n,l),P.tmEPOAdmin.check_section_logic(l),t=P.tmEPOAdmin.sectionLogicObject,e=P.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:g.i18n_edit_settings,uniqidtext:g.i18n_section_uniqid+":",uniqid:w[l].section.sections_uniqid.default}),P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"80%",height:"80%",classname:"flasho tc-wrapper edit-section"+(a.is(".tma-variations-wrap")?" tma-variations-section":""),data:e,cancelEvent:function(e){i||(i=!0,P.tmEPOAdmin.sectionLogicObject=t,P.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),e.destroy(),P("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){i||(i=!0,P.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),P.tmEPOAdmin.changeBuilder(n,l),w[l].section.sections_logicrules.default=P.tmEPOAdmin.section_logic_get_JSON(n),P.tmEPOAdmin.sections_type_onChange(l),P.tmEPOAdmin.logic_reindex_force(),e.destroy(),P("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),i=!1,P("body").addClass("floatbox-open"),n.appendTo("#tc-floatbox-content").removeClass("closed"),P.tmEPOAdmin.section_logic_init(l,n),setTimeout(function(){var e=n.find(".tm-builder-logicrules").val()||"null";e=P.epoAPI.util.parseJSON(e),e=P.tmEPOAdmin.logic_check_element_rules(e),n.find(".epo-rule-toggle").val(e.toggle)},1),P.tmEPOAdmin.set_fields_logic(n),n.find(".activate-sections-logic").trigger("change"),n.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),n.tmcheckboxes(),P.tmEPOAdmin.builder_clone_after_events(n),P.tcToolTip(P("#tc-floatbox-content").find(".tm-tooltip")),P.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper")},changeBuilder:function(e,t,i){var n,a,l,o=P.tmEPOAdmin.getFieldObject(e);void 0!==i?(n=P.tmEPOAdmin.getFieldValue(w[t].fields[i],"element_type"),a=w[t].fields[i].filter(function(e){return"element_type"===e.id||"div_size"===e.id||e.id===n+"_internal_name"}),w[t].fields[i]=[].concat.apply(a,o)):(a=[w[t].section.sections_internal_name],o=[].concat.apply(a,o),l={},Object.keys(o).forEach(function(e){l[o[e].id]=o[e]}),l.is_slider=w[t].section.is_slider,l.rules_toggle=w[t].section.rules_toggle,w[t].section=l)},copyContent:function(o,e,t){var d,r,s,c=o.find(".panels_wrap"),m=void 0!==t?w[e].fields[t]:w[e].section;Object.keys(m).forEach(function(n){var i,a,l;"object"==typeof m[n]&&("multiple"===m[n].id?Object.keys(m[n].multiple).forEach(function(t){0===(d=o.find(".options-wrap")).eq(t).length&&(d.eq(0).tcClone().removeClass("separator").appendTo(c).find(":input").not("button").val("").prop("checked",!1).find(".tm_option_enabled").prop("checked",!0).val("1").trigger("changechoice"),(d=o.find(".options-wrap")).eq(t).find(".tc-cell-value input").addClass("tm_option_value")),l={title:!1,value:!1},Object.keys(m[n].multiple[t]).forEach(function(e){i=(i=(i=m[n].multiple[t][e].tags.name).replace("[]","")).substring(0,i.lastIndexOf("[")),a=m[n].multiple[t][e].default,(r=o.find(".options-wrap").eq(t).find("[name^='"+i+"']")).attr("data-builder",O.stringify(m[n].multiple[t][e])),r.attr("name",m[n].multiple[t][e].tags.name).attr("data-field-id",m[n].multiple[t][e].id).removeAttr("id").val(a).trigger("change"),void 0!==m[n].multiple[t][e].checked&&("multiple_checkboxes_options_default_value"===m[n].multiple[t][e].id||"multiple_radiobuttons_options_default_value"===m[n].multiple[t][e].id||"multiple_selectbox_options_default_value"===m[n].multiple[t][e].id||"multiple_selectboxmultiple_options_default_value"===m[n].multiple[t][e].id?r.val(t):r.val(m[n].multiple[t][e].tags.value),!0===m[n].multiple[t][e].checked?r.prop("checked",!0):r.prop("checked",!1)),"multiple_checkboxes_title_value"!==m[n].multiple[t][e].id&&"multiple_radiobuttons_title_value"!==m[n].multiple[t][e].id&&"multiple_selectbox_title_value"!==m[n].multiple[t][e].id||"-1"!==m[n].multiple[t][e].default||(l.title=!0),"multiple_checkboxes_options_value"!==m[n].multiple[t][e].id&&"multiple_radiobuttons_options_value"!==m[n].multiple[t][e].id&&"multiple_selectbox_options_value"!==m[n].multiple[t][e].id||"-1"!==m[n].multiple[t][e].default||(l.value=!0)}),l.value&&!l.title?((l=d.eq(t)).addClass("separator"),l.find(".tc-cell:not(.tm_cell_move,.tm_cell_title,.tm_cell_description,.tm_cell_delete)").addClass("tm-hidden"),l.find(".tm_option_value").removeClass("tm_option_value")):((l=d.eq(t)).removeClass("separator"),l.find(".tc-cell:not(.tm_cell_move,.tm_cell_title,.tm_cell_description,.tm_cell_delete)").removeClass("tm-hidden"),l.find(".tm_option_value").addClass("tm_option_value"))}):(i=m[n].tags.name,a=m[n].default,r=o.find("[name='"+i+"']"),"product"===m[n].fill&&m[n].options&&m[n].options.push&&(m[n].options.forEach(function(e){r.append(P('<option selected="selected" value="'+e.value+'">'+e.text+"</option>"))}),r.attr("data-exclude",g.original_post_id===g.post_id?g.post_id:g.post_id+","+g.original_post_id)),"category"===m[n].fill&&a&&a.push&&a.forEach(function(e){r.find('option[value="'+e+'"]').attr("selected","selected")}),r.is(".product-default-value-search")&&("products"===o.find(".product-mode:checked").val()||"product"===o.find(".product-mode:checked").val()?(r.removeClass("wc-product-search").addClass("enhanced-dropdown"),s=o.find(".product-products-selector").find(":selected").clone().prop("selected",!1).removeAttr("data-select2-id"),r.find("option").remove(),r.append(s)):""!==a&&(s=m[n].current_selected_text||a,r.attr("data-current-selected",a),r.data("current-selected-text",s),r.append(P('<option selected="selected" value="'+a+'">'+s+"</option>")),r.addClass("wc-product-search")),""!==a)&&r.attr("data-current-selected",a),r.attr("data-builder",O.stringify(m[n])).attr("data-field-id",m[n].id),r.is(":radio")?r.toArray().forEach(function(e,t){var i=m[n].options?(r.eq(t).val(m[n].options[t].value),m[n].options[t].value):r.eq(t).val();i===a?(r.eq(t).prop("checked",!0),r.eq(t).trigger("change")):r.eq(t).prop("checked",!1)}):(r.val(a).trigger("change"),void 0!==m[n].checked&&(r.val(m[n].tags.value),!0===m[n].checked?r.prop("checked",!0):r.prop("checked",!1))),m[n].disabled&&(r.addClass("tm-wmpl-disabled").prop("disabled",!0),r.closest(".message0x0").addClass("tm-setting-row-disabled"))))})},builder_uniqid_onClick:function(e){var t=P(this);e.ctrlKey&&(t.trigger("blur"),P.tmEPOAdmin.doConfirm({title:g.i18n_builder_change_uniqueid_title,html:g.i18n_builder_change_uniqueid+'<br><input type="text" class="t change-uniqueid" value="'+P(".tm-element-uniqid").attr("data-uniqid")+'" >',update:g.i18n_update,cancel:g.i18n_cancel},P.tmEPOAdmin.builder_uniqid_do,this,[P(this)],!0,!0))},builder_uniqid_do:function(){var e=P(".change-uniqueid").val(),t=P(".tm-builder-element-uniqid"),i=P(".tm-element-uniqid"),n=t.data("builder");t.val(e),n.default=e,t.attr("data-builder",O.stringify(n)),i.html(g.i18n_element_uniqid+":"+e),i.attr("data-uniqid",e)},builder_item_onClick:function(){var t,s,c,m,u=P(this).closest(".bitem"),e=P.epoAPI.template.html(v.tc_builder_elements,{}),p=u.closest(".builder-wrapper").index(),_=w[p].section.is_slider,f=P.tmEPOAdmin.find_index(_,u),h=P.tmEPOAdmin.getFieldValue(w[p].fields[f],"element_type"),e=P(e).filter(".bitem.element-"+h).tcClone(!0),b=P.tmEPOAdmin.getFieldValue(w[p].fields[f],"enabled",h);b="variations"===h||"1"===b||void 0===b?"1":"0",!0===w[p].section.tma_variations_wrap&&e.find("tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce").remove(),m=e.find(".hstc2").find(".inside:first"),"variations"===h&&m.find(".tm-all-attributes").html(w[p].variations_html),P.tmEPOAdmin.copyContent(m,p,f),P.tmEPOAdmin.check_element_logic(f,p),t=P.tmEPOAdmin.elementLogicObject,e=P.tmEPOAdmin.getFieldValue(w[p].fields[f],"uniqid",h),e=P.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:g.i18n_edit_settings,uniqidtext:"variations"===h||void 0===e?"":g.i18n_element_uniqid+":",uniqid:"variations"===h||void 0===e?"":e}),P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"80%",height:"80%",classname:"flasho tc-wrapper edit-element"+("variations"===h?" tma-variations-section":""),data:e,cancelEvent:function(e){s||(s=!0,(c=m.find(".tcpagination")).data("tc-pagination")&&c.tcPagination("destroy"),P.tmEPOAdmin.elementLogicObject=t,P.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),e.destroy(),P("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){var i,n,a,l,o,d,r;s||(s=!0,(c=m.find(".tcpagination")).data("tc-pagination")&&c.tcPagination("destroy"),P.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),P.tmEPOAdmin.changeBuilder(m,p,f),P.tmEPOAdmin.setFieldValue(p,f,"logicrules",P.tmEPOAdmin.element_logic_get_JSON(m),h),P.tmEPOAdmin.setFieldValue(p,f,"shipping_methods_enable_logicrules",P.tmEPOAdmin.element_shipping_logic_get_JSON(m,"enable"),h),P.tmEPOAdmin.setFieldValue(p,f,"shipping_methods_disable_logicrules",P.tmEPOAdmin.element_shipping_logic_get_JSON(m,"disable"),h),P.tmEPOAdmin.set_field_title(u,p,f),i="variations"===h||0===m.find(".is_enabled").length||m.find(".is_enabled").is(":checked")?"1":"0",n=0===m.find(".activate-element-logic").length||m.find(".activate-element-logic").is(":checked")?"1":"0","0"==i?u.addClass("element-is-disabled"):u.removeClass("element-is-disabled"),b!=i&&(a=w[p].section.sections_uniqid.default,l=f,o=P.tmEPOAdmin.find_index(_,u,".bitem",".element-is-disabled"),Object.keys(w[p].fields).forEach(function(e){d=P.tmEPOAdmin.getFieldValue(w[p].fields[e],"logicrules",!0)||"null",d=P.epoAPI.util.parseJSON(d),d=P.tmEPOAdmin.logic_check_rules_reindex(u,d,l,o,a,i,n),P.tmEPOAdmin.setFieldValue(p,e,"logicrules",O.stringify(d),!0)}),Object.keys(w).forEach(function(t){(t=parseInt(t,10))!==p&&(r=w[t].section.sections_logicrules.default||"null",r=P.epoAPI.util.parseJSON(r),r=P.tmEPOAdmin.logic_check_rules_reindex(P(".builder-wrapper").eq(t),r,l,o,a,i,n),w[t].section.sections_logicrules.default=O.stringify(r),Object.keys(w[t].fields).forEach(function(e){d=P.tmEPOAdmin.getFieldValue(w[t].fields[e],"logicrules",!0)||"null",d=P.epoAPI.util.parseJSON(d),d=P.tmEPOAdmin.logic_check_rules_reindex(P(".builder-wrapper").eq(t).find(".bitem").eq(e),d,l,o,a,i,n),P.tmEPOAdmin.setFieldValue(t,e,"logicrules",O.stringify(d),!0)}))})),P.tmEPOAdmin.logic_reindex_force(),e.destroy(),P("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),s=!1,P("body").addClass("floatbox-open"),m.appendTo("#tc-floatbox-content"),P("#tc-floatbox-content").find(".inside").addClass("tm-hidden").after(P('<div class="floatbox-loading">'+g.i18n_loading+"</div>")),setTimeout(function(){var e;P.tmEPOAdmin.element_logic_init(f,p,m),m.find(".activate-element-logic").trigger("change"),m.find(".tm_option_enabled").trigger("changechoice"),e=m.find(".tm-builder-logicrules").val()||"null",e=P.epoAPI.util.parseJSON(e),e=P.tmEPOAdmin.logic_check_element_rules(e),m.find(".epo-rule-toggle").val(e.toggle),m.find(":radio:checked").not(".panels_wrap :radio").trigger("change"),"variations"===h&&(m.find(".builder-remove-for-variations").remove(),m.find(".builder_hide_for_variation").hide()),m.tmcheckboxes(),P.tmEPOAdmin.builder_clone_after_events(m),"variations"===h?P.tmEPOAdmin.variations_display_as():P.tmEPOAdmin.floatbox_content_js(),P.tmEPOAdmin.set_fields_logic(m),P.tcToolTip(P("#tc-floatbox-content").find(".tm-tooltip")),P.tmEPOAdmin.tm_weekdays(P("#tc-floatbox-content")),P.tmEPOAdmin.tm_months(P("#tc-floatbox-content")),P.tmEPOAdmin.tm_url(),P.tmEPOAdmin.tm_pricetype_selector(),P.tmEPOAdmin.dynamicMode(),P.tmEPOAdmin.tm_option_price_type(),P.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper"),P.tmEPOAdmin.paginattion_init(),P("#tc-floatbox-content").find(".inside").removeClass("tm-hidden"),m.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),P("#tc-floatbox-content").find(".floatbox-loading").remove()},1)},set_fields_logic:function(c){c.find(".message0x0[data-required]").toArray().forEach(function(d){var r,t,s="AND";d=P(d),(r=d.data("required")).relation&&(s=r.relation,delete r.relation),t=function(){var o=!0;Object.keys(r).some(function(e){var t,i,n,a=r[e].operator,l=r[e].value;return(o=(o="OR"===s?!0:o)&&(t=P(e),n=!(i=""),c.find(e).length&&(t.is(":checkbox")?t.is(":checked")&&(i=t.val()):i=(t.is(":radio")?c.find(e).filter(":checked"):t).val(),n="object"==typeof l?-1!==P.inArray(i,l):i===l,(n="is"===a?n:!n)?d.removeClass("tm-hidden"):d.addClass("tm-hidden")),n))||d.addClass("tm-hidden"),"OR"===s&&o})},Object.keys(r).forEach(function(e){c.on("change.required changerequired",e,t)}),t()})},getFieldObject:function(e){var i,n,a,l,o,d,t=[];return e.find(":input").not("button").not(".panels_wrap :input").toArray().forEach(function(e){(e=P(e)).is(":radio")&&!e.is(":checked")||void 0!==(i=e.attr("name"))&&0===i.indexOf("tm_meta[")&&((n=i.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!=e?e:null}).splice(2,1)[0],o={id:n,default:e.val(),type:e.prop("nodeName").toLowerCase(),tags:{name:i}},(e.is(":checkbox")||e.is(":radio"))&&(o.checked=e.is(":checked"),o.tags.value=e.attr("value"),o.checked?o.default=e.attr("value"):o.default=""),e.is(".product-categories-selector")?(o.fill="category",o.options=[]):e.is(".product-products-selector")&&(o.fill="product",o.options=[]),e.attr("data-builder")&&(("product"===(d=P.epoAPI.util.parseJSON(e.attr("data-builder"))).fill||"category"===d.fill||e.is(".product-products-selector")||e.is(".product-categories-selector"))&&(o.options=e.children("option:selected").toArray().map(function(e){return{text:P(e).text(),value:P(e).val()}})),d)&&(o=Object.assign(d,o)),e.attr("data-current-selected")&&(o.current_selected=e.attr("data-current-selected"),o.current_selected_text=e.data("current-selected-text")),t.push(o))}),0<e.find(".panels_wrap :input").not("button").length&&(a=[],e.find(".panels_wrap .options-wrap").each(function(e,t){l=[],P(t).find(":input").not("button").each(function(e,t){t=P(t),void 0!==(i=t.attr("name"))&&0===i.indexOf("tm_meta[")&&((n=i.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!=e?e:null}).splice(2,1)[0],o={id:n,default:t.val(),type:t.prop("nodeName").toLowerCase(),tags:{name:i}},(t.is(":checkbox")||t.is(":radio"))&&(o.checked=t.is(":checked"),o.tags.value=t.attr("value"),o.checked?o.default=t.attr("value"):o.default=""),t.attr("data-builder")&&(d=P.epoAPI.util.parseJSON(t.attr("data-builder")))&&(o=Object.assign(d,o)),l.push(o))}),a.push(l)}),t.push({id:"multiple",multiple:a})),t},builder_clone_element:function(l,e,t,i,n){var a,o,d,r,s,c,m=P.epoAPI.template.html(v.tc_builder_elements,{});if(m)return t=t||"append",e=P(e),(m=P(m).filter(".bitem.element-"+l).tcClone(!0))?(r=e.index(),a=w[r].section.is_slider,"replace"===t&&i&&n?(c=i.find(".tm-for-bitem").attr("data-element"),m.find(".tm-builder-element-uniqid").val(P.tmEPOAdmin.getFieldValue(w[r].fields[P.tmEPOAdmin.find_index(a,i)],"uniqid",c))):m.find(".tm-builder-element-uniqid").val(P.epoAPI.math.uniqueid("",!0)),P(".builder-wrapper").length<=0&&(P.tmEPOAdmin.builder_add_section_onClick(),e=P(".builder-wrapper").first()),s=P.tmEPOAdmin.getFieldObject(m),"replace"===t&&i&&n?i.replaceWith(m):0<e.find(".bitem-wrapper").find(".ditem").length?e.find(".bitem-wrapper").find(".ditem").replaceWith(m):("append"===t&&e.find(".bitem-wrapper").not(".tm-hide").append(m),"prepend"===t&&e.find(".bitem-wrapper").not(".tm-hide").prepend(m),w[r].section.sections.default=parseInt(w[r].section.sections.default,10)+1,w[r].section.sections.default=w[r].section.sections.default.toString()),o=P.tmEPOAdmin.find_index(a,m),d=P.tmEPOAdmin.find_index(a,m,".bitem",".element-is-disabled"),"replace"===t&&i&&n?"yes"===n?(i=s.map(function(a){var e={},t=w[r].fields[o].find(function(e){var t="div_size"===e.id||"element_type"===e.id||"multiple"===e.id?e.id:l+e.id.slice(c.length);return"header"===c&&["header_size","header_title","header_title_position","header_title_color","header_subtitle","header_subtitle_color","header_subtitle_position"].includes(e.id)?t=l+"_"+e.id:"header"===l&&t.toString().startsWith(l+"_header")&&(t=e.id.slice(l.length-1)),"element_type"!==a.id&&a.id!==l+"_internal_name"&&t===a.id});return t?(Object.keys(a).forEach(function(n){"id"!==n&&"tags"!==n&&t.hasOwnProperty(n)?"multiple"===n?(e[n]=t[n].map(function(e){return e.map(function(e){var t=e.id.replace("_"+c+"_","_"+l+"_"),i=a[n][0].find(function(e){return e.id===t});return i&&e.tags&&(e.tags.name&&(e.tags.name=e.tags.name.replace("_"+c+"_","_"+l+"_")),e.tags.id&&(e.tags.id=e.tags.id.replace("_"+c+"_","_"+l+"_")),t.endsWith("options_default_value"))&&("radiobuttons"===c&&"checkboxes"===l?(e.type="input",e.tags.name=e.tags.name+"[]"):"checkboxes"===c&&"radiobuttons"===l&&(e.type="radio",e.tags.name=e.tags.name.slice(0,-2))),i?Object.assign({},e,{id:t}):null})}),e[n]=e[n].map(function(e){return e.filter(function(e){return null!==e})})):e[n]=t[n]:e[n]=a[n]}),e):a}),w[r].fields[o]=i,void 0===(n=P.tmEPOAdmin.getFieldValue(w[r].fields[o],"header"===l?"title":"header_title",l))||""===n?m.find(".tm-label").html(g.i18n_no_title):m.find(".tm-label").html(n),n=m.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],m.removeClass(String(n)),(n=i.find(function(e){return"div_size"===e.id}))&&(n=n.default,m.addClass(n))):w[r].fields[o]=s:"prepend"!==t&&"append"!==t||(a&&(w[r].section.sections_slides.default=e.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(",")),P.tmEPOAdmin.builderItemsSortableObj.start.section="drag",P.tmEPOAdmin.builderItemsSortableObj.start.section_eq="drag",P.tmEPOAdmin.builderItemsSortableObj.start.element="drag",P.tmEPOAdmin.builderItemsSortableObj.end.section=w[r].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.end.section_eq=e.index().toString(),P.tmEPOAdmin.builderItemsSortableObj.end.element=d.toString(),w[r].fields.splice(o,0,s)),m.find(".builder-element-wrap").empty(),m.find(".builder_element_type").remove(),m.find(".div_size").remove(),m.find(".tm-internal-name").remove(),P.tmEPOAdmin.check_element_logic(m),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.makeResizables(m),m):void 0},doConfirm:function(e,t,i,n,a,l){var o="object"==typeof e&&null!==e?e.title:e,d="object"==typeof e&&null!==e?'<div class="tm-inner">'+e.html+"</div>":"",o=P.epoAPI.template.html(_.template("tc-floatbox"),{id:"tc-floatbox-content",title:o,html:d,uniqid:"",update:"object"==typeof e&&null!==e&&void 0!==e.update?e.update:g.i18n_yes,cancel:"object"==typeof e&&null!==e&&void 0!==e.cancel?e.cancel:g.i18n_no}),r=!1;P.tcFloatBox({closefadeouttime:0,overlayopacity:.6,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"auto",classname:"flasho tc-wrapper"+(d?"":" tc-question"),data:o,cancelEvent:function(e){r||(r=!0,e.destroy(),a&&(n.push("no"),t.apply(i,n)))},cancelClass:".floatbox-cancel",updateEvent:function(e){r||(r=!0,a&&n.push("yes"),l?(t.apply(i,n),e.destroy()):(e.destroy(),t.apply(i,n)))},updateClass:".floatbox-update",isconfirm:!0,unique:!0})},builder_clone_do:function(){var e,t,i,n,a=P(this).closest(".bitem"),l=a.data("original_title"),o=a.tcClone();o.data("original_title",l),o&&(a.after(o),n=(l=o.closest(".builder-wrapper")).index(),i=w[n].section.is_slider,e=P.tmEPOAdmin.find_index(i,o),t=P.tmEPOAdmin.find_index(i,o,".bitem",".element-is-disabled"),w[n].section.sections.default=parseInt(w[n].section.sections.default,10)+1,w[n].section.sections.default=w[n].section.sections.default.toString(),i&&(w[n].section.sections_slides.default=l.find(".bitem-wrapper").map(function(e,t){return P(t).children(".bitem").not(".pl2").length}).get().join(",")),i=P.tmEPOAdmin.find_index(a,a),w[n].fields.splice(i,0,P.epoAPI.util.deepCopyArray(w[n].fields[i])),P.tmEPOAdmin.setFieldValue(n,e,"uniqid",P.epoAPI.math.uniqueid("",!0),!0),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.builderItemsSortableObj.start.section="clone",P.tmEPOAdmin.builderItemsSortableObj.start.section_eq="clone",P.tmEPOAdmin.builderItemsSortableObj.start.element="clone",P.tmEPOAdmin.builderItemsSortableObj.end.section=w[n].section.sections_uniqid.default,P.tmEPOAdmin.builderItemsSortableObj.end.section_eq=n.toString(),P.tmEPOAdmin.builderItemsSortableObj.end.element=t.toString(),P.tmEPOAdmin.logic_reindex(),P.tmEPOAdmin.makeResizables(o))},builder_clone_onClick:function(e){e.preventDefault(),P.tmEPOAdmin.doConfirm(g.i18n_builder_clone,P.tmEPOAdmin.builder_clone_do,this,[P(this)])},builder_change_do:function(n,a){var e=P.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+g.element_data+"</div>",title:g.i18n_change_element}),l=P.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"70%",height:"70%",top:"15%",left:"15%",classname:"flasho tc-wrapper tc-builder-add-element",data:e}),o=n.closest(".bitem"),e=o.find(".tm-for-bitem").attr("data-element");P(".tm-elements-container").find(".element-"+e).closest(".tm-element-button").remove(),P(".tc-builder-add-element .tc-element-button").on("click.cpf",function(e){var t=n.closest(".builder-wrapper"),i=P(this).attr("data-element");e.preventDefault(),P.tmEPOAdmin.builder_clone_element(i,t,"replace",o,a),P.tmEPOAdmin.logic_reindex(),l.destroy()})},builder_change_onClick:function(e){e.preventDefault(),P.tmEPOAdmin.doConfirm({title:g.i18n_builder_change_ask_title,html:g.i18n_builder_change_ask},P.tmEPOAdmin.builder_change_do,this,[P(this)],!0)},builder_section_clone_do:function(){var i,e,t=P(this).closest(".builder-wrapper"),n=t.tcClone();n&&(e=t.index(),i=[],t.find(".bitem").each(function(e,t){i[e]=P(t).data("original_title")}),t.after(n),t=t.index(),w.splice(e,0,P.epoAPI.util.deepCopyArray(w[e])),w[t].section.sections_uniqid.default=P.epoAPI.math.uniqueid("",!0),n.find(".bitem").each(function(e,t){P(t).data("original_title",i[e])}),w[t].section.is_slider&&P.tmEPOAdmin.createSlider(n),P.tmEPOAdmin.builder_reorder_multiple(),P.tmEPOAdmin.builder_items_sortable(n.find(".bitem-wrapper")),P.tmEPOAdmin.check_section_logic(t),P.tmEPOAdmin.check_element_logic(),P.tmEPOAdmin.section_logic_init(t),P.tmEPOAdmin.makeResizables(n),P.tmEPOAdmin.makeResizables(n.find(".bitem")))},builder_section_clone_onClick:function(e){e.preventDefault(),P.tmEPOAdmin.doConfirm(g.i18n_builder_clone,P.tmEPOAdmin.builder_section_clone_do,this,[P(this)])},builder_floatbox_template:function(e,t){return P.epoAPI.template.html(_.template(t||"tc-floatbox"),{id:e.id,title:e.title,html:e.html,uniqidtext:e.uniqidtext||"",uniqid:e.uniqid,update:e.update||g.i18n_update,cancel:e.cancel||g.i18n_cancel})},builder_floatbox_template_import:function(e){return P.epoAPI.template.html(_.template("tc-floatbox-import"),{id:e.id,title:e.title,html:e.html,cancel:g.i18n_cancel})},nameChange:function(e,t){var i=/\[[0-9]+\]\[\]/g,n=/\[[0-9]+\]/g;return null!==e.match(i)?e=e.replace(i,"["+t+"][]"):null!==e.match(n)&&(e=e.replace(n,"["+t+"]")),e},builder_reorder_multiple:function(){[].concat.apply([],w.map(function(e){return e.fields.map(function(e){return e.map(function(e){return"element_type"===e.id?e.default:null}).filter(function(e){return null!==e})[0]})})).filter(function(e,t,i){return i.indexOf(e)===t}).forEach(function(t){var o=0;w.map(function(e){return e.fields.map(function(e){return e.find(function(e){return"element_type"===e.id&&e.default===t})?e:null})}).forEach(function(e,l){e.forEach(function(e,n){var a;e&&(void 0!==(e=e.find(function(e,t){return"multiple"===e.id&&(a=t),"multiple"===e.id}))&&"object"==typeof e&&(e=e.multiple).forEach(function(e,i){e.forEach(function(e,t){w[l].fields[n][a].multiple[i][t].tags.name=P.tmEPOAdmin.nameChange(w[l].fields[n][a].multiple[i][t].tags.name,o)})}),o+=1)})})})},getEnhancedSelectFormatString:function(){return{language:{errorLoading:function(){return n.i18n_searching},inputTooLong:function(e){e=e.input.length-e.maximum;return 1==e?n.i18n_input_too_long_1:n.i18n_input_too_long_n.replace("%qty%",e)},inputTooShort:function(e){e=e.minimum-e.input.length;return 1==e?n.i18n_input_too_short_1:n.i18n_input_too_short_n.replace("%qty%",e)},loadingMore:function(){return n.i18n_load_more},maximumSelected:function(e){return 1===e.maximum?n.i18n_selection_too_long_1:n.i18n_selection_too_long_n.replace("%qty%",e.maximum)},noResults:function(){return n.i18n_no_matches},searching:function(){return n.i18n_searching}}}},create_products_search:function(e){e.find(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var t,e,i={allowClear:!0,placeholder:P(this).data("placeholder"),dropdownCssClass:"tc-dropdown",minimumInputLength:P(this).data("minimum_input_length")?P(this).data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:n.ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:P(this).data("action")||"woocommerce_json_search_products_and_variations",security:n.search_products_nonce,exclude:P(this).data("exclude"),include:P(this).data("include"),limit:P(this).data("limit"),display_stock:P(this).data("display_stock"),tcmode:"builder"}},processResults:function(e){var i=[];return e&&P.each(e,function(e,t){i.push({id:e,text:t})}),{results:i}},cache:!0}},i=P.extend(i,P.tmEPOAdmin.getEnhancedSelectFormatString());P(this).selectWoo(i).addClass("enhanced"),P(this).on("select2:open",function(){var e=P(d).scrollTop();P(d).scrollTop(e+1),P(d).scrollTop(e)}),P(this).data("sortable")?(t=P(this),(e=P(this).next(".select2-container").find("ul.select2-selection__rendered")).sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){P(e.find(".select2-selection__choice").get().reverse()).each(function(){var e=P(this).data("data").id,e=t.find('option[value="'+e+'"]')[0];t.prepend(e)})}})):P(this).prop("multiple")&&P(this).on("change",function(){var e=P(this).children();e.sort(function(e,t){e=e.text.toLowerCase(),t=t.text.toLowerCase();return t<e?1:e<t?-1:0}),P(this).html(e)})})},create_categories_search:function(e){e.find(":input.wc-category-search").filter(":not(.enhanced)").each(function(){var e=P.extend({allowClear:!0,placeholder:P(this).data("placeholder"),dropdownCssClass:"tc-dropdown"},P.tmEPOAdmin.getEnhancedSelectFormatString());P(this).selectWoo(e).addClass("enhanced"),P(this).on("select2:open",function(){var e=P(d).scrollTop();P(d).scrollTop(e+1),P(d).scrollTop(e)})})},create_enhanced_dropdown:function(e){e.find(":input.enhanced-dropdown").filter(":not(.enhanced)").each(function(){var e={allowClear:!0,placeholder:P(this).data("placeholder"),dropdownCssClass:"tc-dropdown"},e=P.extend(e,P.tmEPOAdmin.getEnhancedSelectFormatString());P(this).selectWoo(e).addClass("enhanced")})},create_normal_dropdown:function(e){e.find("select").filter(":not(.enhanced, .enhanced-dropdown, .wc-category-search, .wc-product-search)").not(".shipping-logic-div select, .builder-logic-div select, .panels_wrap select, .options-wrap select").each(function(){var e={allowClear:!!P(this).is(".wc-template-search"),minimumResultsForSearch:P(this).is(".wc-template-search")?0:-1,dropdownCssClass:"tc-dropdown"},e=P.extend(e,P.tmEPOAdmin.getEnhancedSelectFormatString());P(this).selectWoo(e).addClass("enhanced")})},builder_clone_elements_after_events:function(e){e.find("input.tm-color-picker").spectrum("destroy"),e.find(".sp-replacer").remove(),e.find("input.tm-color-picker").spectrum({showInput:!0,showInitial:!0,allowEmpty:!0,showAlpha:!1,showPalette:!1,clickoutFiresChange:!0,showButtons:!1,preferredFormat:"hex",theme:"epo"})},builder_clone_after_events:function(e){P.tmEPOAdmin.builder_clone_elements_after_events(e),P.tmEPOAdmin.panelsSortable(e.find(".panels_wrap")),P.tmEPOAdmin.create_normal_dropdown(e),P.tmEPOAdmin.create_enhanced_dropdown(e),P.tmEPOAdmin.create_products_search(e),P.tmEPOAdmin.create_categories_search(e)},paginattion_init:function(e){var i,n,t=P("#tc-floatbox-content"),a=t.find(".tcpagination");0===a.length||g.tcAdminNoPagination||(t=t.find(".panels_wrap"),i=t.find(".options-wrap"),n=parseInt(a.attr("data-perpage"),10),t=Math.ceil(i.length/n),a.data("tc-pagination")&&a.tcPagination("destroy"),e="last"===e?t:"current"===e&&a.data("pagination_current")||1,a.data("pagination_current",e),a.tcPagination({totalPages:t,startPage:e,visiblePages:10,onPageClick:function(e,t){P.tmEPOAdmin.paginationOnClick(a,t,n,i)}}))},paginationOnClick:function(e,t,i,n){t=parseInt(t,10),e.data("pagination_current",t),n.addClass("tm-hidden"),n.filter(function(e){return i*(t-1)<=e&&e<=i*t-1}).removeClass("tm-hidden")},addTinyMCE:function(e){var i,a,n,l,o,t="excerpt",d="object"==typeof c&&void 0!==c.mceInit&&t in c.mceInit?c.mceInit[t]:{theme:"modern",menubar:!1,wpautop:!0,indent:!1,toolbar1:"bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link,unlink",plugins:"fullscreen,image,wordpress,wpeditimage,wplink"},r="object"==typeof c&&void 0!==c.qtInit&&t in c.mceInit?c.qtInit[t]:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,fullscreen"};P(e)&&void 0!==p&&(l=P("#wp-"+t+"-editor-tools").html(),o=P("#wp-"+t+"-editor-tools").attr("class"),P(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,t){(a=P(t).attr("id"))||(P(t).attr("id",P(t).attr("name").replace(/[[\]]/g,"")),a=P(t).attr("id")),a&&(i=P.extend({},d,{selector:"#"+a}),n=P.extend({},r,{id:a}),"object"==typeof c&&(c.mceInit[a]=i,c.qtInit[a]=n),P(t).addClass("wp-editor-area").wrap('<div id="wp-'+a+'-wrap" class="wp-core-ui wp-editor-wrap tmce-active tm_editor_wrap"></div>').before('<div class="'+o+'">'+l+"</div>").wrap('<div class="wp-editor-container"></div>'),P(".tm_editor_wrap").find(".wp-switch-editor").each(function(e,t){var i,n;P(t).attr("id")&&(i=(n=P(t).attr("id")).length,n=n.substring(i-4),P(t).attr("id",a+"-"+n),P(t).attr("data-wp-editor-id",a))}),P(".tm_editor_wrap").find(".insert-media").attr("data-editor",a),p.init(i),m&&u&&(u(n),m._buttonsInit()),P(t).closest(".tm_editor_wrap").find("a.insert-media").data("editor",a).attr("data-editor",a))}))},removeTinyMCE:function(e){var i,n,a,l="";P(e)&&void 0!==p&&P(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,t){(i=P(t).attr("id"))&&p&&p.editors&&(n=P(t).val(),a=void 0!==p&&p.editors[i]&&!p.editors[i].isHidden(),void 0!==p.editors[i]&&(l=p.editors[i].getContent(),p.editors[i].remove()),P(t).closest(".tm_editor_wrap").find(".quicktags-toolbar,.wp-editor-tools").remove(),P(t).unwrap().unwrap(),a?""===l?P(t).val(""):P(t).val(l):P(t).val(n))})},set_field_title:function(e,t,i){var n;0!==e.length&&(n=P.tmEPOAdmin.getFieldValue(w[t].fields[i],"element_type"),void 0===(t=P.tmEPOAdmin.getFieldValue(w[t].fields[i],"header_title","header"!==n))||""===t?e.find(".tm-label").html(g.i18n_no_title):e.find(".tm-label").html(t))},tm_upload_button_remove_onClick:function(){var e=P(this).prevAll("input").first(),t=P(this).nextAll(".tm_upload_image").first().find(".tm_upload_image_img");P(e).val(""),P(t).attr("src",b)},variations_display_as:function(e){var n,a,l,t=e?P(this).is(".tm-changes-product-image")?P(this).closest(".tm-attribute").find(".variations-display-as"):P(this):P("#tc-floatbox-content .variations-display-as");t.each(function(e,t){var i;n=P(t).closest(".tm-attribute"),a=n.find(".tm-term"),l=n.find(".tm-changes-product-image"),"select"===(i=P(t).val())?n.find(".tma-hide-for-select-box").hide().addClass("tc-row-hidden"):n.find(".tma-hide-for-select-box").show().removeClass("tc-row-hidden"),"image"===i||"color"===i||"radiostart"===i||"radioend"===i?n.find(".tma-show-for-swatches").show().removeClass("tc-row-hidden"):n.find(".tma-show-for-swatches").hide().addClass("tc-row-hidden"),a.each(function(e,t){switch(P(t).hide().find(".tma-term-color,.tma-term-image,.tma-term-custom-image").hide(),i){case"select":case"radio":"images"===l.val()&&l.val(""),l.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===l.val()&&P(t).show().find(".tma-term-custom-image").show();break;case"image":case"radiostart":case"radioend":l.children("option[value='images']").prop("disabled",!1).show(),P(t).show().find(".tma-term-image").show(),"custom"===l.val()&&P(t).show().find(".tma-term-custom-image").show();break;case"color":"images"===l.val()&&l.val(""),l.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===l.val()&&P(t).show().find(".tma-term-custom-image").show(),P(t).show().find(".tma-term-color").show()}})}),(t=P("#tc-floatbox-content")).find(".tm_option_image").not(".tm_option_imagep").each(function(e){t.find(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",P(this).val()||b)}),t.find(".tm_option_imagep").each(function(e){t.find(".tm_upload_image").not(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",P(this).val()||b)})},floatbox_content_js:function(){var e,t,i,n=P("#tc-floatbox-content"),a=n.find(".replacement-mode:checked"),l=n.find(".tm-changes-product-image"),o=n.find(".show-tooltip"),d=n.find(".builder-element-wrap").find(".tc-upload-button").not(".tc-upload-buttonp,.tc-upload-buttonl"),r=n.find(".builder-element-wrap").find(".tm_upload_image").not(".tm_upload_imagep,.tm_upload_imagel"),s=n.find(".builder-element-wrap").find(".tc-upload-buttonp"),c=n.find(".builder-element-wrap").find(".tm_upload_imagep"),m=n.find(".builder-element-wrap").find(".tc-upload-buttonl"),u=n.find(".builder-element-wrap").find(".tm_upload_imagel"),p=n.find(".builder-element-wrap").find(".tm_cell_images"),_=n.find(".builder-element-wrap .panels_wrap").find(".sp-replacer");d.hide(),r.hide(),s.hide(),c.hide(),m.hide(),u.hide(),p.hide(),_.hide(),"images"!==l.val()||"none"!==a.val()&&"text"!==a.val()||(e=n.find(".tm_option_image").not(".tm_option_imagep"),t=n.find(".tm_option_imagep"),i=n.find(".tm_upload_imagep .tm_upload_image_img"),l.val("custom"),e.each(function(e){t.eq(e).val(P(this).val()),i.attr("src",P(this).val()||b)})),a.length&&"image"===a.val()?l.find("option[value='images']").prop("disabled",!1).show():("images"===l.val()&&l.val(""),l.find("option[value='images']").attr("disabled","disabled").hide()),setTimeout(function(){l.selectWoo("destroy").removeClass("enhanced"),P.tmEPOAdmin.create_normal_dropdown(l.parent()),l.trigger("change.select2")},100),("image"===a.val()||"images"===a.val()&&"images"===l.val())&&(d.show(),r.show(),p.show()),"custom"===l.val()&&(s.show(),c.show(),p.show()),"image"===a.val()&&P("#tc-floatbox-content .tm-use-lightbox").is(":checked")&&(m.show(),u.show()),"color"===a.val()?("swatch_img"!==o.val()&&"swatch_img_lbl"!==o.val()&&"swatch_img_desc"!==o.val()&&"swatch_img_lbl_desc"!==o.val()||o.val(""),o.find("option[value='swatch_img']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_lbl']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_desc']").attr("disabled","disabled").hide(),o.find("option[value='swatch_img_lbl_desc']").attr("disabled","disabled").hide()):(o.find("option[value='swatch_img']").prop("disabled",!1).show(),o.find("option[value='swatch_img_lbl']").prop("disabled",!1).show(),o.find("option[value='swatch_img_desc']").prop("disabled",!1).show(),o.find("option[value='swatch_img_lbl_desc']").prop("disabled",!1).show()),setTimeout(function(){o.selectWoo("destroy").removeClass("enhanced"),P.tmEPOAdmin.create_normal_dropdown(o.parent()),o.trigger("change.select2")},100),"color"===a.val()&&(p.show(),_.show()),n.find(".tm_option_image").not(".tm_option_imagec, .tm_option_imagep, .tm_option_imagel").each(function(e){n.find(".tm_upload_image").not(".tm_upload_imagec, .tm_upload_imagep, .tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",P(this).val()||b)}),n.find(".tm_option_imagec").each(function(e){n.find(".tm_upload_imagec").eq(e).find(".tm_upload_image_img").attr("src",P(this).val()||b)}),n.find(".tm_option_imagep").each(function(e){n.find(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",P(this).val()||b)}),n.find(".tm_option_imagel").each(function(e){n.find(".tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",P(this).val()||b)})},tm_weekdays:function(e){e=P(e||"body");e.find(".tm-weekdays").each(function(e,t){var i=P(t).val().split(","),t=P(t).next(".tm-weekdays-picker-wrap");P(t).find(".tm-weekday-picker").each(function(e,t){-1!==i.indexOf(P(t).val())?(P(t).attr("checked","checked").prop("checked",!0),P(t).closest(".tm-weekdays-picker").addClass("tm-checked")):(P(t).prop("checked",!1),P(t).closest(".tm-weekdays-picker").removeClass("tm-checked"))})})},tm_weekday_picker:function(){var e=P(this).closest(".tm-weekdays-picker-wrap").prev(".tm-weekdays"),t=P(e).val().split(","),i=t.indexOf(P(this).val());P(this).is(":checked")?-1===i&&t.push(P(this).val()):-1!==i&&t.splice(i,1),t=P.map(t,function(e){return""===e?null:e}),P(e).val(t.join(",")),P.tmEPOAdmin.tm_weekdays(P(e).parent())},tm_months:function(e){e=P(e||"body");e.find(".tm-months").each(function(e,t){var i=P(t).val().split(","),t=P(t).next(".tm-months-picker-wrap");P(t).find(".tm-month-picker").each(function(e,t){-1!==i.indexOf(P(t).val())?(P(t).attr("checked","checked").prop("checked",!0),P(t).closest(".tm-months-picker").addClass("tm-checked")):(P(t).prop("checked",!1),P(t).closest(".tm-months-picker").removeClass("tm-checked"))})})},tm_month_picker:function(){var e=P(this).closest(".tm-months-picker-wrap").prev(".tm-months"),t=P(e).val().split(","),i=t.indexOf(P(this).val());P(this).is(":checked")?-1===i&&t.push(P(this).val()):-1!==i&&t.splice(i,1),t=P.map(t,function(e){return""===e?null:e}),P(e).val(t.join(",")),P.tmEPOAdmin.tm_months(P(e).parent())},tm_pricetype_selector:function(e){var t=P(".tc-element-setting-price, .tc-element-setting-sale-price"),e=P(e?this:"#tc-floatbox-content .tm-pricetype-selector");"math"===e.val()?t.attr("autocomplete","off"):t.removeAttr("autocomplete")},dynamicMode:function(e){var t=P(".tc-element-setting-price"),e=P(e?this:"#tc-floatbox-content .dynamic-mode"),e=e.val();t.removeClass("dynamic-product-price override-product-price change-product-weight"),"dynamic_product_price"===e?t.addClass("dynamic-product-price"):"override_product_price"===e?t.addClass("override-product-price"):"change_product_weight"===e&&t.addClass("change-product-weight")},tm_option_price_type:function(e){e=P(e?this:"#tc-floatbox-content .tm_option_price_type");"math"===e.val()?P(".tm_option_price, .tm_option_sale_price").attr("autocomplete","off"):P(".tm_option_price, .tm_option_sale_price").removeAttr("autocomplete")},tm_url:function(e){var t=P("#tc-floatbox-content"),i=P(this),t=t.find(".builder-element-wrap").find(".tc-cell-url");"url"===(i=e?i:P("#tc-floatbox-content .use_url")).val()?t.show():t.hide()},upload:function(e){var o,d,r;if(e.preventDefault(),!_||!_.media)return!1;o=P(this).prev("input"),d=P(this).nextAll(".tm_upload_image").first().find("img"),(o.data("tm_upload_frame")?o.data("tm_upload_frame"):(e=_.media.controller.Library.extend({defaults:h.defaults({id:"insert-image",title:"Insert Image Url",allowLocalEdits:!0,displaySettings:!0,displayUserSettings:!0,multiple:!0,type:"image"},_.media.controller.Library.prototype.defaults)}),(r=_.media({button:{text:"Select"},state:"insert-image",states:[new e]})).on("close",function(){}),r.on("select",function(){var l=r.state("insert-image"),e=l.get("selection");e&&(d.attr("src",""),o.val(""),e.each(function(e){var i,n=l.display(e).toJSON(),t=e.toJSON(),a=t.caption;_.media.view.settings.captions||delete t.caption,n=_.media.string.props(n,t),i={id:t.id,post_content:t.description,post_excerpt:a},n.linkUrl&&(i.url=n.linkUrl),"image"===t.type?(h.each({align:"align",size:"image-size",alt:"image_alt"},function(e,t){n[t]&&(i[e]=n[t])}),i["image-size"]&&e.attributes.sizes[i["image-size"]]&&(i.url=e.attributes.sizes[i["image-size"]].url)):i.post_title=n.title,d.attr("src",i.url),o.val(i.url)}))}),r.on("open",function(){var e=r.state().get("library").toJSON(),a=!0;P.each(e,function(e,i){var n;i.url===o.val()?(n=_.media.attachment(i.id),r.state().get("selection").add(n?[n]:[]),P(".attachment-display-settings").find("select.size").val("full"),a=!1):i.sizes&&P.each(i.sizes,function(e,t){t.url===o.val()&&(n=_.media.attachment(i.id),r.state().get("selection").add(n?[n]:[]),P(".attachment-display-settings").find("select.size").val(e),a=!1)}),a&&P(".attachment-display-settings").find("select.size").val("full")})}),o.data("tm_upload_frame",r),r)).open()},populatePriceVariables:function(e,t,i){var n,a,l=P.epoAPI.util.deepCopyArray(w.map(function(e,n){return e.fields.map(function(e,t){var i=e.find(function(e){return"element_type"===e.id});return i.default&&(i=i.default),e=(e=e.filter(function(e){return null!==e}).find(function(e){return e.id===i+"_uniqid"}))&&e.default,{sectionIndex:n,fieldIndex:t,uniqid:e,type:i}})})),o=P(".tm-element-uniqid").attr("data-uniqid"),d=P('<h4 class="tc-var-header">'+g.i18n_formula_product_variables+"</h4>");e.append(d),d=P('<ul class="tc-var-list product"></ul>'),e.append(d),t||i||d.append('<li class="tc-var-field" data-value="{quantity}"><span>'+g.i18n_formula_quantity+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price}"><span>'+g.i18n_formula_product_price+"</span></li>"),t||i||d.append('<li class="tc-var-field" data-value="{dynamic_product_price}"><span>'+g.i18n_formula_dynamic_product_price+"</span></li>"),t||(d=P('<h4 class="tc-var-header">'+g.i18n_formula_special_variables+"</h4>"),e.append(d),d=P('<ul class="tc-var-list product"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{options_total}"><span>'+g.i18n_formula_options_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price_plus_options_total}"><span>'+g.i18n_formula_product_price_plus_options_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{cumulative_total}"><span>'+g.i18n_formula_cumulative_total+"</span></li>"),d.append('<li class="tc-var-field" data-value="{product_price_plus_cumulative_total}"><span>'+g.i18n_product_price_plus_cumulative_total+"</span></li>")),t||i||(d=P('<h4 class="tc-var-header">'+g.i18n_formula_this_element+"</h4>"),e.append(d),d=P('<ul class="tc-var-list this"></ul>'),e.append(d),d.append('<li class="tc-var-field" data-value="{this.value}"><span>'+g.i18n_formula_this_value+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.value.length}"><span>'+g.i18n_formula_this_value_length+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.count}"><span>'+g.i18n_formula_this_count+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.count.quantity}"><span>'+g.i18n_formula_this_count_quantity+"</span></li>"),d.append('<li class="tc-var-field" data-value="{this.quantity}"><span>'+g.i18n_formula_this_quantity+"</span></li>")),l.length&&(d=P('<h4 class="tc-var-header">'+g.i18n_formula_other_elements+"</h4>"),e.append(d),d=P('<div class="tc-clearfix tm-epo-switch-wrapper"><div class="formula-field-mode-selector"><input checked="checked" name="formulamode" class="formula-field-mode" id="formulafieldmode0" value="price" type="radio"><label for="formulafieldmode0"><span title="'+g.i18n_formula_field_price_tip+'" class="tm-tooltip tc-radio-text">'+g.i18n_formula_field_price+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode1" value="value" type="radio"><label for="formulafieldmode1"><span title="'+g.i18n_formula_field_value_tip+'" class="tm-tooltip tc-radio-text">'+g.i18n_formula_field_value+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode4" value="text" type="radio"><label for="formulafieldmode4"><span title="'+g.i18n_formula_field_text_tip+'" class="tm-tooltip tc-radio-text">'+g.i18n_formula_field_text+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode5" value="text.length" type="radio"><label for="formulafieldmode5"><span title="'+g.i18n_formula_field_text_length_tip+'" class="tm-tooltip tc-radio-text">'+g.i18n_formula_field_text_length+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode2"  value="quantity" type="radio"><label for="formulafieldmode2"><span title="'+g.i18n_formula_field_quantity_tip+'" class="tm-tooltip tc-radio-text">'+g.i18n_formula_field_quantity+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode3" value="count" type="radio"><label for="formulafieldmode3"><span title="'+g.i18n_formula_field_count_tip+'" class="tm-tooltip tc-radio-text">'+g.i18n_formula_field_count+"</span></label></div></div>"),e.append(d),d=P('<ul class="tc-var-list other"></ul>'),e.append(d),l.forEach(function(e){e.forEach(function(e){e.uniqid!==o&&void 0!==e.uniqid&&(n=P.tmEPOAdmin.getFieldValue(w[e.sectionIndex].fields[e.fieldIndex],"internal_name",e.type),a=P.tmEPOAdmin.getFieldValue(w[e.sectionIndex].fields[e.fieldIndex],"header_title",e.type),"product"!==e.type)&&"dynamic"!==e.type&&(n=n+(a=""!==(a=void 0===a?"":a)?" ("+a+")":a),d.append('<li title="'+e.uniqid+'" class="tc-var-field" data-value="{field.'+e.uniqid+'.price}"><span>'+n+"</span></li>"))})})),P.tcToolTip(e.find(".tm-tooltip"))}},P(function(){v=P.epoAPI.applyFilter("tc_adjust_admin_template_engine",v),s=d.woocommerce_admin,c=d.tinyMCEPreInit,m=d.QTags,u=d.quicktags,p=d.tinyMCE,e=d.TMEPOOPTIONSJS.data,n=d.wc_enhanced_select_params,void 0!==(w=P.epoAPI.util.deepCopyArray(e))&&w||(w=[]),P.tmEPOAdmin.initialitize(),P.tcToolTip(),a&&P(".tc-admin-extra-product-options_tab").on("click.cpf",function(){P.tmEPOAdmin.makeResizables(P(".builder-wrapper")),P.tmEPOAdmin.makeResizables(P(".bitem")),P(this).off("click.cpf")})})}(window,document,window.jQuery);